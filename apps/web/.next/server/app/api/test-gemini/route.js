(()=>{var e={};e.id=183,e.ids=[183],e.modules={20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{"use strict";e.exports=require("assert")},14300:e=>{"use strict";e.exports=require("buffer")},32081:e=>{"use strict";e.exports=require("child_process")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},73292:e=>{"use strict";e.exports=require("fs/promises")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},15673:e=>{"use strict";e.exports=require("node:events")},97742:e=>{"use strict";e.exports=require("node:process")},84492:e=>{"use strict";e.exports=require("node:stream")},47261:e=>{"use strict";e.exports=require("node:util")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},85477:e=>{"use strict";e.exports=require("punycode")},63477:e=>{"use strict";e.exports=require("querystring")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},76224:e=>{"use strict";e.exports=require("tty")},35034:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},21223:()=>{},34837:()=>{},7014:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>A,patchFetch:()=>b,requestAsyncStorage:()=>f,routeModule:()=>g,serverHooks:()=>x,staticGenerationAsyncStorage:()=>y});var n={};r.r(n),r.d(n,{GET:()=>d,POST:()=>h});var s=r(63036),i=r(5736),a=r(15262),o=r(60942),l=r(52306);let c=`
You are a financial analyst AI. Analyze the following bank statement/financial documents and provide a comprehensive financial analysis.

DOCUMENT CONTENT:
{DOCUMENT_CONTENT}

Please analyze this financial data and return a JSON response with the following structure:
{
  "totalIncome": number,
  "totalExpenses": number,
  "netCashFlow": number,
  "categories": {
    "income": [
      { "category": "string", "amount": number, "percentage": number }
    ],
    "expenses": [
      { "category": "string", "amount": number, "percentage": number }
    ]
  },
  "monthlyTrends": [
    { "month": "string", "income": number, "expenses": number }
  ],
  "insights": [
    { "type": "string", "description": "string", "severity": "low|medium|high" }
  ],
  "recommendations": [
    { "category": "string", "suggestion": "string", "potentialSavings": number }
  ],
  "summary": "string"
}

Focus on:
1. Categorizing transactions (salary, groceries, utilities, entertainment, etc.)
2. Identifying spending patterns and trends
3. Calculating totals and percentages
4. Providing actionable insights and recommendations
5. Highlighting any unusual or concerning patterns

Important guidelines:
- Ensure all amounts are positive numbers
- Percentages should be calculated accurately and sum to 100 for each category type
- Provide meaningful insights based on the data patterns
- Include at least 3-5 actionable recommendations
- Categorize expenses into common categories like: Housing, Transportation, Food, Entertainment, Healthcare, Utilities, Shopping, etc.
- For income, categorize into: Salary, Freelance, Investment, Benefits, etc.
- Only return valid JSON without any markdown formatting or additional text
- If data is insufficient for certain fields, use reasonable defaults (0 for amounts, empty arrays for categories)
`;var u=r(26281);async function m(e,t=5,r=2e3){let n;for(let s=0;s<t;s++)try{return await e()}catch(e){if(n=e,s<t-1){let n=r*Math.pow(2,s);(429===e.statusCode||e.message?.includes("rate limit"))&&(n=Math.max(n,5e3*(s+1)));let i=.2*Math.random()*n,a=n+i;console.warn(`Rate-limited operation failed (attempt ${s+1}/${t}), retrying in ${Math.round(a)}ms:`,e.message),await new Promise(e=>setTimeout(e,a))}}throw console.error(`Rate-limited operation failed after ${t} attempts:`,n),n}class p{constructor(){if(this.maxRetries=3,this.timeoutMs=6e4,this.apiKeyConfigured=!!process.env.GEMINI_API_KEY,this.modelName=process.env.GEMINI_MODEL||"gemini-2.5-flash-lite",!this.apiKeyConfigured){console.warn("GEMINI_API_KEY not configured - AI analysis will be skipped"),this.client=null;return}this.client=new l.fA({apiKey:process.env.GEMINI_API_KEY})}async analyzeFinancialData(e,t={}){if(!e||0===e.length)throw new u.eb("No document content provided for analysis");if(!this.apiKeyConfigured)return console.log("Gemini API key not configured, returning placeholder analysis data"),this.generatePlaceholderAnalysis(e);let{retries:r=this.maxRetries,timeout:n=this.timeoutMs}=t,s=function(e,t){let r=e;for(let[e,n]of Object.entries(t))r=r.replace(RegExp(`{${e}}`,"g"),n);return r}(c,{DOCUMENT_CONTENT:e.join("\n\n--- DOCUMENT SEPARATOR ---\n\n")});try{let e=await m(async()=>await this.generateAnalysis(s,n),r);return this.validateAnalysisStructure(e)}catch(e){if(console.error("Gemini AI analysis failed:",e),e instanceof u.eb)throw e;throw new u.eb(`Failed to analyze financial data: ${e instanceof Error?e.message:String(e)}`,void 0,e)}}async generateAnalysis(e,t){return new Promise(async(r,n)=>{let s=setTimeout(()=>{n(new u.eb("Analysis request timed out",408))},t);try{let t;if(console.log("Sending request to Gemini AI..."),!this.client)throw new u.eb("Gemini client not initialized");let n=await this.client.models.generateContent({model:this.modelName,contents:[{text:e}]});if(clearTimeout(s),!n)throw new u.eb("No response received from Gemini AI");let i=n.text;if(!i||0===i.trim().length)throw new u.eb("Empty response received from Gemini AI");console.log("Received response from Gemini AI, parsing JSON...");try{let e=this.cleanJsonResponse(i);t=JSON.parse(e)}catch(e){throw console.error("JSON parsing failed, raw response:",i),new u.eb("Failed to parse AI response as JSON. The AI may have returned malformed data.",400,e)}r(t)}catch(e){clearTimeout(s),e?.status===429?n(new u.eb("Rate limit exceeded",429,e)):e?.status===401?n(new u.eb("Invalid API key",401,e)):e?.status===403?n(new u.eb("API access forbidden",403,e)):e?.status>=500?n(new u.eb("Gemini AI service unavailable",e.status,e)):n(e)}})}cleanJsonResponse(e){let t=e.replace(/```json\s*/g,"").replace(/```\s*/g,"");if(!(t=t.trim()).startsWith("{")){let e=t.match(/\{[\s\S]*\}/);e&&(t=e[0])}return t}validateAnalysisStructure(e){if(!e||"object"!=typeof e)throw new u.eb("AI response is not a valid object");let t=["totalIncome","totalExpenses","categories","insights","recommendations","summary"].filter(t=>!(t in e));if(t.length>0)throw new u.eb(`Missing required fields in AI response: ${t.join(", ")}`);if(e.totalIncome=this.validateNumber(e.totalIncome,"totalIncome"),e.totalExpenses=this.validateNumber(e.totalExpenses,"totalExpenses"),e.netCashFlow=e.totalIncome-e.totalExpenses,!e.categories||"object"!=typeof e.categories)throw new u.eb("Categories field must be an object");return Array.isArray(e.categories.income)||(e.categories.income=[]),Array.isArray(e.categories.expenses)||(e.categories.expenses=[]),e.monthlyTrends=Array.isArray(e.monthlyTrends)?e.monthlyTrends:[],e.insights=Array.isArray(e.insights)?e.insights:[],e.recommendations=Array.isArray(e.recommendations)?e.recommendations:[],"string"!=typeof e.summary&&(e.summary=String(e.summary||"")),e}generatePlaceholderAnalysis(e){let t=e.reduce((e,t)=>e+t.length,0),r=50*Math.floor(t/100),n=Math.floor(.8*r);return{totalIncome:r,totalExpenses:n,netCashFlow:r-n,categories:{income:[{name:"Salary",amount:.8*r,percentage:80},{name:"Other Income",amount:.2*r,percentage:20}],expenses:[{name:"Housing",amount:.3*n,percentage:30},{name:"Food",amount:.2*n,percentage:20},{name:"Transportation",amount:.15*n,percentage:15},{name:"Utilities",amount:.1*n,percentage:10},{name:"Entertainment",amount:.1*n,percentage:10},{name:"Other",amount:.15*n,percentage:15}]},monthlyTrends:[{month:"Jan",income:.9*r,expenses:.8*n},{month:"Feb",income:1.1*r,expenses:.9*n},{month:"Mar",income:1*r,expenses:1*n}],insights:["Demo mode: AI analysis requires Gemini API key configuration","Files uploaded successfully and are ready for AI analysis","Configure GEMINI_API_KEY environment variable to enable real AI insights"],recommendations:["Set up your Gemini API key to get personalized financial recommendations","Upload more bank statements for comprehensive analysis","Consider tracking expenses in categories for better insights"],summary:`Demo analysis completed for ${e.length} document(s). This is placeholder data shown because the Gemini AI API key is not configured. To get real AI-powered financial insights, please configure your GEMINI_API_KEY environment variable.`,metadata:{processingTime:Date.now(),filesProcessed:e.length,totalExtractedLength:t,analysisTimestamp:new Date().toISOString(),modelUsed:"placeholder-demo",isPlaceholderData:!0}}}validateNumber(e,t){if("string"==typeof e){let t=parseFloat(e);if(!isNaN(t))return Math.max(0,t)}return"number"!=typeof e||isNaN(e)?(console.warn(`Invalid ${t} value: ${e}, defaulting to 0`),0):Math.max(0,e)}getModelInfo(){return{model:process.env.GEMINI_MODEL||"gemini-pro",apiKeyConfigured:!!process.env.GEMINI_API_KEY}}async testConnection(){if(!this.apiKeyConfigured||!this.client)return console.log("Gemini API key not configured, connection test skipped"),!1;try{let e=(await this.client.models.generateContent({model:this.modelName,contents:[{text:'Respond with exactly: {"test": "success"}'}]})).text;if(!e||0===e.trim().length)return console.error("Empty response received from Gemini API during connection test"),!1;let t=JSON.parse(this.cleanJsonResponse(e));return"success"===t.test}catch(e){return console.error("Gemini API connection test failed:",e),!1}}estimateTokens(e){return Math.ceil(e.length/4)}isContentWithinLimits(e,t=3e4){return this.estimateTokens(e)<=t}}async function d(e){try{console.log("Testing Gemini API connection...");let e=new p,t=e.getModelInfo();if(console.log("Model info:",t),!t.apiKeyConfigured)return o.NextResponse.json({success:!1,error:"Gemini API key not configured",modelInfo:t},{status:400});let r=await e.testConnection();if(console.log("Connection test result:",r),!r)return o.NextResponse.json({success:!1,error:"Failed to connect to Gemini API - possibly invalid API key",modelInfo:t},{status:500});let n=[`Date: 2024-01-15
Transaction: Salary Deposit - $5,000.00
Balance: $5,000.00

Date: 2024-01-16  
Transaction: Grocery Store - $150.00
Balance: $4,850.00

Date: 2024-01-17
Transaction: Rent Payment - $1,200.00
Balance: $3,650.00

Date: 2024-01-18
Transaction: Utilities - $120.00
Balance: $3,530.00`];console.log("Testing analysis with sample data...");let s=await e.analyzeFinancialData(n);return console.log("Analysis completed successfully:",s),o.NextResponse.json({success:!0,message:"Gemini API is working correctly",modelInfo:t,connectionTest:r,sampleAnalysis:{totalIncome:s.totalIncome,totalExpenses:s.totalExpenses,netCashFlow:s.netCashFlow,insightsCount:s.insights?.length||0,recommendationsCount:s.recommendations?.length||0,hasPlaceholderData:s.metadata?.isPlaceholderData||!1}})}catch(e){return console.error("Gemini test failed:",e),o.NextResponse.json({success:!1,error:e instanceof Error?e.message:String(e),details:e instanceof Error?{name:e.name,stack:e.stack}:null},{status:500})}}async function h(e){try{let{documentContent:t}=await e.json();if(!t)return o.NextResponse.json({success:!1,error:"No document content provided"},{status:400});console.log("Testing analysis with provided content...");let r=new p,n=await r.analyzeFinancialData([t]);return o.NextResponse.json({success:!0,result:n})}catch(e){return console.error("Analysis test failed:",e),o.NextResponse.json({success:!1,error:e instanceof Error?e.message:String(e)},{status:500})}}let g=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/test-gemini/route",pathname:"/api/test-gemini",filename:"route",bundlePath:"app/api/test-gemini/route"},resolvedPagePath:"/Users/shrijayan.rajendran/projects/personal/bank_statement/apps/web/src/app/api/test-gemini/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:y,serverHooks:x}=g,A="/api/test-gemini/route";function b(){return(0,a.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:y})}},26281:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>n,eb:()=>s});class n extends Error{constructor(e,t){super(e),this.originalError=t,this.name="AnalysisError",Error.captureStackTrace&&Error.captureStackTrace(this,n)}}class s extends Error{constructor(e,t,r){super(e),this.statusCode=t,this.originalError=r,this.name="GeminiAPIError",Error.captureStackTrace&&Error.captureStackTrace(this,s)}}},1333:e=>{"use strict";var t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,s=Object.prototype.hasOwnProperty,i={};function a(e){var t;let r=["path"in e&&e.path&&`Path=${e.path}`,"expires"in e&&(e.expires||0===e.expires)&&`Expires=${("number"==typeof e.expires?new Date(e.expires):e.expires).toUTCString()}`,"maxAge"in e&&"number"==typeof e.maxAge&&`Max-Age=${e.maxAge}`,"domain"in e&&e.domain&&`Domain=${e.domain}`,"secure"in e&&e.secure&&"Secure","httpOnly"in e&&e.httpOnly&&"HttpOnly","sameSite"in e&&e.sameSite&&`SameSite=${e.sameSite}`,"partitioned"in e&&e.partitioned&&"Partitioned","priority"in e&&e.priority&&`Priority=${e.priority}`].filter(Boolean),n=`${e.name}=${encodeURIComponent(null!=(t=e.value)?t:"")}`;return 0===r.length?n:`${n}; ${r.join("; ")}`}function o(e){let t=new Map;for(let r of e.split(/; */)){if(!r)continue;let e=r.indexOf("=");if(-1===e){t.set(r,"true");continue}let[n,s]=[r.slice(0,e),r.slice(e+1)];try{t.set(n,decodeURIComponent(null!=s?s:"true"))}catch{}}return t}function l(e){var t,r;if(!e)return;let[[n,s],...i]=o(e),{domain:a,expires:l,httponly:m,maxage:p,path:d,samesite:h,secure:g,partitioned:f,priority:y}=Object.fromEntries(i.map(([e,t])=>[e.toLowerCase(),t]));return function(e){let t={};for(let r in e)e[r]&&(t[r]=e[r]);return t}({name:n,value:decodeURIComponent(s),domain:a,...l&&{expires:new Date(l)},...m&&{httpOnly:!0},..."string"==typeof p&&{maxAge:Number(p)},path:d,...h&&{sameSite:c.includes(t=(t=h).toLowerCase())?t:void 0},...g&&{secure:!0},...y&&{priority:u.includes(r=(r=y).toLowerCase())?r:void 0},...f&&{partitioned:!0}})}((e,r)=>{for(var n in r)t(e,n,{get:r[n],enumerable:!0})})(i,{RequestCookies:()=>m,ResponseCookies:()=>p,parseCookie:()=>o,parseSetCookie:()=>l,stringifyCookie:()=>a}),e.exports=((e,i,a,o)=>{if(i&&"object"==typeof i||"function"==typeof i)for(let a of n(i))s.call(e,a)||void 0===a||t(e,a,{get:()=>i[a],enumerable:!(o=r(i,a))||o.enumerable});return e})(t({},"__esModule",{value:!0}),i);var c=["strict","lax","none"],u=["low","medium","high"],m=class{constructor(e){this._parsed=new Map,this._headers=e;let t=e.get("cookie");if(t)for(let[e,r]of o(t))this._parsed.set(e,{name:e,value:r})}[Symbol.iterator](){return this._parsed[Symbol.iterator]()}get size(){return this._parsed.size}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let r=Array.from(this._parsed);if(!e.length)return r.map(([e,t])=>t);let n="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return r.filter(([e])=>e===n).map(([e,t])=>t)}has(e){return this._parsed.has(e)}set(...e){let[t,r]=1===e.length?[e[0].name,e[0].value]:e,n=this._parsed;return n.set(t,{name:t,value:r}),this._headers.set("cookie",Array.from(n).map(([e,t])=>a(t)).join("; ")),this}delete(e){let t=this._parsed,r=Array.isArray(e)?e.map(e=>t.delete(e)):t.delete(e);return this._headers.set("cookie",Array.from(t).map(([e,t])=>a(t)).join("; ")),r}clear(){return this.delete(Array.from(this._parsed.keys())),this}[Symbol.for("edge-runtime.inspect.custom")](){return`RequestCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(e=>`${e.name}=${encodeURIComponent(e.value)}`).join("; ")}},p=class{constructor(e){var t,r,n;this._parsed=new Map,this._headers=e;let s=null!=(n=null!=(r=null==(t=e.getSetCookie)?void 0:t.call(e))?r:e.get("set-cookie"))?n:[];for(let e of Array.isArray(s)?s:function(e){if(!e)return[];var t,r,n,s,i,a=[],o=0;function l(){for(;o<e.length&&/\s/.test(e.charAt(o));)o+=1;return o<e.length}for(;o<e.length;){for(t=o,i=!1;l();)if(","===(r=e.charAt(o))){for(n=o,o+=1,l(),s=o;o<e.length&&"="!==(r=e.charAt(o))&&";"!==r&&","!==r;)o+=1;o<e.length&&"="===e.charAt(o)?(i=!0,o=s,a.push(e.substring(t,n)),t=o):o=n+1}else o+=1;(!i||o>=e.length)&&a.push(e.substring(t,e.length))}return a}(s)){let t=l(e);t&&this._parsed.set(t.name,t)}}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let r=Array.from(this._parsed.values());if(!e.length)return r;let n="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return r.filter(e=>e.name===n)}has(e){return this._parsed.has(e)}set(...e){let[t,r,n]=1===e.length?[e[0].name,e[0].value,e[0]]:e,s=this._parsed;return s.set(t,function(e={name:"",value:""}){return"number"==typeof e.expires&&(e.expires=new Date(e.expires)),e.maxAge&&(e.expires=new Date(Date.now()+1e3*e.maxAge)),(null===e.path||void 0===e.path)&&(e.path="/"),e}({name:t,value:r,...n})),function(e,t){for(let[,r]of(t.delete("set-cookie"),e)){let e=a(r);t.append("set-cookie",e)}}(s,this._headers),this}delete(...e){let[t,r,n]="string"==typeof e[0]?[e[0]]:[e[0].name,e[0].path,e[0].domain];return this.set({name:t,path:r,domain:n,value:"",expires:new Date(0)})}[Symbol.for("edge-runtime.inspect.custom")](){return`ResponseCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(a).join("; ")}}},38521:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{RequestCookies:function(){return n.RequestCookies},ResponseCookies:function(){return n.ResponseCookies}});let n=r(1333)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[522,746,306],()=>r(7014));module.exports=n})();