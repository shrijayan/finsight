"use strict";(()=>{var e={};e.id=811,e.ids=[811,944,919],e.modules={11185:e=>{e.exports=require("mongoose")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},35034:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},73351:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>w,staticGenerationAsyncStorage:()=>y});var n={};r.r(n),r.d(n,{DELETE:()=>l});var s=r(63036),a=r(5736),o=r(15262),i=r(60942),u=r(1295),d=r(89254),c=r(50944);async function l(e,{params:t}){try{let e=await (0,u.getServerSession)();if(!e?.user?.email)return i.NextResponse.json({error:"Authentication required"},{status:401});let r=await c.userRepository.findByEmail(e.user.email);if(!r)return i.NextResponse.json({error:"User account not found"},{status:404});if(!t.reportId||""===t.reportId.trim())return i.NextResponse.json({error:"Report ID is required"},{status:400});if(!await d.M.deleteByIdAndUserId(t.reportId,r._id))return i.NextResponse.json({error:"Report not found or access denied"},{status:404});return i.NextResponse.json({message:"Report deleted successfully",deletedId:t.reportId})}catch(e){return console.error("Report delete API error:",e),i.NextResponse.json({error:"Failed to delete report"},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/reports/[reportId]/route",pathname:"/api/reports/[reportId]",filename:"route",bundlePath:"app/api/reports/[reportId]/route"},resolvedPagePath:"/Users/shrijayan.rajendran/projects/personal/bank_statement/apps/web/src/app/api/reports/[reportId]/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:y,serverHooks:w}=p,x="/api/reports/[reportId]/route";function f(){return(0,o.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:y})}},77919:(e,t,r)=>{r.d(t,{Z:()=>o});var n=r(11185),s=r.n(n);let a=global.mongoose;a||(a=global.mongoose={conn:null,promise:null});let o=async function(){if(a.conn)return a.conn;if(!a.promise){let e=process.env.MONGODB_URI;if(!e)throw Error("Please define the MONGODB_URI environment variable inside .env.local");a.promise=s().connect(e,{bufferCommands:!1}).then(e=>e)}try{a.conn=await a.promise}catch(e){throw a.promise=null,e}return a.conn}},89254:(e,t,r)=>{r.d(t,{M:()=>d});var n=r(11185),s=r.n(n);let a=new(s()).Schema({userId:{type:s().Schema.Types.ObjectId,ref:"User",required:!0,index:!0},uploadId:{type:String,required:!1},reportTitle:{type:String,required:!0},sourceDocumentCount:{type:Number,required:!0},status:{type:String,enum:["processing","completed","failed"],default:"processing",required:!0},progress:{type:Number,min:0,max:100,default:0},generatedData:{type:Object,required:!1},completedAt:{type:Date,required:!1}},{timestamps:!0});a.index({userId:1,createdAt:-1}),a.index({status:1}),a.index({userId:1,status:1});let o=s().models?.AnalysisReport||s().model("AnalysisReport",a);var i=r(77919);class u{async ensureConnection(){process.env.JEST_WORKER_ID||await (0,i.Z)()}async create(e){await this.ensureConnection();let t=new o({userId:e.userId,uploadId:e.uploadId,reportTitle:e.reportTitle,sourceDocumentCount:e.sourceDocumentCount,status:e.status||"processing",progress:e.progress||0,generatedData:e.generatedData}),r=await t.save();return this.transformToPublicReport(r)}async findById(e){await this.ensureConnection();let t=await o.findById(e).exec();return t?this.transformToPublicReport(t):null}async findByUserId(e,t=50){return await this.ensureConnection(),(await o.find({userId:e}).sort({createdAt:-1}).limit(t).exec()).map(e=>this.transformToPublicReport(e))}async findByUserIdAndStatus(e,t,r=50){return await this.ensureConnection(),(await o.find({userId:e,status:t}).sort({createdAt:-1}).limit(r).exec()).map(e=>this.transformToPublicReport(e))}async updateById(e,t){await this.ensureConnection();let r={};void 0!==t.reportTitle&&(r.reportTitle=t.reportTitle),void 0!==t.status&&(r.status=t.status),void 0!==t.progress&&(r.progress=t.progress),void 0!==t.generatedData&&(r.generatedData=t.generatedData),void 0!==t.completedAt&&(r.completedAt=t.completedAt);let n=await o.findByIdAndUpdate(e,{$set:r},{new:!0,runValidators:!0}).exec();return n?this.transformToPublicReport(n):null}async deleteById(e){return await this.ensureConnection(),!!await o.findByIdAndDelete(e).exec()}async deleteByUserId(e){return await this.ensureConnection(),(await o.deleteMany({userId:e}).exec()).deletedCount||0}async findByUploadId(e){await this.ensureConnection();let t=await o.findOne({uploadId:e}).exec();return t?this.transformToPublicReport(t):null}async countByUserId(e){return await this.ensureConnection(),o.countDocuments({userId:e}).exec()}async countByUserIdAndStatus(e,t){return await this.ensureConnection(),o.countDocuments({userId:e,status:t}).exec()}async findPaginated(e,t){await this.ensureConnection();let{page:r,limit:n,sort:s={createdAt:-1}}=t,[a,i]=await Promise.all([o.find(e).sort(s).skip((r-1)*n).limit(n).exec(),o.countDocuments(e).exec()]);return{data:a.map(e=>this.transformToPublicReport(e)),page:r,limit:n,total:i,pages:Math.ceil(i/n)}}async deleteByIdAndUserId(e,t){return await this.ensureConnection(),!!await o.findOneAndDelete({_id:e,userId:t}).exec()}transformToPublicReport(e){return{_id:e._id.toString(),userId:e.userId,uploadId:e.uploadId,reportTitle:e.reportTitle,sourceDocumentCount:e.sourceDocumentCount,status:e.status,progress:e.progress,generatedData:e.generatedData,createdAt:e.createdAt,updatedAt:e.updatedAt,completedAt:e.completedAt}}}let d=new u},50944:(e,t,r)=>{r.d(t,{userRepository:()=>d});var n=r(11185),s=r.n(n);let a=new n.Schema({name:{type:String,required:[!0,"Name is required"],trim:!0,maxlength:[100,"Name cannot exceed 100 characters"]},email:{type:String,required:[!0,"Email is required"],unique:!0,lowercase:!0,trim:!0,match:[/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/,"Please enter a valid email address"]},password:{type:String,required:[!0,"Password is required"],minlength:[6,"Password must be at least 6 characters long"]}},{timestamps:!0,collection:"users"}),o=s().models.User||s().model("User",a);var i=r(77919);class u{async ensureConnection(){process.env.JEST_WORKER_ID||await (0,i.Z)()}async findByEmail(e){await this.ensureConnection();let t=await o.findOne({email:e}).exec();return t?this.transformToPublicUser(t):null}async findById(e){await this.ensureConnection();let t=await o.findById(e).exec();return t?this.transformToPublicUser(t):null}async create(e){await this.ensureConnection();let t=new o({name:e.name,email:e.email,password:e.password}),r=await t.save();return this.transformToPublicUser(r)}async updateById(e,t){await this.ensureConnection();let r=await o.findByIdAndUpdate(e,{$set:t},{new:!0,runValidators:!0}).exec();return r?this.transformToPublicUser(r):null}async deleteById(e){return await this.ensureConnection(),!!await o.findByIdAndDelete(e).exec()}async existsByEmail(e){return await this.ensureConnection(),await o.countDocuments({email:e}).exec()>0}async findByEmailWithPassword(e){return await this.ensureConnection(),o.findOne({email:e}).exec()}transformToPublicUser(e){return{_id:e._id.toString(),name:e.name,email:e.email,createdAt:e.createdAt,updatedAt:e.updatedAt}}}let d=new u}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[522,295,746],()=>r(73351));module.exports=n})();