/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/analysis/status/[analysisId]/route";
exports.ids = ["app/api/analysis/status/[analysisId]/route"];
exports.modules = {

/***/ "mongoose":
/*!***************************!*\
  !*** external "mongoose" ***!
  \***************************/
/***/ ((module) => {

"use strict";
module.exports = require("mongoose");

/***/ }),

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "assert":
/*!*************************!*\
  !*** external "assert" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("assert");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("buffer");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

"use strict";
module.exports = require("child_process");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("events");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("fs");

/***/ }),

/***/ "fs/promises":
/*!******************************!*\
  !*** external "fs/promises" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("fs/promises");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("net");

/***/ }),

/***/ "node:events":
/*!******************************!*\
  !*** external "node:events" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:events");

/***/ }),

/***/ "node:process":
/*!*******************************!*\
  !*** external "node:process" ***!
  \*******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:process");

/***/ }),

/***/ "node:stream":
/*!******************************!*\
  !*** external "node:stream" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:stream");

/***/ }),

/***/ "node:util":
/*!****************************!*\
  !*** external "node:util" ***!
  \****************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:util");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("os");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

"use strict";
module.exports = require("punycode");

/***/ }),

/***/ "querystring":
/*!******************************!*\
  !*** external "querystring" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("querystring");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("tls");

/***/ }),

/***/ "tty":
/*!**********************!*\
  !*** external "tty" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("tty");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ }),

/***/ "?3713":
/*!****************************!*\
  !*** bufferutil (ignored) ***!
  \****************************/
/***/ (() => {

/* (ignored) */

/***/ }),

/***/ "?8e41":
/*!********************************!*\
  !*** utf-8-validate (ignored) ***!
  \********************************/
/***/ (() => {

/* (ignored) */

/***/ }),

/***/ "(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fanalysis%2Fstatus%2F%5BanalysisId%5D%2Froute&page=%2Fapi%2Fanalysis%2Fstatus%2F%5BanalysisId%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fanalysis%2Fstatus%2F%5BanalysisId%5D%2Froute.ts&appDir=%2FUsers%2Fshrijayan.rajendran%2Fprojects%2Fpersonal%2Fbank_statement%2Fapps%2Fweb%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fshrijayan.rajendran%2Fprojects%2Fpersonal%2Fbank_statement%2Fapps%2Fweb&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fanalysis%2Fstatus%2F%5BanalysisId%5D%2Froute&page=%2Fapi%2Fanalysis%2Fstatus%2F%5BanalysisId%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fanalysis%2Fstatus%2F%5BanalysisId%5D%2Froute.ts&appDir=%2FUsers%2Fshrijayan.rajendran%2Fprojects%2Fpersonal%2Fbank_statement%2Fapps%2Fweb%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fshrijayan.rajendran%2Fprojects%2Fpersonal%2Fbank_statement%2Fapps%2Fweb&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/../../node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/../../node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/../../node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_shrijayan_rajendran_projects_personal_bank_statement_apps_web_src_app_api_analysis_status_analysisId_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/analysis/status/[analysisId]/route.ts */ \"(rsc)/./src/app/api/analysis/status/[analysisId]/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/analysis/status/[analysisId]/route\",\n        pathname: \"/api/analysis/status/[analysisId]\",\n        filename: \"route\",\n        bundlePath: \"app/api/analysis/status/[analysisId]/route\"\n    },\n    resolvedPagePath: \"/Users/shrijayan.rajendran/projects/personal/bank_statement/apps/web/src/app/api/analysis/status/[analysisId]/route.ts\",\n    nextConfigOutput,\n    userland: _Users_shrijayan_rajendran_projects_personal_bank_statement_apps_web_src_app_api_analysis_status_analysisId_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/analysis/status/[analysisId]/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL25leHQvZGlzdC9idWlsZC93ZWJwYWNrL2xvYWRlcnMvbmV4dC1hcHAtbG9hZGVyLmpzP25hbWU9YXBwJTJGYXBpJTJGYW5hbHlzaXMlMkZzdGF0dXMlMkYlNUJhbmFseXNpc0lkJTVEJTJGcm91dGUmcGFnZT0lMkZhcGklMkZhbmFseXNpcyUyRnN0YXR1cyUyRiU1QmFuYWx5c2lzSWQlNUQlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZhbmFseXNpcyUyRnN0YXR1cyUyRiU1QmFuYWx5c2lzSWQlNUQlMkZyb3V0ZS50cyZhcHBEaXI9JTJGVXNlcnMlMkZzaHJpamF5YW4ucmFqZW5kcmFuJTJGcHJvamVjdHMlMkZwZXJzb25hbCUyRmJhbmtfc3RhdGVtZW50JTJGYXBwcyUyRndlYiUyRnNyYyUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZzaHJpamF5YW4ucmFqZW5kcmFuJTJGcHJvamVjdHMlMkZwZXJzb25hbCUyRmJhbmtfc3RhdGVtZW50JTJGYXBwcyUyRndlYiZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDc0U7QUFDbko7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93ZWIvP2QxZjMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL1VzZXJzL3NocmlqYXlhbi5yYWplbmRyYW4vcHJvamVjdHMvcGVyc29uYWwvYmFua19zdGF0ZW1lbnQvYXBwcy93ZWIvc3JjL2FwcC9hcGkvYW5hbHlzaXMvc3RhdHVzL1thbmFseXNpc0lkXS9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvYW5hbHlzaXMvc3RhdHVzL1thbmFseXNpc0lkXS9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2FuYWx5c2lzL3N0YXR1cy9bYW5hbHlzaXNJZF1cIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL2FuYWx5c2lzL3N0YXR1cy9bYW5hbHlzaXNJZF0vcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvc2hyaWpheWFuLnJhamVuZHJhbi9wcm9qZWN0cy9wZXJzb25hbC9iYW5rX3N0YXRlbWVudC9hcHBzL3dlYi9zcmMvYXBwL2FwaS9hbmFseXNpcy9zdGF0dXMvW2FuYWx5c2lzSWRdL3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9hbmFseXNpcy9zdGF0dXMvW2FuYWx5c2lzSWRdL3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fanalysis%2Fstatus%2F%5BanalysisId%5D%2Froute&page=%2Fapi%2Fanalysis%2Fstatus%2F%5BanalysisId%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fanalysis%2Fstatus%2F%5BanalysisId%5D%2Froute.ts&appDir=%2FUsers%2Fshrijayan.rajendran%2Fprojects%2Fpersonal%2Fbank_statement%2Fapps%2Fweb%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fshrijayan.rajendran%2Fprojects%2Fpersonal%2Fbank_statement%2Fapps%2Fweb&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/analysis/status/[analysisId]/route.ts":
/*!***********************************************************!*\
  !*** ./src/app/api/analysis/status/[analysisId]/route.ts ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/* harmony import */ var next_auth_next__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next-auth/next */ \"(rsc)/../../node_modules/next-auth/next/index.js\");\n/* harmony import */ var _lib_services_AnalysisService__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/services/AnalysisService */ \"(rsc)/./src/lib/services/AnalysisService.ts\");\n/* harmony import */ var db_src_repositories_UserRepository__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! db/src/repositories/UserRepository */ \"(rsc)/../../packages/db/src/repositories/UserRepository.ts\");\n/* harmony import */ var _lib_errors_AnalysisError__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/errors/AnalysisError */ \"(rsc)/./src/lib/errors/AnalysisError.ts\");\n\n\n\n\n\n/**\n * GET /api/analysis/status/[analysisId]\n * Get analysis progress and status information\n * Lightweight endpoint optimized for frequent polling\n * Requires authentication and user ownership verification\n */ async function GET(request, { params }) {\n    try {\n        // 1. Verify authentication\n        const session = await (0,next_auth_next__WEBPACK_IMPORTED_MODULE_1__.getServerSession)();\n        if (!session?.user?.email) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Authentication required\"\n            }, {\n                status: 401\n            });\n        }\n        // 2. Look up user to get their ObjectId\n        const user = await db_src_repositories_UserRepository__WEBPACK_IMPORTED_MODULE_3__.userRepository.findByEmail(session.user.email);\n        if (!user) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"User account not found\"\n            }, {\n                status: 404\n            });\n        }\n        const userId = user._id;\n        // 3. Validate analysisId parameter\n        if (!params.analysisId || params.analysisId.trim() === \"\") {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Analysis ID is required\"\n            }, {\n                status: 400\n            });\n        }\n        // 4. Get analysis status (lightweight data only)\n        const analysis = await _lib_services_AnalysisService__WEBPACK_IMPORTED_MODULE_2__.analysisService.getAnalysisStatus(params.analysisId, userId);\n        if (!analysis) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Analysis not found or access denied\"\n            }, {\n                status: 404\n            });\n        }\n        // 4. Return lightweight status information (no generated data)\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            id: analysis._id,\n            status: analysis.status,\n            progress: analysis.progress || 0,\n            reportTitle: analysis.reportTitle,\n            sourceDocumentCount: analysis.sourceDocumentCount,\n            createdAt: analysis.createdAt,\n            updatedAt: analysis.updatedAt,\n            completedAt: analysis.completedAt,\n            // Include basic metadata if analysis is completed\n            ...analysis.status === \"completed\" && analysis.generatedData && analysis.generatedData?.metadata && {\n                metadata: {\n                    processingTime: analysis.generatedData.metadata.processingTime,\n                    filesProcessed: analysis.generatedData.metadata.filesProcessed,\n                    analysisTimestamp: analysis.generatedData.metadata.analysisTimestamp\n                }\n            }\n        });\n    } catch (error) {\n        console.error(\"Analysis status API error:\", error);\n        if (error instanceof _lib_errors_AnalysisError__WEBPACK_IMPORTED_MODULE_4__.AnalysisError) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: error.message\n            }, {\n                status: 403\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Failed to retrieve analysis status\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9hbmFseXNpcy9zdGF0dXMvW2FuYWx5c2lzSWRdL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUF3RDtBQUNOO0FBQ2U7QUFDRztBQUNUO0FBRTNEOzs7OztDQUtDLEdBQ00sZUFBZUssSUFDcEJDLE9BQW9CLEVBQ3BCLEVBQUVDLE1BQU0sRUFBc0M7SUFFOUMsSUFBSTtRQUNGLDJCQUEyQjtRQUMzQixNQUFNQyxVQUFVLE1BQU1QLGdFQUFnQkE7UUFDdEMsSUFBSSxDQUFDTyxTQUFTQyxNQUFNQyxPQUFPO1lBQ3pCLE9BQU9WLHFEQUFZQSxDQUFDVyxJQUFJLENBQ3RCO2dCQUFFQyxPQUFPO1lBQTBCLEdBQ25DO2dCQUFFQyxRQUFRO1lBQUk7UUFFbEI7UUFFQSx3Q0FBd0M7UUFDeEMsTUFBTUosT0FBTyxNQUFNTiw4RUFBY0EsQ0FBQ1csV0FBVyxDQUFDTixRQUFRQyxJQUFJLENBQUNDLEtBQUs7UUFDaEUsSUFBSSxDQUFDRCxNQUFNO1lBQ1QsT0FBT1QscURBQVlBLENBQUNXLElBQUksQ0FDdEI7Z0JBQUVDLE9BQU87WUFBeUIsR0FDbEM7Z0JBQUVDLFFBQVE7WUFBSTtRQUVsQjtRQUVBLE1BQU1FLFNBQVNOLEtBQUtPLEdBQUc7UUFFdkIsbUNBQW1DO1FBQ25DLElBQUksQ0FBQ1QsT0FBT1UsVUFBVSxJQUFJVixPQUFPVSxVQUFVLENBQUNDLElBQUksT0FBTyxJQUFJO1lBQ3pELE9BQU9sQixxREFBWUEsQ0FBQ1csSUFBSSxDQUN0QjtnQkFBRUMsT0FBTztZQUEwQixHQUNuQztnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO1FBRUEsaURBQWlEO1FBQ2pELE1BQU1NLFdBQVcsTUFBTWpCLDBFQUFlQSxDQUFDa0IsaUJBQWlCLENBQUNiLE9BQU9VLFVBQVUsRUFBRUY7UUFFNUUsSUFBSSxDQUFDSSxVQUFVO1lBQ2IsT0FBT25CLHFEQUFZQSxDQUFDVyxJQUFJLENBQ3RCO2dCQUFFQyxPQUFPO1lBQXNDLEdBQy9DO2dCQUFFQyxRQUFRO1lBQUk7UUFFbEI7UUFFQSwrREFBK0Q7UUFDL0QsT0FBT2IscURBQVlBLENBQUNXLElBQUksQ0FBQztZQUN2QlUsSUFBSUYsU0FBU0gsR0FBRztZQUNoQkgsUUFBUU0sU0FBU04sTUFBTTtZQUN2QlMsVUFBVUgsU0FBU0csUUFBUSxJQUFJO1lBQy9CQyxhQUFhSixTQUFTSSxXQUFXO1lBQ2pDQyxxQkFBcUJMLFNBQVNLLG1CQUFtQjtZQUNqREMsV0FBV04sU0FBU00sU0FBUztZQUM3QkMsV0FBV1AsU0FBU08sU0FBUztZQUM3QkMsYUFBYVIsU0FBU1EsV0FBVztZQUNqQyxrREFBa0Q7WUFDbEQsR0FBSVIsU0FBU04sTUFBTSxLQUFLLGVBQWVNLFNBQVNTLGFBQWEsSUFBS1QsU0FBU1MsYUFBYSxFQUFVQyxZQUFZO2dCQUM1R0EsVUFBVTtvQkFDUkMsZ0JBQWdCLFNBQVVGLGFBQWEsQ0FBU0MsUUFBUSxDQUFDQyxjQUFjO29CQUN2RUMsZ0JBQWdCLFNBQVVILGFBQWEsQ0FBU0MsUUFBUSxDQUFDRSxjQUFjO29CQUN2RUMsbUJBQW1CLFNBQVVKLGFBQWEsQ0FBU0MsUUFBUSxDQUFDRyxpQkFBaUI7Z0JBQy9FO1lBQ0YsQ0FBQztRQUNIO0lBRUYsRUFBRSxPQUFPcEIsT0FBTztRQUNkcUIsUUFBUXJCLEtBQUssQ0FBQyw4QkFBOEJBO1FBRTVDLElBQUlBLGlCQUFpQlIsb0VBQWFBLEVBQUU7WUFDbEMsT0FBT0oscURBQVlBLENBQUNXLElBQUksQ0FDdEI7Z0JBQUVDLE9BQU9BLE1BQU1zQixPQUFPO1lBQUMsR0FDdkI7Z0JBQUVyQixRQUFRO1lBQUk7UUFFbEI7UUFFQSxPQUFPYixxREFBWUEsQ0FBQ1csSUFBSSxDQUN0QjtZQUFFQyxPQUFPO1FBQXFDLEdBQzlDO1lBQUVDLFFBQVE7UUFBSTtJQUVsQjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2ViLy4vc3JjL2FwcC9hcGkvYW5hbHlzaXMvc3RhdHVzL1thbmFseXNpc0lkXS9yb3V0ZS50cz8zYmQ2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyBnZXRTZXJ2ZXJTZXNzaW9uIH0gZnJvbSAnbmV4dC1hdXRoL25leHQnO1xuaW1wb3J0IHsgYW5hbHlzaXNTZXJ2aWNlIH0gZnJvbSAnQC9saWIvc2VydmljZXMvQW5hbHlzaXNTZXJ2aWNlJztcbmltcG9ydCB7IHVzZXJSZXBvc2l0b3J5IH0gZnJvbSAnZGIvc3JjL3JlcG9zaXRvcmllcy9Vc2VyUmVwb3NpdG9yeSc7XG5pbXBvcnQgeyBBbmFseXNpc0Vycm9yIH0gZnJvbSAnQC9saWIvZXJyb3JzL0FuYWx5c2lzRXJyb3InO1xuXG4vKipcbiAqIEdFVCAvYXBpL2FuYWx5c2lzL3N0YXR1cy9bYW5hbHlzaXNJZF1cbiAqIEdldCBhbmFseXNpcyBwcm9ncmVzcyBhbmQgc3RhdHVzIGluZm9ybWF0aW9uXG4gKiBMaWdodHdlaWdodCBlbmRwb2ludCBvcHRpbWl6ZWQgZm9yIGZyZXF1ZW50IHBvbGxpbmdcbiAqIFJlcXVpcmVzIGF1dGhlbnRpY2F0aW9uIGFuZCB1c2VyIG93bmVyc2hpcCB2ZXJpZmljYXRpb25cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChcbiAgcmVxdWVzdDogTmV4dFJlcXVlc3QsXG4gIHsgcGFyYW1zIH06IHsgcGFyYW1zOiB7IGFuYWx5c2lzSWQ6IHN0cmluZyB9IH1cbik6IFByb21pc2U8TmV4dFJlc3BvbnNlPiB7XG4gIHRyeSB7XG4gICAgLy8gMS4gVmVyaWZ5IGF1dGhlbnRpY2F0aW9uXG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGdldFNlcnZlclNlc3Npb24oKTtcbiAgICBpZiAoIXNlc3Npb24/LnVzZXI/LmVtYWlsKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIDIuIExvb2sgdXAgdXNlciB0byBnZXQgdGhlaXIgT2JqZWN0SWRcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgdXNlclJlcG9zaXRvcnkuZmluZEJ5RW1haWwoc2Vzc2lvbi51c2VyLmVtYWlsKTtcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ1VzZXIgYWNjb3VudCBub3QgZm91bmQnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDQgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCB1c2VySWQgPSB1c2VyLl9pZDtcblxuICAgIC8vIDMuIFZhbGlkYXRlIGFuYWx5c2lzSWQgcGFyYW1ldGVyXG4gICAgaWYgKCFwYXJhbXMuYW5hbHlzaXNJZCB8fCBwYXJhbXMuYW5hbHlzaXNJZC50cmltKCkgPT09ICcnKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdBbmFseXNpcyBJRCBpcyByZXF1aXJlZCcgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIDQuIEdldCBhbmFseXNpcyBzdGF0dXMgKGxpZ2h0d2VpZ2h0IGRhdGEgb25seSlcbiAgICBjb25zdCBhbmFseXNpcyA9IGF3YWl0IGFuYWx5c2lzU2VydmljZS5nZXRBbmFseXNpc1N0YXR1cyhwYXJhbXMuYW5hbHlzaXNJZCwgdXNlcklkKTtcblxuICAgIGlmICghYW5hbHlzaXMpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ0FuYWx5c2lzIG5vdCBmb3VuZCBvciBhY2Nlc3MgZGVuaWVkJyB9LFxuICAgICAgICB7IHN0YXR1czogNDA0IH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gNC4gUmV0dXJuIGxpZ2h0d2VpZ2h0IHN0YXR1cyBpbmZvcm1hdGlvbiAobm8gZ2VuZXJhdGVkIGRhdGEpXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIGlkOiBhbmFseXNpcy5faWQsXG4gICAgICBzdGF0dXM6IGFuYWx5c2lzLnN0YXR1cyxcbiAgICAgIHByb2dyZXNzOiBhbmFseXNpcy5wcm9ncmVzcyB8fCAwLFxuICAgICAgcmVwb3J0VGl0bGU6IGFuYWx5c2lzLnJlcG9ydFRpdGxlLFxuICAgICAgc291cmNlRG9jdW1lbnRDb3VudDogYW5hbHlzaXMuc291cmNlRG9jdW1lbnRDb3VudCxcbiAgICAgIGNyZWF0ZWRBdDogYW5hbHlzaXMuY3JlYXRlZEF0LFxuICAgICAgdXBkYXRlZEF0OiBhbmFseXNpcy51cGRhdGVkQXQsXG4gICAgICBjb21wbGV0ZWRBdDogYW5hbHlzaXMuY29tcGxldGVkQXQsXG4gICAgICAvLyBJbmNsdWRlIGJhc2ljIG1ldGFkYXRhIGlmIGFuYWx5c2lzIGlzIGNvbXBsZXRlZFxuICAgICAgLi4uKGFuYWx5c2lzLnN0YXR1cyA9PT0gJ2NvbXBsZXRlZCcgJiYgYW5hbHlzaXMuZ2VuZXJhdGVkRGF0YSAmJiAoYW5hbHlzaXMuZ2VuZXJhdGVkRGF0YSBhcyBhbnkpPy5tZXRhZGF0YSAmJiB7XG4gICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgcHJvY2Vzc2luZ1RpbWU6IChhbmFseXNpcy5nZW5lcmF0ZWREYXRhIGFzIGFueSkubWV0YWRhdGEucHJvY2Vzc2luZ1RpbWUsXG4gICAgICAgICAgZmlsZXNQcm9jZXNzZWQ6IChhbmFseXNpcy5nZW5lcmF0ZWREYXRhIGFzIGFueSkubWV0YWRhdGEuZmlsZXNQcm9jZXNzZWQsXG4gICAgICAgICAgYW5hbHlzaXNUaW1lc3RhbXA6IChhbmFseXNpcy5nZW5lcmF0ZWREYXRhIGFzIGFueSkubWV0YWRhdGEuYW5hbHlzaXNUaW1lc3RhbXBcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9KTtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0FuYWx5c2lzIHN0YXR1cyBBUEkgZXJyb3I6JywgZXJyb3IpO1xuXG4gICAgaWYgKGVycm9yIGluc3RhbmNlb2YgQW5hbHlzaXNFcnJvcikge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiBlcnJvci5tZXNzYWdlIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDMgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IGVycm9yOiAnRmFpbGVkIHRvIHJldHJpZXZlIGFuYWx5c2lzIHN0YXR1cycgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJnZXRTZXJ2ZXJTZXNzaW9uIiwiYW5hbHlzaXNTZXJ2aWNlIiwidXNlclJlcG9zaXRvcnkiLCJBbmFseXNpc0Vycm9yIiwiR0VUIiwicmVxdWVzdCIsInBhcmFtcyIsInNlc3Npb24iLCJ1c2VyIiwiZW1haWwiLCJqc29uIiwiZXJyb3IiLCJzdGF0dXMiLCJmaW5kQnlFbWFpbCIsInVzZXJJZCIsIl9pZCIsImFuYWx5c2lzSWQiLCJ0cmltIiwiYW5hbHlzaXMiLCJnZXRBbmFseXNpc1N0YXR1cyIsImlkIiwicHJvZ3Jlc3MiLCJyZXBvcnRUaXRsZSIsInNvdXJjZURvY3VtZW50Q291bnQiLCJjcmVhdGVkQXQiLCJ1cGRhdGVkQXQiLCJjb21wbGV0ZWRBdCIsImdlbmVyYXRlZERhdGEiLCJtZXRhZGF0YSIsInByb2Nlc3NpbmdUaW1lIiwiZmlsZXNQcm9jZXNzZWQiLCJhbmFseXNpc1RpbWVzdGFtcCIsImNvbnNvbGUiLCJtZXNzYWdlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/analysis/status/[analysisId]/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/errors/AnalysisError.ts":
/*!*****************************************!*\
  !*** ./src/lib/errors/AnalysisError.ts ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AnalysisError: () => (/* binding */ AnalysisError),\n/* harmony export */   FileExtractionError: () => (/* binding */ FileExtractionError),\n/* harmony export */   GeminiAPIError: () => (/* binding */ GeminiAPIError)\n/* harmony export */ });\n/**\n * Custom error class for analysis-related errors\n * Used to provide more specific error handling for the analysis workflow\n */ class AnalysisError extends Error {\n    constructor(message, originalError){\n        super(message);\n        this.originalError = originalError;\n        this.name = \"AnalysisError\";\n        // Maintain proper stack trace for where our error was thrown (Node.js only)\n        if (Error.captureStackTrace) {\n            Error.captureStackTrace(this, AnalysisError);\n        }\n    }\n}\n/**\n * Custom error class for Gemini AI API related errors\n * Used to handle specific API errors with status codes\n */ class GeminiAPIError extends Error {\n    constructor(message, statusCode, originalError){\n        super(message);\n        this.statusCode = statusCode;\n        this.originalError = originalError;\n        this.name = \"GeminiAPIError\";\n        // Maintain proper stack trace for where our error was thrown (Node.js only)\n        if (Error.captureStackTrace) {\n            Error.captureStackTrace(this, GeminiAPIError);\n        }\n    }\n}\n/**\n * Custom error class for file extraction related errors\n * Used to handle specific file processing errors\n */ class FileExtractionError extends Error {\n    constructor(message, fileType, originalError){\n        super(message);\n        this.fileType = fileType;\n        this.originalError = originalError;\n        this.name = \"FileExtractionError\";\n        // Maintain proper stack trace for where our error was thrown (Node.js only)\n        if (Error.captureStackTrace) {\n            Error.captureStackTrace(this, FileExtractionError);\n        }\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2Vycm9ycy9BbmFseXNpc0Vycm9yLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBOzs7Q0FHQyxHQUNNLE1BQU1BLHNCQUFzQkM7SUFDakNDLFlBQVlDLE9BQWUsRUFBRSxhQUEwQixDQUFFO1FBQ3ZELEtBQUssQ0FBQ0E7YUFENEJDLGdCQUFBQTtRQUVsQyxJQUFJLENBQUNDLElBQUksR0FBRztRQUVaLDRFQUE0RTtRQUM1RSxJQUFJSixNQUFNSyxpQkFBaUIsRUFBRTtZQUMzQkwsTUFBTUssaUJBQWlCLENBQUMsSUFBSSxFQUFFTjtRQUNoQztJQUNGO0FBQ0Y7QUFFQTs7O0NBR0MsR0FDTSxNQUFNTyx1QkFBdUJOO0lBQ2xDQyxZQUFZQyxPQUFlLEVBQUUsVUFBMEIsRUFBRSxhQUEwQixDQUFFO1FBQ25GLEtBQUssQ0FBQ0E7YUFENEJLLGFBQUFBO2FBQTRCSixnQkFBQUE7UUFFOUQsSUFBSSxDQUFDQyxJQUFJLEdBQUc7UUFFWiw0RUFBNEU7UUFDNUUsSUFBSUosTUFBTUssaUJBQWlCLEVBQUU7WUFDM0JMLE1BQU1LLGlCQUFpQixDQUFDLElBQUksRUFBRUM7UUFDaEM7SUFDRjtBQUNGO0FBRUE7OztDQUdDLEdBQ00sTUFBTUUsNEJBQTRCUjtJQUN2Q0MsWUFBWUMsT0FBZSxFQUFFLFFBQXdCLEVBQUUsYUFBMEIsQ0FBRTtRQUNqRixLQUFLLENBQUNBO2FBRDRCTyxXQUFBQTthQUEwQk4sZ0JBQUFBO1FBRTVELElBQUksQ0FBQ0MsSUFBSSxHQUFHO1FBRVosNEVBQTRFO1FBQzVFLElBQUlKLE1BQU1LLGlCQUFpQixFQUFFO1lBQzNCTCxNQUFNSyxpQkFBaUIsQ0FBQyxJQUFJLEVBQUVHO1FBQ2hDO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL3dlYi8uL3NyYy9saWIvZXJyb3JzL0FuYWx5c2lzRXJyb3IudHM/OGZhZCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEN1c3RvbSBlcnJvciBjbGFzcyBmb3IgYW5hbHlzaXMtcmVsYXRlZCBlcnJvcnNcbiAqIFVzZWQgdG8gcHJvdmlkZSBtb3JlIHNwZWNpZmljIGVycm9yIGhhbmRsaW5nIGZvciB0aGUgYW5hbHlzaXMgd29ya2Zsb3dcbiAqL1xuZXhwb3J0IGNsYXNzIEFuYWx5c2lzRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKG1lc3NhZ2U6IHN0cmluZywgcHVibGljIG9yaWdpbmFsRXJyb3I/OiBhbnkpIHtcbiAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB0aGlzLm5hbWUgPSAnQW5hbHlzaXNFcnJvcic7XG4gICAgXG4gICAgLy8gTWFpbnRhaW4gcHJvcGVyIHN0YWNrIHRyYWNlIGZvciB3aGVyZSBvdXIgZXJyb3Igd2FzIHRocm93biAoTm9kZS5qcyBvbmx5KVxuICAgIGlmIChFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSkge1xuICAgICAgRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UodGhpcywgQW5hbHlzaXNFcnJvcik7XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogQ3VzdG9tIGVycm9yIGNsYXNzIGZvciBHZW1pbmkgQUkgQVBJIHJlbGF0ZWQgZXJyb3JzXG4gKiBVc2VkIHRvIGhhbmRsZSBzcGVjaWZpYyBBUEkgZXJyb3JzIHdpdGggc3RhdHVzIGNvZGVzXG4gKi9cbmV4cG9ydCBjbGFzcyBHZW1pbmlBUElFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IobWVzc2FnZTogc3RyaW5nLCBwdWJsaWMgc3RhdHVzQ29kZT86IG51bWJlciwgcHVibGljIG9yaWdpbmFsRXJyb3I/OiBhbnkpIHtcbiAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB0aGlzLm5hbWUgPSAnR2VtaW5pQVBJRXJyb3InO1xuICAgIFxuICAgIC8vIE1haW50YWluIHByb3BlciBzdGFjayB0cmFjZSBmb3Igd2hlcmUgb3VyIGVycm9yIHdhcyB0aHJvd24gKE5vZGUuanMgb25seSlcbiAgICBpZiAoRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UpIHtcbiAgICAgIEVycm9yLmNhcHR1cmVTdGFja1RyYWNlKHRoaXMsIEdlbWluaUFQSUVycm9yKTtcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBDdXN0b20gZXJyb3IgY2xhc3MgZm9yIGZpbGUgZXh0cmFjdGlvbiByZWxhdGVkIGVycm9yc1xuICogVXNlZCB0byBoYW5kbGUgc3BlY2lmaWMgZmlsZSBwcm9jZXNzaW5nIGVycm9yc1xuICovXG5leHBvcnQgY2xhc3MgRmlsZUV4dHJhY3Rpb25FcnJvciBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IobWVzc2FnZTogc3RyaW5nLCBwdWJsaWMgZmlsZVR5cGU/OiBzdHJpbmcsIHB1YmxpYyBvcmlnaW5hbEVycm9yPzogYW55KSB7XG4gICAgc3VwZXIobWVzc2FnZSk7XG4gICAgdGhpcy5uYW1lID0gJ0ZpbGVFeHRyYWN0aW9uRXJyb3InO1xuICAgIFxuICAgIC8vIE1haW50YWluIHByb3BlciBzdGFjayB0cmFjZSBmb3Igd2hlcmUgb3VyIGVycm9yIHdhcyB0aHJvd24gKE5vZGUuanMgb25seSlcbiAgICBpZiAoRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UpIHtcbiAgICAgIEVycm9yLmNhcHR1cmVTdGFja1RyYWNlKHRoaXMsIEZpbGVFeHRyYWN0aW9uRXJyb3IpO1xuICAgIH1cbiAgfVxufVxuIl0sIm5hbWVzIjpbIkFuYWx5c2lzRXJyb3IiLCJFcnJvciIsImNvbnN0cnVjdG9yIiwibWVzc2FnZSIsIm9yaWdpbmFsRXJyb3IiLCJuYW1lIiwiY2FwdHVyZVN0YWNrVHJhY2UiLCJHZW1pbmlBUElFcnJvciIsInN0YXR1c0NvZGUiLCJGaWxlRXh0cmFjdGlvbkVycm9yIiwiZmlsZVR5cGUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/errors/AnalysisError.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/services/AnalysisService.ts":
/*!*********************************************!*\
  !*** ./src/lib/services/AnalysisService.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AnalysisService: () => (/* binding */ AnalysisService),\n/* harmony export */   analysisService: () => (/* binding */ analysisService)\n/* harmony export */ });\n/* harmony import */ var _google_genai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @google/genai */ \"(rsc)/../../node_modules/@google/genai/dist/node/index.mjs\");\n/* harmony import */ var db_src_repositories_AnalysisReportRepository__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! db/src/repositories/AnalysisReportRepository */ \"(rsc)/../../packages/db/src/repositories/AnalysisReportRepository.ts\");\n/* harmony import */ var _errors_AnalysisError__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../errors/AnalysisError */ \"(rsc)/./src/lib/errors/AnalysisError.ts\");\n/* harmony import */ var fs_promises__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! fs/promises */ \"fs/promises\");\n/* harmony import */ var fs_promises__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(fs_promises__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_4__);\n\n\n\n\n\n/**\n * Enhanced analysis service using Gemini's native document processing capabilities\n * This service bypasses text extraction and uses Gemini's document understanding directly\n */ class AnalysisService {\n    constructor(){\n        this.apiKeyConfigured = !!process.env.GEMINI_API_KEY;\n        this.modelName = process.env.GEMINI_MODEL || \"gemini-2.5-flash\";\n        if (!this.apiKeyConfigured) {\n            console.warn(\"GEMINI_API_KEY not configured - AI analysis will be skipped\");\n            this.client = null;\n            return;\n        }\n        this.client = new _google_genai__WEBPACK_IMPORTED_MODULE_0__.GoogleGenAI({\n            apiKey: process.env.GEMINI_API_KEY\n        });\n    }\n    /**\n   * Process analysis for uploaded files using native Gemini document understanding\n   * @param uploadId - Unique identifier for the upload batch\n   * @param fileReferences - Array of local file paths for uploaded files\n   * @param userId - User ID who owns the files\n   * @param options - Optional configuration\n   * @returns Analysis report ID\n   */ async processAnalysis(uploadId, fileReferences, userId, options = {}) {\n        const startTime = Date.now();\n        try {\n            console.log(`Starting Gemini native analysis for upload ${uploadId} with ${fileReferences.length} files`);\n            // Validate inputs\n            if (!fileReferences || fileReferences.length === 0) {\n                throw new _errors_AnalysisError__WEBPACK_IMPORTED_MODULE_2__.AnalysisError(\"No file references provided for analysis\");\n            }\n            if (!userId) {\n                throw new _errors_AnalysisError__WEBPACK_IMPORTED_MODULE_2__.AnalysisError(\"User ID is required for analysis\");\n            }\n            // Create initial analysis report record\n            const reportTitle = options.reportTitle || `Financial Analysis - ${new Date().toLocaleDateString()}`;\n            const analysisReport = await this.createInitialReport({\n                userId,\n                uploadId,\n                reportTitle,\n                sourceDocumentCount: fileReferences.length,\n                status: \"processing\",\n                progress: 0\n            });\n            console.log(`Created analysis report ${analysisReport._id}`);\n            try {\n                // Update progress: Starting file processing\n                await this.updateProgress(analysisReport._id, 20, \"Processing documents with AI...\");\n                // Process files directly with Gemini\n                const analysisResults = await this.analyzeDocumentsWithGemini(fileReferences, userId);\n                console.log(\"Gemini native analysis completed successfully\");\n                // Update progress: Analysis complete, saving results\n                await this.updateProgress(analysisReport._id, 80, \"Saving analysis results...\");\n                // Enhance analysis results with metadata\n                const enhancedResults = {\n                    ...analysisResults,\n                    metadata: {\n                        processingTime: Date.now() - startTime,\n                        filesProcessed: fileReferences.length,\n                        analysisTimestamp: new Date().toISOString(),\n                        modelUsed: this.modelName,\n                        useNativeDocumentUnderstanding: true\n                    }\n                };\n                // Save analysis results to database\n                await this.completeAnalysis(analysisReport._id, enhancedResults);\n                console.log(`Analysis completed successfully for report ${analysisReport._id}`);\n                return analysisReport._id;\n            } catch (error) {\n                // Mark analysis as failed\n                await this.markAnalysisFailed(analysisReport._id, error);\n                throw error;\n            }\n        } catch (error) {\n            console.error(\"Analysis failed:\", error);\n            if (error instanceof _errors_AnalysisError__WEBPACK_IMPORTED_MODULE_2__.AnalysisError) {\n                throw error;\n            }\n            throw new _errors_AnalysisError__WEBPACK_IMPORTED_MODULE_2__.AnalysisError(`Failed to process financial analysis: ${error instanceof Error ? error.message : String(error)}`, error);\n        }\n    }\n    /**\n   * Analyze documents using Gemini's native document understanding\n   * @param fileReferences - Array of file references (local:// paths)\n   * @param userId - User ID for access control\n   * @returns Analysis results from Gemini\n   */ async analyzeDocumentsWithGemini(fileReferences, userId) {\n        if (!this.client) {\n            console.log(\"Gemini client not available, returning placeholder analysis\");\n            return this.generatePlaceholderAnalysis(fileReferences);\n        }\n        try {\n            // Prepare document contents for Gemini\n            const contents = [];\n            // Add the financial analysis prompt\n            contents.push({\n                text: `You are a financial analyst AI. Analyze the following bank statement/financial documents and provide a comprehensive financial analysis.\n\nPlease analyze this financial data and return a JSON response with the following structure:\n{\n  \"totalIncome\": number,\n  \"totalExpenses\": number,\n  \"netCashFlow\": number,\n  \"categories\": {\n    \"income\": [\n      { \"category\": \"string\", \"amount\": number, \"percentage\": number }\n    ],\n    \"expenses\": [\n      { \"category\": \"string\", \"amount\": number, \"percentage\": number }\n    ]\n  },\n  \"monthlyTrends\": [\n    { \"month\": \"string\", \"income\": number, \"expenses\": number }\n  ],\n  \"insights\": [\n    { \"type\": \"string\", \"description\": \"string\", \"severity\": \"low|medium|high\" }\n  ],\n  \"recommendations\": [\n    { \"category\": \"string\", \"suggestion\": \"string\", \"potentialSavings\": number }\n  ],\n  \"summary\": \"string\"\n}\n\nFocus on:\n1. Categorizing transactions (salary, groceries, utilities, entertainment, etc.)\n2. Identifying spending patterns and trends\n3. Calculating totals and percentages\n4. Providing actionable insights and recommendations\n5. Highlighting any unusual or concerning patterns\n\nImportant guidelines:\n- Ensure all amounts are positive numbers\n- Percentages should be calculated accurately and sum to 100 for each category type\n- Provide meaningful insights based on the data patterns\n- Include at least 3-5 actionable recommendations\n- Categorize expenses into common categories like: Housing, Transportation, Food, Entertainment, Healthcare, Utilities, Shopping, etc.\n- For income, categorize into: Salary, Freelance, Investment, Benefits, etc.\n- Only return valid JSON without any markdown formatting or additional text\n- If data is insufficient for certain fields, use reasonable defaults (0 for amounts, empty arrays for categories)`\n            });\n            // Process each file\n            for(let i = 0; i < fileReferences.length; i++){\n                const fileRef = fileReferences[i];\n                console.log(`Processing file ${i + 1}/${fileReferences.length}: ${fileRef}`);\n                try {\n                    if (fileRef.startsWith(\"local://\")) {\n                        // Handle local file\n                        const localPath = fileRef.replace(\"local://\", \"\");\n                        const currentDir = process.cwd();\n                        console.log(`Process CWD: ${currentDir}`);\n                        // More robust path resolution - check if we're in the correct directory\n                        let filePath;\n                        if (currentDir.includes(\"bank_statement\")) {\n                            // We're in the right project directory\n                            filePath = (0,path__WEBPACK_IMPORTED_MODULE_4__.join)(currentDir, \"apps\", \"web\", \"uploads\", localPath);\n                        } else {\n                            // We might be in the wrong directory, construct from current directory but go up to find the right path\n                            const parts = currentDir.split(\"/\");\n                            const projectRoot = parts.slice(0, -1).join(\"/\") + \"/bank_statement\";\n                            filePath = (0,path__WEBPACK_IMPORTED_MODULE_4__.join)(projectRoot, \"apps\", \"web\", \"uploads\", localPath);\n                            console.log(`Adjusted path from ${currentDir} to ${projectRoot}`);\n                        }\n                        console.log(`Attempting to read file at: ${filePath}`);\n                        // Read file as buffer\n                        const fileBuffer = await (0,fs_promises__WEBPACK_IMPORTED_MODULE_3__.readFile)(filePath);\n                        const filename = this.extractFilename(fileRef) || `document-${i + 1}`;\n                        // Determine file type\n                        const extension = localPath.toLowerCase().split(\".\").pop();\n                        if (extension === \"pdf\") {\n                            // Use Gemini's native PDF processing\n                            contents.push({\n                                inlineData: {\n                                    mimeType: \"application/pdf\",\n                                    data: fileBuffer.toString(\"base64\")\n                                }\n                            });\n                        } else if (extension === \"txt\" || extension === \"csv\") {\n                            // For text files, add as text content\n                            const textContent = fileBuffer.toString(\"utf-8\");\n                            contents.push({\n                                text: `Document: ${filename}\\n\\n${textContent}`\n                            });\n                        } else {\n                            console.warn(`Unsupported file type for ${filename}, skipping`);\n                        }\n                    }\n                } catch (error) {\n                    console.error(`Failed to process file ${fileRef}:`, error);\n                // Continue with other files\n                }\n            }\n            // Call Gemini API\n            console.log(\"Sending documents to Gemini for analysis...\");\n            const response = await this.client.models.generateContent({\n                model: this.modelName,\n                contents\n            });\n            if (!response || !response.text) {\n                throw new _errors_AnalysisError__WEBPACK_IMPORTED_MODULE_2__.AnalysisError(\"Empty response from Gemini API\");\n            }\n            // Parse JSON response\n            const cleanedText = this.cleanJsonResponse(response.text);\n            const analysisData = JSON.parse(cleanedText);\n            return this.validateAnalysisStructure(analysisData);\n        } catch (error) {\n            console.error(\"Gemini analysis failed:\", error);\n            if (error instanceof _errors_AnalysisError__WEBPACK_IMPORTED_MODULE_2__.AnalysisError) {\n                throw error;\n            }\n            throw new _errors_AnalysisError__WEBPACK_IMPORTED_MODULE_2__.AnalysisError(`Gemini document analysis failed: ${error instanceof Error ? error.message : String(error)}`, error);\n        }\n    }\n    /**\n   * Clean JSON response from potential markdown formatting\n   * @param text - Raw response text\n   * @returns Cleaned JSON string\n   */ cleanJsonResponse(text) {\n        // Remove markdown code blocks if present\n        let cleaned = text.replace(/```json\\s*/g, \"\").replace(/```\\s*/g, \"\");\n        // Remove any leading/trailing whitespace\n        cleaned = cleaned.trim();\n        // If the response starts with explanation text, try to extract just the JSON\n        if (!cleaned.startsWith(\"{\")) {\n            const jsonMatch = cleaned.match(/\\{[\\s\\S]*\\}/);\n            if (jsonMatch) {\n                cleaned = jsonMatch[0];\n            }\n        }\n        return cleaned;\n    }\n    /**\n   * Validate the structure of the AI analysis response\n   * @param data - Raw analysis data from AI\n   * @returns Validated and normalized analysis data\n   */ validateAnalysisStructure(data) {\n        if (!data || typeof data !== \"object\") {\n            throw new _errors_AnalysisError__WEBPACK_IMPORTED_MODULE_2__.AnalysisError(\"AI response is not a valid object\");\n        }\n        // Check required fields\n        const requiredFields = [\n            \"totalIncome\",\n            \"totalExpenses\",\n            \"categories\",\n            \"insights\",\n            \"recommendations\",\n            \"summary\"\n        ];\n        const missingFields = requiredFields.filter((field)=>!(field in data));\n        if (missingFields.length > 0) {\n            throw new _errors_AnalysisError__WEBPACK_IMPORTED_MODULE_2__.AnalysisError(`Missing required fields in AI response: ${missingFields.join(\", \")}`);\n        }\n        // Validate and normalize numeric fields\n        data.totalIncome = this.validateNumber(data.totalIncome, \"totalIncome\");\n        data.totalExpenses = this.validateNumber(data.totalExpenses, \"totalExpenses\");\n        // Calculate netCashFlow if not provided or incorrect\n        data.netCashFlow = data.totalIncome - data.totalExpenses;\n        // Validate categories structure\n        if (!data.categories || typeof data.categories !== \"object\") {\n            throw new _errors_AnalysisError__WEBPACK_IMPORTED_MODULE_2__.AnalysisError(\"Categories field must be an object\");\n        }\n        if (!Array.isArray(data.categories.income)) {\n            data.categories.income = [];\n        }\n        if (!Array.isArray(data.categories.expenses)) {\n            data.categories.expenses = [];\n        }\n        // Validate arrays\n        data.monthlyTrends = Array.isArray(data.monthlyTrends) ? data.monthlyTrends : [];\n        data.insights = Array.isArray(data.insights) ? data.insights : [];\n        data.recommendations = Array.isArray(data.recommendations) ? data.recommendations : [];\n        // Ensure summary is a string\n        if (typeof data.summary !== \"string\") {\n            data.summary = String(data.summary || \"\");\n        }\n        return data;\n    }\n    /**\n   * Generate placeholder analysis when Gemini is not available\n   * @param fileReferences - Array of file references\n   * @returns Mock analysis data structure\n   */ generatePlaceholderAnalysis(fileReferences) {\n        const estimatedIncome = 5000; // Mock estimation\n        const estimatedExpenses = 3500;\n        return {\n            totalIncome: estimatedIncome,\n            totalExpenses: estimatedExpenses,\n            netCashFlow: estimatedIncome - estimatedExpenses,\n            categories: {\n                income: [\n                    {\n                        category: \"Salary\",\n                        amount: estimatedIncome * 0.9,\n                        percentage: 90\n                    },\n                    {\n                        category: \"Other Income\",\n                        amount: estimatedIncome * 0.1,\n                        percentage: 10\n                    }\n                ],\n                expenses: [\n                    {\n                        category: \"Housing\",\n                        amount: estimatedExpenses * 0.3,\n                        percentage: 30\n                    },\n                    {\n                        category: \"Food\",\n                        amount: estimatedExpenses * 0.2,\n                        percentage: 20\n                    },\n                    {\n                        category: \"Transportation\",\n                        amount: estimatedExpenses * 0.15,\n                        percentage: 15\n                    },\n                    {\n                        category: \"Utilities\",\n                        amount: estimatedExpenses * 0.1,\n                        percentage: 10\n                    },\n                    {\n                        category: \"Entertainment\",\n                        amount: estimatedExpenses * 0.1,\n                        percentage: 10\n                    },\n                    {\n                        category: \"Other\",\n                        amount: estimatedExpenses * 0.15,\n                        percentage: 15\n                    }\n                ]\n            },\n            monthlyTrends: [\n                {\n                    month: \"Current\",\n                    income: estimatedIncome,\n                    expenses: estimatedExpenses\n                }\n            ],\n            insights: [\n                {\n                    type: \"Demo Mode\",\n                    description: \"AI analysis requires Gemini API key configuration\",\n                    severity: \"low\"\n                },\n                {\n                    type: \"File Processing\",\n                    description: \"Files uploaded successfully and ready for analysis\",\n                    severity: \"low\"\n                }\n            ],\n            recommendations: [\n                {\n                    category: \"Setup\",\n                    suggestion: \"Configure Gemini API key for real AI insights\",\n                    potentialSavings: 0\n                },\n                {\n                    category: \"Analysis\",\n                    suggestion: \"Upload bank statements for comprehensive analysis\",\n                    potentialSavings: 0\n                }\n            ],\n            summary: `Demo analysis completed for ${fileReferences.length} document(s). This is placeholder data. Configure GEMINI_API_KEY for real AI-powered insights.`,\n            metadata: {\n                isPlaceholderData: true\n            }\n        };\n    }\n    /**\n   * Validate and normalize a numeric field\n   * @param value - Value to validate\n   * @param fieldName - Name of the field for error reporting\n   * @returns Validated numeric value\n   */ validateNumber(value, fieldName) {\n        if (typeof value === \"string\") {\n            const parsed = parseFloat(value);\n            if (!isNaN(parsed)) {\n                return Math.max(0, parsed);\n            }\n        }\n        if (typeof value === \"number\" && !isNaN(value)) {\n            return Math.max(0, value);\n        }\n        console.warn(`Invalid ${fieldName} value: ${value}, defaulting to 0`);\n        return 0;\n    }\n    /**\n   * Extract filename from file URL\n   * @param fileUrl - File URL\n   * @returns Extracted filename\n   */ extractFilename(fileUrl) {\n        try {\n            const parts = fileUrl.split(\"/\");\n            return parts[parts.length - 1] || null;\n        } catch (error) {\n            console.warn(`Failed to extract filename from URL: ${fileUrl}`);\n            return null;\n        }\n    }\n    /**\n   * Create initial analysis report in the database\n   */ async createInitialReport(reportData) {\n        try {\n            return await db_src_repositories_AnalysisReportRepository__WEBPACK_IMPORTED_MODULE_1__.analysisReportRepository.create(reportData);\n        } catch (error) {\n            throw new _errors_AnalysisError__WEBPACK_IMPORTED_MODULE_2__.AnalysisError(`Failed to create analysis report: ${error instanceof Error ? error.message : String(error)}`, error);\n        }\n    }\n    /**\n   * Update analysis progress\n   */ async updateProgress(reportId, progress, status) {\n        try {\n            await db_src_repositories_AnalysisReportRepository__WEBPACK_IMPORTED_MODULE_1__.analysisReportRepository.updateById(reportId, {\n                progress: Math.max(0, Math.min(100, progress))\n            });\n            if (status) {\n                console.log(`Analysis ${reportId}: ${progress}% - ${status}`);\n            }\n        } catch (error) {\n            console.error(`Failed to update progress for analysis ${reportId}:`, error);\n        }\n    }\n    /**\n   * Complete analysis and save final results\n   */ async completeAnalysis(reportId, analysisResults) {\n        try {\n            await db_src_repositories_AnalysisReportRepository__WEBPACK_IMPORTED_MODULE_1__.analysisReportRepository.updateById(reportId, {\n                generatedData: analysisResults,\n                status: \"completed\",\n                progress: 100,\n                completedAt: new Date()\n            });\n        } catch (error) {\n            throw new _errors_AnalysisError__WEBPACK_IMPORTED_MODULE_2__.AnalysisError(`Failed to save analysis results: ${error instanceof Error ? error.message : String(error)}`, error);\n        }\n    }\n    /**\n   * Mark analysis as failed\n   */ async markAnalysisFailed(reportId, error) {\n        try {\n            const errorMessage = error instanceof Error ? error.message : String(error);\n            const errorData = {\n                error: errorMessage,\n                errorType: error.constructor.name,\n                failedAt: new Date().toISOString()\n            };\n            await db_src_repositories_AnalysisReportRepository__WEBPACK_IMPORTED_MODULE_1__.analysisReportRepository.updateById(reportId, {\n                status: \"failed\",\n                generatedData: errorData,\n                completedAt: new Date()\n            });\n        } catch (updateError) {\n            console.error(`Failed to mark analysis ${reportId} as failed:`, updateError);\n        }\n    }\n    /**\n   * Get analysis status by report ID\n   */ async getAnalysisStatus(reportId, userId) {\n        try {\n            const report = await db_src_repositories_AnalysisReportRepository__WEBPACK_IMPORTED_MODULE_1__.analysisReportRepository.findById(reportId);\n            if (!report) {\n                return null;\n            }\n            // Handle migration period: check both ObjectId and email formats\n            let hasAccess = false;\n            // Convert both values to strings for consistent comparison\n            const reportUserIdStr = report.userId?.toString() || \"\";\n            const providedUserIdStr = userId?.toString() || \"\";\n            if (reportUserIdStr === providedUserIdStr) {\n                // Direct match (both converted to strings)\n                hasAccess = true;\n            } else {\n                // Check if the report's userId is an email and we need to convert the provided ObjectId\n                try {\n                    const { userRepository } = await __webpack_require__.e(/*! import() */ \"_rsc_packages_db_src_repositories_UserRepository_ts-_bf461\").then(__webpack_require__.bind(__webpack_require__, /*! db/src/repositories/UserRepository */ \"(rsc)/../../packages/db/src/repositories/UserRepository.ts\"));\n                    // If the report userId looks like an email, try to find user by email and compare ObjectIds\n                    if (typeof reportUserIdStr === \"string\" && reportUserIdStr.includes(\"@\")) {\n                        // Report has email, check if provided userId is ObjectId of that user\n                        const userByEmail = await userRepository.findByEmail(reportUserIdStr);\n                        if (userByEmail && userByEmail._id === providedUserIdStr) {\n                            hasAccess = true;\n                            console.log(`Migration: Report ${reportId} has email userId, matched with ObjectId`);\n                        }\n                    } else {\n                        // Report has ObjectId, check if provided userId might be from user with that ObjectId\n                        const userByObjectId = await userRepository.findById(providedUserIdStr);\n                        if (userByObjectId && reportUserIdStr === userByObjectId.email) {\n                            hasAccess = true;\n                            console.log(`Migration: Report ${reportId} comparison between ObjectId and email`);\n                        }\n                    }\n                } catch (error) {\n                    console.error(\"Error during migration-compatible access check:\", error);\n                }\n            }\n            console.log(\"Access check result:\", {\n                reportId,\n                reportUserId: report.userId,\n                providedUserId: userId,\n                hasAccess\n            });\n            if (!hasAccess) {\n                throw new _errors_AnalysisError__WEBPACK_IMPORTED_MODULE_2__.AnalysisError(\"Access denied: Analysis belongs to different user\");\n            }\n            return report;\n        } catch (error) {\n            if (error instanceof _errors_AnalysisError__WEBPACK_IMPORTED_MODULE_2__.AnalysisError) {\n                throw error;\n            }\n            throw new _errors_AnalysisError__WEBPACK_IMPORTED_MODULE_2__.AnalysisError(`Failed to get analysis status: ${error instanceof Error ? error.message : String(error)}`, error);\n        }\n    }\n    /**\n   * Get all analysis reports for a user\n   */ async getUserAnalyses(userId, limit = 50) {\n        try {\n            // During migration, we need to query for both ObjectId and email formats\n            let reports = await db_src_repositories_AnalysisReportRepository__WEBPACK_IMPORTED_MODULE_1__.analysisReportRepository.findByUserId(userId, limit);\n            // If no reports found and userId looks like an ObjectId, also try finding by email\n            if (reports.length === 0 && userId.length === 24 && !userId.includes(\"@\")) {\n                try {\n                    const { userRepository } = await __webpack_require__.e(/*! import() */ \"_rsc_packages_db_src_repositories_UserRepository_ts-_bf461\").then(__webpack_require__.bind(__webpack_require__, /*! db/src/repositories/UserRepository */ \"(rsc)/../../packages/db/src/repositories/UserRepository.ts\"));\n                    const user = await userRepository.findById(userId);\n                    if (user && user.email) {\n                        // Try finding reports by email for migration compatibility\n                        const emailReports = await db_src_repositories_AnalysisReportRepository__WEBPACK_IMPORTED_MODULE_1__.analysisReportRepository.findByUserId(user.email, limit);\n                        reports = [\n                            ...reports,\n                            ...emailReports\n                        ];\n                        console.log(`Migration: Found ${emailReports.length} reports by email for user ObjectId ${userId}`);\n                    }\n                } catch (error) {\n                    console.error(\"Error during migration-compatible user analysis lookup:\", error);\n                }\n            }\n            return reports;\n        } catch (error) {\n            throw new _errors_AnalysisError__WEBPACK_IMPORTED_MODULE_2__.AnalysisError(`Failed to get user analyses: ${error instanceof Error ? error.message : String(error)}`, error);\n        }\n    }\n    /**\n   * Delete an analysis report\n   */ async deleteAnalysis(reportId, userId) {\n        try {\n            // Use getAnalysisStatus for access control (handles migration compatibility)\n            const report = await this.getAnalysisStatus(reportId, userId);\n            if (!report) {\n                return false;\n            }\n            return await db_src_repositories_AnalysisReportRepository__WEBPACK_IMPORTED_MODULE_1__.analysisReportRepository.deleteById(reportId);\n        } catch (error) {\n            throw new _errors_AnalysisError__WEBPACK_IMPORTED_MODULE_2__.AnalysisError(`Failed to delete analysis: ${error instanceof Error ? error.message : String(error)}`, error);\n        }\n    }\n    /**\n   * Test the analysis service\n   */ async testService() {\n        const results = {\n            geminiConnection: false,\n            database: false,\n            overall: false\n        };\n        try {\n            if (this.client) {\n                // Test with simple content\n                const response = await this.client.models.generateContent({\n                    model: this.modelName,\n                    contents: [\n                        {\n                            text: 'Respond with exactly: {\"test\": \"success\"}'\n                        }\n                    ]\n                });\n                if (response.text && response.text.includes(\"success\")) {\n                    results.geminiConnection = true;\n                }\n            }\n        } catch (error) {\n            console.error(\"Gemini connection test failed:\", error);\n        }\n        try {\n            await db_src_repositories_AnalysisReportRepository__WEBPACK_IMPORTED_MODULE_1__.analysisReportRepository.countByUserId(\"test-user-id\");\n            results.database = true;\n        } catch (error) {\n            console.error(\"Database test failed:\", error);\n        }\n        results.overall = results.geminiConnection && results.database;\n        return results;\n    }\n}\n// Export singleton instance for use in API routes\nconst analysisService = new AnalysisService();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3NlcnZpY2VzL0FuYWx5c2lzU2VydmljZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBNEM7QUFDNEM7QUFDaEM7QUFFakI7QUFDWDtBQUU1Qjs7O0NBR0MsR0FDTSxNQUFNSztJQUtYQyxhQUFjO1FBQ1osSUFBSSxDQUFDQyxnQkFBZ0IsR0FBRyxDQUFDLENBQUNDLFFBQVFDLEdBQUcsQ0FBQ0MsY0FBYztRQUNwRCxJQUFJLENBQUNDLFNBQVMsR0FBR0gsUUFBUUMsR0FBRyxDQUFDRyxZQUFZLElBQUk7UUFFN0MsSUFBSSxDQUFDLElBQUksQ0FBQ0wsZ0JBQWdCLEVBQUU7WUFDMUJNLFFBQVFDLElBQUksQ0FBQztZQUNiLElBQUksQ0FBQ0MsTUFBTSxHQUFHO1lBQ2Q7UUFDRjtRQUVBLElBQUksQ0FBQ0EsTUFBTSxHQUFHLElBQUlmLHNEQUFXQSxDQUFDO1lBQzVCZ0IsUUFBUVIsUUFBUUMsR0FBRyxDQUFDQyxjQUFjO1FBQ3BDO0lBQ0Y7SUFFQTs7Ozs7OztHQU9DLEdBQ0QsTUFBTU8sZ0JBQ0pDLFFBQWdCLEVBQ2hCQyxjQUF3QixFQUN4QkMsTUFBYyxFQUNkQyxVQUdJLENBQUMsQ0FBQyxFQUNXO1FBQ2pCLE1BQU1DLFlBQVlDLEtBQUtDLEdBQUc7UUFFMUIsSUFBSTtZQUNGWCxRQUFRWSxHQUFHLENBQUMsQ0FBQywyQ0FBMkMsRUFBRVAsU0FBUyxNQUFNLEVBQUVDLGVBQWVPLE1BQU0sQ0FBQyxNQUFNLENBQUM7WUFFeEcsa0JBQWtCO1lBQ2xCLElBQUksQ0FBQ1Asa0JBQWtCQSxlQUFlTyxNQUFNLEtBQUssR0FBRztnQkFDbEQsTUFBTSxJQUFJeEIsZ0VBQWFBLENBQUM7WUFDMUI7WUFFQSxJQUFJLENBQUNrQixRQUFRO2dCQUNYLE1BQU0sSUFBSWxCLGdFQUFhQSxDQUFDO1lBQzFCO1lBRUEsd0NBQXdDO1lBQ3hDLE1BQU15QixjQUFjTixRQUFRTSxXQUFXLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxJQUFJSixPQUFP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QU0sQ0FBQ0MsZUFBZSxDQUFDO29CQUN4REMsT0FBTyxJQUFJLENBQUN4RSxTQUFTO29CQUNyQjBDLFVBQVU7d0JBQUM7NEJBQUVFLE1BQU07d0JBQTRDO3FCQUFFO2dCQUNuRTtnQkFFQSxJQUFJeUIsU0FBU3pCLElBQUksSUFBSXlCLFNBQVN6QixJQUFJLENBQUNTLFFBQVEsQ0FBQyxZQUFZO29CQUN0RHNHLFFBQVFDLGdCQUFnQixHQUFHO2dCQUM3QjtZQUNGO1FBQ0YsRUFBRSxPQUFPeEgsT0FBTztZQUNkbEMsUUFBUWtDLEtBQUssQ0FBQyxrQ0FBa0NBO1FBQ2xEO1FBRUEsSUFBSTtZQUNGLE1BQU05QyxrR0FBd0JBLENBQUN5SyxhQUFhLENBQUM7WUFDN0NKLFFBQVFFLFFBQVEsR0FBRztRQUNyQixFQUFFLE9BQU96SCxPQUFPO1lBQ2RsQyxRQUFRa0MsS0FBSyxDQUFDLHlCQUF5QkE7UUFDekM7UUFFQXVILFFBQVFHLE9BQU8sR0FBR0gsUUFBUUMsZ0JBQWdCLElBQUlELFFBQVFFLFFBQVE7UUFFOUQsT0FBT0Y7SUFDVDtBQUNGO0FBRUEsa0RBQWtEO0FBQzNDLE1BQU1LLGtCQUFrQixJQUFJdEssa0JBQWtCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2ViLy4vc3JjL2xpYi9zZXJ2aWNlcy9BbmFseXNpc1NlcnZpY2UudHM/MmVhYSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBHb29nbGVHZW5BSSB9IGZyb20gJ0Bnb29nbGUvZ2VuYWknO1xuaW1wb3J0IHsgYW5hbHlzaXNSZXBvcnRSZXBvc2l0b3J5IH0gZnJvbSAnZGIvc3JjL3JlcG9zaXRvcmllcy9BbmFseXNpc1JlcG9ydFJlcG9zaXRvcnknO1xuaW1wb3J0IHsgQW5hbHlzaXNFcnJvciB9IGZyb20gJy4uL2Vycm9ycy9BbmFseXNpc0Vycm9yJztcbmltcG9ydCB7IENyZWF0ZUFuYWx5c2lzUmVwb3J0RGF0YSwgQW5hbHlzaXNSZXBvcnQgfSBmcm9tICdsaWIvc3JjL3R5cGVzJztcbmltcG9ydCB7IHJlYWRGaWxlIH0gZnJvbSAnZnMvcHJvbWlzZXMnO1xuaW1wb3J0IHsgam9pbiB9IGZyb20gJ3BhdGgnO1xuXG4vKipcbiAqIEVuaGFuY2VkIGFuYWx5c2lzIHNlcnZpY2UgdXNpbmcgR2VtaW5pJ3MgbmF0aXZlIGRvY3VtZW50IHByb2Nlc3NpbmcgY2FwYWJpbGl0aWVzXG4gKiBUaGlzIHNlcnZpY2UgYnlwYXNzZXMgdGV4dCBleHRyYWN0aW9uIGFuZCB1c2VzIEdlbWluaSdzIGRvY3VtZW50IHVuZGVyc3RhbmRpbmcgZGlyZWN0bHlcbiAqL1xuZXhwb3J0IGNsYXNzIEFuYWx5c2lzU2VydmljZSB7XG4gIHByaXZhdGUgY2xpZW50OiBHb29nbGVHZW5BSSB8IG51bGw7XG4gIHByaXZhdGUgcmVhZG9ubHkgbW9kZWxOYW1lOiBzdHJpbmc7XG4gIHByaXZhdGUgcmVhZG9ubHkgYXBpS2V5Q29uZmlndXJlZDogYm9vbGVhbjtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmFwaUtleUNvbmZpZ3VyZWQgPSAhIXByb2Nlc3MuZW52LkdFTUlOSV9BUElfS0VZO1xuICAgIHRoaXMubW9kZWxOYW1lID0gcHJvY2Vzcy5lbnYuR0VNSU5JX01PREVMIHx8ICdnZW1pbmktMi41LWZsYXNoJztcbiAgICBcbiAgICBpZiAoIXRoaXMuYXBpS2V5Q29uZmlndXJlZCkge1xuICAgICAgY29uc29sZS53YXJuKCdHRU1JTklfQVBJX0tFWSBub3QgY29uZmlndXJlZCAtIEFJIGFuYWx5c2lzIHdpbGwgYmUgc2tpcHBlZCcpO1xuICAgICAgdGhpcy5jbGllbnQgPSBudWxsO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuY2xpZW50ID0gbmV3IEdvb2dsZUdlbkFJKHsgXG4gICAgICBhcGlLZXk6IHByb2Nlc3MuZW52LkdFTUlOSV9BUElfS0VZIVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFByb2Nlc3MgYW5hbHlzaXMgZm9yIHVwbG9hZGVkIGZpbGVzIHVzaW5nIG5hdGl2ZSBHZW1pbmkgZG9jdW1lbnQgdW5kZXJzdGFuZGluZ1xuICAgKiBAcGFyYW0gdXBsb2FkSWQgLSBVbmlxdWUgaWRlbnRpZmllciBmb3IgdGhlIHVwbG9hZCBiYXRjaFxuICAgKiBAcGFyYW0gZmlsZVJlZmVyZW5jZXMgLSBBcnJheSBvZiBsb2NhbCBmaWxlIHBhdGhzIGZvciB1cGxvYWRlZCBmaWxlc1xuICAgKiBAcGFyYW0gdXNlcklkIC0gVXNlciBJRCB3aG8gb3ducyB0aGUgZmlsZXNcbiAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBjb25maWd1cmF0aW9uXG4gICAqIEByZXR1cm5zIEFuYWx5c2lzIHJlcG9ydCBJRFxuICAgKi9cbiAgYXN5bmMgcHJvY2Vzc0FuYWx5c2lzKFxuICAgIHVwbG9hZElkOiBzdHJpbmcsXG4gICAgZmlsZVJlZmVyZW5jZXM6IHN0cmluZ1tdLFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIG9wdGlvbnM6IHtcbiAgICAgIHJlcG9ydFRpdGxlPzogc3RyaW5nO1xuICAgICAgcHJpb3JpdHk/OiAnbG93JyB8ICdub3JtYWwnIHwgJ2hpZ2gnO1xuICAgIH0gPSB7fVxuICApOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGNvbnNvbGUubG9nKGBTdGFydGluZyBHZW1pbmkgbmF0aXZlIGFuYWx5c2lzIGZvciB1cGxvYWQgJHt1cGxvYWRJZH0gd2l0aCAke2ZpbGVSZWZlcmVuY2VzLmxlbmd0aH0gZmlsZXNgKTtcblxuICAgICAgLy8gVmFsaWRhdGUgaW5wdXRzXG4gICAgICBpZiAoIWZpbGVSZWZlcmVuY2VzIHx8IGZpbGVSZWZlcmVuY2VzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgQW5hbHlzaXNFcnJvcignTm8gZmlsZSByZWZlcmVuY2VzIHByb3ZpZGVkIGZvciBhbmFseXNpcycpO1xuICAgICAgfVxuXG4gICAgICBpZiAoIXVzZXJJZCkge1xuICAgICAgICB0aHJvdyBuZXcgQW5hbHlzaXNFcnJvcignVXNlciBJRCBpcyByZXF1aXJlZCBmb3IgYW5hbHlzaXMnKTtcbiAgICAgIH1cblxuICAgICAgLy8gQ3JlYXRlIGluaXRpYWwgYW5hbHlzaXMgcmVwb3J0IHJlY29yZFxuICAgICAgY29uc3QgcmVwb3J0VGl0bGUgPSBvcHRpb25zLnJlcG9ydFRpdGxlIHx8IGBGaW5hbmNpYWwgQW5hbHlzaXMgLSAke25ldyBEYXRlKCkudG9Mb2NhbGVEYXRlU3RyaW5nKCl9YDtcbiAgICAgIGNvbnN0IGFuYWx5c2lzUmVwb3J0ID0gYXdhaXQgdGhpcy5jcmVhdGVJbml0aWFsUmVwb3J0KHtcbiAgICAgICAgdXNlcklkLFxuICAgICAgICB1cGxvYWRJZCxcbiAgICAgICAgcmVwb3J0VGl0bGUsXG4gICAgICAgIHNvdXJjZURvY3VtZW50Q291bnQ6IGZpbGVSZWZlcmVuY2VzLmxlbmd0aCxcbiAgICAgICAgc3RhdHVzOiAncHJvY2Vzc2luZycsXG4gICAgICAgIHByb2dyZXNzOiAwLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnNvbGUubG9nKGBDcmVhdGVkIGFuYWx5c2lzIHJlcG9ydCAke2FuYWx5c2lzUmVwb3J0Ll9pZH1gKTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gVXBkYXRlIHByb2dyZXNzOiBTdGFydGluZyBmaWxlIHByb2Nlc3NpbmdcbiAgICAgICAgYXdhaXQgdGhpcy51cGRhdGVQcm9ncmVzcyhhbmFseXNpc1JlcG9ydC5faWQsIDIwLCAnUHJvY2Vzc2luZyBkb2N1bWVudHMgd2l0aCBBSS4uLicpO1xuXG4gICAgICAgIC8vIFByb2Nlc3MgZmlsZXMgZGlyZWN0bHkgd2l0aCBHZW1pbmlcbiAgICAgICAgY29uc3QgYW5hbHlzaXNSZXN1bHRzID0gYXdhaXQgdGhpcy5hbmFseXplRG9jdW1lbnRzV2l0aEdlbWluaShmaWxlUmVmZXJlbmNlcywgdXNlcklkKTtcblxuICAgICAgICBjb25zb2xlLmxvZygnR2VtaW5pIG5hdGl2ZSBhbmFseXNpcyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5Jyk7XG5cbiAgICAgICAgLy8gVXBkYXRlIHByb2dyZXNzOiBBbmFseXNpcyBjb21wbGV0ZSwgc2F2aW5nIHJlc3VsdHNcbiAgICAgICAgYXdhaXQgdGhpcy51cGRhdGVQcm9ncmVzcyhhbmFseXNpc1JlcG9ydC5faWQsIDgwLCAnU2F2aW5nIGFuYWx5c2lzIHJlc3VsdHMuLi4nKTtcblxuICAgICAgICAvLyBFbmhhbmNlIGFuYWx5c2lzIHJlc3VsdHMgd2l0aCBtZXRhZGF0YVxuICAgICAgICBjb25zdCBlbmhhbmNlZFJlc3VsdHMgPSB7XG4gICAgICAgICAgLi4uYW5hbHlzaXNSZXN1bHRzLFxuICAgICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgICBwcm9jZXNzaW5nVGltZTogRGF0ZS5ub3coKSAtIHN0YXJ0VGltZSxcbiAgICAgICAgICAgIGZpbGVzUHJvY2Vzc2VkOiBmaWxlUmVmZXJlbmNlcy5sZW5ndGgsXG4gICAgICAgICAgICBhbmFseXNpc1RpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgbW9kZWxVc2VkOiB0aGlzLm1vZGVsTmFtZSxcbiAgICAgICAgICAgIHVzZU5hdGl2ZURvY3VtZW50VW5kZXJzdGFuZGluZzogdHJ1ZVxuICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBTYXZlIGFuYWx5c2lzIHJlc3VsdHMgdG8gZGF0YWJhc2VcbiAgICAgICAgYXdhaXQgdGhpcy5jb21wbGV0ZUFuYWx5c2lzKGFuYWx5c2lzUmVwb3J0Ll9pZCwgZW5oYW5jZWRSZXN1bHRzKTtcblxuICAgICAgICBjb25zb2xlLmxvZyhgQW5hbHlzaXMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseSBmb3IgcmVwb3J0ICR7YW5hbHlzaXNSZXBvcnQuX2lkfWApO1xuICAgICAgICByZXR1cm4gYW5hbHlzaXNSZXBvcnQuX2lkO1xuXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAvLyBNYXJrIGFuYWx5c2lzIGFzIGZhaWxlZFxuICAgICAgICBhd2FpdCB0aGlzLm1hcmtBbmFseXNpc0ZhaWxlZChhbmFseXNpc1JlcG9ydC5faWQsIGVycm9yKTtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignQW5hbHlzaXMgZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIFxuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgQW5hbHlzaXNFcnJvcikge1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgdGhyb3cgbmV3IEFuYWx5c2lzRXJyb3IoXG4gICAgICAgIGBGYWlsZWQgdG8gcHJvY2VzcyBmaW5hbmNpYWwgYW5hbHlzaXM6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpfWAsXG4gICAgICAgIGVycm9yXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBbmFseXplIGRvY3VtZW50cyB1c2luZyBHZW1pbmkncyBuYXRpdmUgZG9jdW1lbnQgdW5kZXJzdGFuZGluZ1xuICAgKiBAcGFyYW0gZmlsZVJlZmVyZW5jZXMgLSBBcnJheSBvZiBmaWxlIHJlZmVyZW5jZXMgKGxvY2FsOi8vIHBhdGhzKVxuICAgKiBAcGFyYW0gdXNlcklkIC0gVXNlciBJRCBmb3IgYWNjZXNzIGNvbnRyb2xcbiAgICogQHJldHVybnMgQW5hbHlzaXMgcmVzdWx0cyBmcm9tIEdlbWluaVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBhbmFseXplRG9jdW1lbnRzV2l0aEdlbWluaShcbiAgICBmaWxlUmVmZXJlbmNlczogc3RyaW5nW10sXG4gICAgdXNlcklkOiBzdHJpbmdcbiAgKTogUHJvbWlzZTxhbnk+IHtcbiAgICBpZiAoIXRoaXMuY2xpZW50KSB7XG4gICAgICBjb25zb2xlLmxvZygnR2VtaW5pIGNsaWVudCBub3QgYXZhaWxhYmxlLCByZXR1cm5pbmcgcGxhY2Vob2xkZXIgYW5hbHlzaXMnKTtcbiAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRlUGxhY2Vob2xkZXJBbmFseXNpcyhmaWxlUmVmZXJlbmNlcyk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIC8vIFByZXBhcmUgZG9jdW1lbnQgY29udGVudHMgZm9yIEdlbWluaVxuICAgICAgY29uc3QgY29udGVudHMgPSBbXTtcbiAgICAgIFxuICAgICAgLy8gQWRkIHRoZSBmaW5hbmNpYWwgYW5hbHlzaXMgcHJvbXB0XG4gICAgICBjb250ZW50cy5wdXNoKHtcbiAgICAgICAgdGV4dDogYFlvdSBhcmUgYSBmaW5hbmNpYWwgYW5hbHlzdCBBSS4gQW5hbHl6ZSB0aGUgZm9sbG93aW5nIGJhbmsgc3RhdGVtZW50L2ZpbmFuY2lhbCBkb2N1bWVudHMgYW5kIHByb3ZpZGUgYSBjb21wcmVoZW5zaXZlIGZpbmFuY2lhbCBhbmFseXNpcy5cblxuUGxlYXNlIGFuYWx5emUgdGhpcyBmaW5hbmNpYWwgZGF0YSBhbmQgcmV0dXJuIGEgSlNPTiByZXNwb25zZSB3aXRoIHRoZSBmb2xsb3dpbmcgc3RydWN0dXJlOlxue1xuICBcInRvdGFsSW5jb21lXCI6IG51bWJlcixcbiAgXCJ0b3RhbEV4cGVuc2VzXCI6IG51bWJlcixcbiAgXCJuZXRDYXNoRmxvd1wiOiBudW1iZXIsXG4gIFwiY2F0ZWdvcmllc1wiOiB7XG4gICAgXCJpbmNvbWVcIjogW1xuICAgICAgeyBcImNhdGVnb3J5XCI6IFwic3RyaW5nXCIsIFwiYW1vdW50XCI6IG51bWJlciwgXCJwZXJjZW50YWdlXCI6IG51bWJlciB9XG4gICAgXSxcbiAgICBcImV4cGVuc2VzXCI6IFtcbiAgICAgIHsgXCJjYXRlZ29yeVwiOiBcInN0cmluZ1wiLCBcImFtb3VudFwiOiBudW1iZXIsIFwicGVyY2VudGFnZVwiOiBudW1iZXIgfVxuICAgIF1cbiAgfSxcbiAgXCJtb250aGx5VHJlbmRzXCI6IFtcbiAgICB7IFwibW9udGhcIjogXCJzdHJpbmdcIiwgXCJpbmNvbWVcIjogbnVtYmVyLCBcImV4cGVuc2VzXCI6IG51bWJlciB9XG4gIF0sXG4gIFwiaW5zaWdodHNcIjogW1xuICAgIHsgXCJ0eXBlXCI6IFwic3RyaW5nXCIsIFwiZGVzY3JpcHRpb25cIjogXCJzdHJpbmdcIiwgXCJzZXZlcml0eVwiOiBcImxvd3xtZWRpdW18aGlnaFwiIH1cbiAgXSxcbiAgXCJyZWNvbW1lbmRhdGlvbnNcIjogW1xuICAgIHsgXCJjYXRlZ29yeVwiOiBcInN0cmluZ1wiLCBcInN1Z2dlc3Rpb25cIjogXCJzdHJpbmdcIiwgXCJwb3RlbnRpYWxTYXZpbmdzXCI6IG51bWJlciB9XG4gIF0sXG4gIFwic3VtbWFyeVwiOiBcInN0cmluZ1wiXG59XG5cbkZvY3VzIG9uOlxuMS4gQ2F0ZWdvcml6aW5nIHRyYW5zYWN0aW9ucyAoc2FsYXJ5LCBncm9jZXJpZXMsIHV0aWxpdGllcywgZW50ZXJ0YWlubWVudCwgZXRjLilcbjIuIElkZW50aWZ5aW5nIHNwZW5kaW5nIHBhdHRlcm5zIGFuZCB0cmVuZHNcbjMuIENhbGN1bGF0aW5nIHRvdGFscyBhbmQgcGVyY2VudGFnZXNcbjQuIFByb3ZpZGluZyBhY3Rpb25hYmxlIGluc2lnaHRzIGFuZCByZWNvbW1lbmRhdGlvbnNcbjUuIEhpZ2hsaWdodGluZyBhbnkgdW51c3VhbCBvciBjb25jZXJuaW5nIHBhdHRlcm5zXG5cbkltcG9ydGFudCBndWlkZWxpbmVzOlxuLSBFbnN1cmUgYWxsIGFtb3VudHMgYXJlIHBvc2l0aXZlIG51bWJlcnNcbi0gUGVyY2VudGFnZXMgc2hvdWxkIGJlIGNhbGN1bGF0ZWQgYWNjdXJhdGVseSBhbmQgc3VtIHRvIDEwMCBmb3IgZWFjaCBjYXRlZ29yeSB0eXBlXG4tIFByb3ZpZGUgbWVhbmluZ2Z1bCBpbnNpZ2h0cyBiYXNlZCBvbiB0aGUgZGF0YSBwYXR0ZXJuc1xuLSBJbmNsdWRlIGF0IGxlYXN0IDMtNSBhY3Rpb25hYmxlIHJlY29tbWVuZGF0aW9uc1xuLSBDYXRlZ29yaXplIGV4cGVuc2VzIGludG8gY29tbW9uIGNhdGVnb3JpZXMgbGlrZTogSG91c2luZywgVHJhbnNwb3J0YXRpb24sIEZvb2QsIEVudGVydGFpbm1lbnQsIEhlYWx0aGNhcmUsIFV0aWxpdGllcywgU2hvcHBpbmcsIGV0Yy5cbi0gRm9yIGluY29tZSwgY2F0ZWdvcml6ZSBpbnRvOiBTYWxhcnksIEZyZWVsYW5jZSwgSW52ZXN0bWVudCwgQmVuZWZpdHMsIGV0Yy5cbi0gT25seSByZXR1cm4gdmFsaWQgSlNPTiB3aXRob3V0IGFueSBtYXJrZG93biBmb3JtYXR0aW5nIG9yIGFkZGl0aW9uYWwgdGV4dFxuLSBJZiBkYXRhIGlzIGluc3VmZmljaWVudCBmb3IgY2VydGFpbiBmaWVsZHMsIHVzZSByZWFzb25hYmxlIGRlZmF1bHRzICgwIGZvciBhbW91bnRzLCBlbXB0eSBhcnJheXMgZm9yIGNhdGVnb3JpZXMpYFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFByb2Nlc3MgZWFjaCBmaWxlXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZpbGVSZWZlcmVuY2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGZpbGVSZWYgPSBmaWxlUmVmZXJlbmNlc1tpXTtcbiAgICAgICAgY29uc29sZS5sb2coYFByb2Nlc3NpbmcgZmlsZSAke2kgKyAxfS8ke2ZpbGVSZWZlcmVuY2VzLmxlbmd0aH06ICR7ZmlsZVJlZn1gKTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgIGlmIChmaWxlUmVmLnN0YXJ0c1dpdGgoJ2xvY2FsOi8vJykpIHtcbiAgICAgICAgICAgIC8vIEhhbmRsZSBsb2NhbCBmaWxlXG4gICAgICAgICAgICBjb25zdCBsb2NhbFBhdGggPSBmaWxlUmVmLnJlcGxhY2UoJ2xvY2FsOi8vJywgJycpO1xuICAgICAgICAgICAgY29uc3QgY3VycmVudERpciA9IHByb2Nlc3MuY3dkKCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgUHJvY2VzcyBDV0Q6ICR7Y3VycmVudERpcn1gKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gTW9yZSByb2J1c3QgcGF0aCByZXNvbHV0aW9uIC0gY2hlY2sgaWYgd2UncmUgaW4gdGhlIGNvcnJlY3QgZGlyZWN0b3J5XG4gICAgICAgICAgICBsZXQgZmlsZVBhdGg6IHN0cmluZztcbiAgICAgICAgICAgIGlmIChjdXJyZW50RGlyLmluY2x1ZGVzKCdiYW5rX3N0YXRlbWVudCcpKSB7XG4gICAgICAgICAgICAgIC8vIFdlJ3JlIGluIHRoZSByaWdodCBwcm9qZWN0IGRpcmVjdG9yeVxuICAgICAgICAgICAgICBmaWxlUGF0aCA9IGpvaW4oY3VycmVudERpciwgJ2FwcHMnLCAnd2ViJywgJ3VwbG9hZHMnLCBsb2NhbFBhdGgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgLy8gV2UgbWlnaHQgYmUgaW4gdGhlIHdyb25nIGRpcmVjdG9yeSwgY29uc3RydWN0IGZyb20gY3VycmVudCBkaXJlY3RvcnkgYnV0IGdvIHVwIHRvIGZpbmQgdGhlIHJpZ2h0IHBhdGhcbiAgICAgICAgICAgICAgY29uc3QgcGFydHMgPSBjdXJyZW50RGlyLnNwbGl0KCcvJyk7XG4gICAgICAgICAgICAgIGNvbnN0IHByb2plY3RSb290ID0gcGFydHMuc2xpY2UoMCwgLTEpLmpvaW4oJy8nKSArICcvYmFua19zdGF0ZW1lbnQnO1xuICAgICAgICAgICAgICBmaWxlUGF0aCA9IGpvaW4ocHJvamVjdFJvb3QsICdhcHBzJywgJ3dlYicsICd1cGxvYWRzJywgbG9jYWxQYXRoKTtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coYEFkanVzdGVkIHBhdGggZnJvbSAke2N1cnJlbnREaXJ9IHRvICR7cHJvamVjdFJvb3R9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBBdHRlbXB0aW5nIHRvIHJlYWQgZmlsZSBhdDogJHtmaWxlUGF0aH1gKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gUmVhZCBmaWxlIGFzIGJ1ZmZlclxuICAgICAgICAgICAgY29uc3QgZmlsZUJ1ZmZlciA9IGF3YWl0IHJlYWRGaWxlKGZpbGVQYXRoKTtcbiAgICAgICAgICAgIGNvbnN0IGZpbGVuYW1lID0gdGhpcy5leHRyYWN0RmlsZW5hbWUoZmlsZVJlZikgfHwgYGRvY3VtZW50LSR7aSArIDF9YDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gRGV0ZXJtaW5lIGZpbGUgdHlwZVxuICAgICAgICAgICAgY29uc3QgZXh0ZW5zaW9uID0gbG9jYWxQYXRoLnRvTG93ZXJDYXNlKCkuc3BsaXQoJy4nKS5wb3AoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKGV4dGVuc2lvbiA9PT0gJ3BkZicpIHtcbiAgICAgICAgICAgICAgLy8gVXNlIEdlbWluaSdzIG5hdGl2ZSBQREYgcHJvY2Vzc2luZ1xuICAgICAgICAgICAgICBjb250ZW50cy5wdXNoKHtcbiAgICAgICAgICAgICAgICBpbmxpbmVEYXRhOiB7XG4gICAgICAgICAgICAgICAgICBtaW1lVHlwZTogJ2FwcGxpY2F0aW9uL3BkZicsXG4gICAgICAgICAgICAgICAgICBkYXRhOiBmaWxlQnVmZmVyLnRvU3RyaW5nKCdiYXNlNjQnKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGV4dGVuc2lvbiA9PT0gJ3R4dCcgfHwgZXh0ZW5zaW9uID09PSAnY3N2Jykge1xuICAgICAgICAgICAgICAvLyBGb3IgdGV4dCBmaWxlcywgYWRkIGFzIHRleHQgY29udGVudFxuICAgICAgICAgICAgICBjb25zdCB0ZXh0Q29udGVudCA9IGZpbGVCdWZmZXIudG9TdHJpbmcoJ3V0Zi04Jyk7XG4gICAgICAgICAgICAgIGNvbnRlbnRzLnB1c2goe1xuICAgICAgICAgICAgICAgIHRleHQ6IGBEb2N1bWVudDogJHtmaWxlbmFtZX1cXG5cXG4ke3RleHRDb250ZW50fWBcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYFVuc3VwcG9ydGVkIGZpbGUgdHlwZSBmb3IgJHtmaWxlbmFtZX0sIHNraXBwaW5nYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBwcm9jZXNzIGZpbGUgJHtmaWxlUmVmfTpgLCBlcnJvcik7XG4gICAgICAgICAgLy8gQ29udGludWUgd2l0aCBvdGhlciBmaWxlc1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIENhbGwgR2VtaW5pIEFQSVxuICAgICAgY29uc29sZS5sb2coJ1NlbmRpbmcgZG9jdW1lbnRzIHRvIEdlbWluaSBmb3IgYW5hbHlzaXMuLi4nKTtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5jbGllbnQubW9kZWxzLmdlbmVyYXRlQ29udGVudCh7XG4gICAgICAgIG1vZGVsOiB0aGlzLm1vZGVsTmFtZSxcbiAgICAgICAgY29udGVudHNcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXJlc3BvbnNlIHx8ICFyZXNwb25zZS50ZXh0KSB7XG4gICAgICAgIHRocm93IG5ldyBBbmFseXNpc0Vycm9yKCdFbXB0eSByZXNwb25zZSBmcm9tIEdlbWluaSBBUEknKTtcbiAgICAgIH1cblxuICAgICAgLy8gUGFyc2UgSlNPTiByZXNwb25zZVxuICAgICAgY29uc3QgY2xlYW5lZFRleHQgPSB0aGlzLmNsZWFuSnNvblJlc3BvbnNlKHJlc3BvbnNlLnRleHQpO1xuICAgICAgY29uc3QgYW5hbHlzaXNEYXRhID0gSlNPTi5wYXJzZShjbGVhbmVkVGV4dCk7XG4gICAgICBcbiAgICAgIHJldHVybiB0aGlzLnZhbGlkYXRlQW5hbHlzaXNTdHJ1Y3R1cmUoYW5hbHlzaXNEYXRhKTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdHZW1pbmkgYW5hbHlzaXMgZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIFxuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgQW5hbHlzaXNFcnJvcikge1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgdGhyb3cgbmV3IEFuYWx5c2lzRXJyb3IoXG4gICAgICAgIGBHZW1pbmkgZG9jdW1lbnQgYW5hbHlzaXMgZmFpbGVkOiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKX1gLFxuICAgICAgICBlcnJvclxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2xlYW4gSlNPTiByZXNwb25zZSBmcm9tIHBvdGVudGlhbCBtYXJrZG93biBmb3JtYXR0aW5nXG4gICAqIEBwYXJhbSB0ZXh0IC0gUmF3IHJlc3BvbnNlIHRleHRcbiAgICogQHJldHVybnMgQ2xlYW5lZCBKU09OIHN0cmluZ1xuICAgKi9cbiAgcHJpdmF0ZSBjbGVhbkpzb25SZXNwb25zZSh0ZXh0OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIC8vIFJlbW92ZSBtYXJrZG93biBjb2RlIGJsb2NrcyBpZiBwcmVzZW50XG4gICAgbGV0IGNsZWFuZWQgPSB0ZXh0LnJlcGxhY2UoL2BgYGpzb25cXHMqL2csICcnKS5yZXBsYWNlKC9gYGBcXHMqL2csICcnKTtcbiAgICBcbiAgICAvLyBSZW1vdmUgYW55IGxlYWRpbmcvdHJhaWxpbmcgd2hpdGVzcGFjZVxuICAgIGNsZWFuZWQgPSBjbGVhbmVkLnRyaW0oKTtcbiAgICBcbiAgICAvLyBJZiB0aGUgcmVzcG9uc2Ugc3RhcnRzIHdpdGggZXhwbGFuYXRpb24gdGV4dCwgdHJ5IHRvIGV4dHJhY3QganVzdCB0aGUgSlNPTlxuICAgIGlmICghY2xlYW5lZC5zdGFydHNXaXRoKCd7JykpIHtcbiAgICAgIGNvbnN0IGpzb25NYXRjaCA9IGNsZWFuZWQubWF0Y2goL1xce1tcXHNcXFNdKlxcfS8pO1xuICAgICAgaWYgKGpzb25NYXRjaCkge1xuICAgICAgICBjbGVhbmVkID0ganNvbk1hdGNoWzBdO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gY2xlYW5lZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSB0aGUgc3RydWN0dXJlIG9mIHRoZSBBSSBhbmFseXNpcyByZXNwb25zZVxuICAgKiBAcGFyYW0gZGF0YSAtIFJhdyBhbmFseXNpcyBkYXRhIGZyb20gQUlcbiAgICogQHJldHVybnMgVmFsaWRhdGVkIGFuZCBub3JtYWxpemVkIGFuYWx5c2lzIGRhdGFcbiAgICovXG4gIHByaXZhdGUgdmFsaWRhdGVBbmFseXNpc1N0cnVjdHVyZShkYXRhOiBhbnkpOiBhbnkge1xuICAgIGlmICghZGF0YSB8fCB0eXBlb2YgZGF0YSAhPT0gJ29iamVjdCcpIHtcbiAgICAgIHRocm93IG5ldyBBbmFseXNpc0Vycm9yKCdBSSByZXNwb25zZSBpcyBub3QgYSB2YWxpZCBvYmplY3QnKTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayByZXF1aXJlZCBmaWVsZHNcbiAgICBjb25zdCByZXF1aXJlZEZpZWxkcyA9IFsndG90YWxJbmNvbWUnLCAndG90YWxFeHBlbnNlcycsICdjYXRlZ29yaWVzJywgJ2luc2lnaHRzJywgJ3JlY29tbWVuZGF0aW9ucycsICdzdW1tYXJ5J107XG4gICAgY29uc3QgbWlzc2luZ0ZpZWxkcyA9IHJlcXVpcmVkRmllbGRzLmZpbHRlcihmaWVsZCA9PiAhKGZpZWxkIGluIGRhdGEpKTtcbiAgICBcbiAgICBpZiAobWlzc2luZ0ZpZWxkcy5sZW5ndGggPiAwKSB7XG4gICAgICB0aHJvdyBuZXcgQW5hbHlzaXNFcnJvcihgTWlzc2luZyByZXF1aXJlZCBmaWVsZHMgaW4gQUkgcmVzcG9uc2U6ICR7bWlzc2luZ0ZpZWxkcy5qb2luKCcsICcpfWApO1xuICAgIH1cblxuICAgIC8vIFZhbGlkYXRlIGFuZCBub3JtYWxpemUgbnVtZXJpYyBmaWVsZHNcbiAgICBkYXRhLnRvdGFsSW5jb21lID0gdGhpcy52YWxpZGF0ZU51bWJlcihkYXRhLnRvdGFsSW5jb21lLCAndG90YWxJbmNvbWUnKTtcbiAgICBkYXRhLnRvdGFsRXhwZW5zZXMgPSB0aGlzLnZhbGlkYXRlTnVtYmVyKGRhdGEudG90YWxFeHBlbnNlcywgJ3RvdGFsRXhwZW5zZXMnKTtcbiAgICBcbiAgICAvLyBDYWxjdWxhdGUgbmV0Q2FzaEZsb3cgaWYgbm90IHByb3ZpZGVkIG9yIGluY29ycmVjdFxuICAgIGRhdGEubmV0Q2FzaEZsb3cgPSBkYXRhLnRvdGFsSW5jb21lIC0gZGF0YS50b3RhbEV4cGVuc2VzO1xuXG4gICAgLy8gVmFsaWRhdGUgY2F0ZWdvcmllcyBzdHJ1Y3R1cmVcbiAgICBpZiAoIWRhdGEuY2F0ZWdvcmllcyB8fCB0eXBlb2YgZGF0YS5jYXRlZ29yaWVzICE9PSAnb2JqZWN0Jykge1xuICAgICAgdGhyb3cgbmV3IEFuYWx5c2lzRXJyb3IoJ0NhdGVnb3JpZXMgZmllbGQgbXVzdCBiZSBhbiBvYmplY3QnKTtcbiAgICB9XG5cbiAgICBpZiAoIUFycmF5LmlzQXJyYXkoZGF0YS5jYXRlZ29yaWVzLmluY29tZSkpIHtcbiAgICAgIGRhdGEuY2F0ZWdvcmllcy5pbmNvbWUgPSBbXTtcbiAgICB9XG5cbiAgICBpZiAoIUFycmF5LmlzQXJyYXkoZGF0YS5jYXRlZ29yaWVzLmV4cGVuc2VzKSkge1xuICAgICAgZGF0YS5jYXRlZ29yaWVzLmV4cGVuc2VzID0gW107XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgYXJyYXlzXG4gICAgZGF0YS5tb250aGx5VHJlbmRzID0gQXJyYXkuaXNBcnJheShkYXRhLm1vbnRobHlUcmVuZHMpID8gZGF0YS5tb250aGx5VHJlbmRzIDogW107XG4gICAgZGF0YS5pbnNpZ2h0cyA9IEFycmF5LmlzQXJyYXkoZGF0YS5pbnNpZ2h0cykgPyBkYXRhLmluc2lnaHRzIDogW107XG4gICAgZGF0YS5yZWNvbW1lbmRhdGlvbnMgPSBBcnJheS5pc0FycmF5KGRhdGEucmVjb21tZW5kYXRpb25zKSA/IGRhdGEucmVjb21tZW5kYXRpb25zIDogW107XG5cbiAgICAvLyBFbnN1cmUgc3VtbWFyeSBpcyBhIHN0cmluZ1xuICAgIGlmICh0eXBlb2YgZGF0YS5zdW1tYXJ5ICE9PSAnc3RyaW5nJykge1xuICAgICAgZGF0YS5zdW1tYXJ5ID0gU3RyaW5nKGRhdGEuc3VtbWFyeSB8fCAnJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGRhdGE7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgcGxhY2Vob2xkZXIgYW5hbHlzaXMgd2hlbiBHZW1pbmkgaXMgbm90IGF2YWlsYWJsZVxuICAgKiBAcGFyYW0gZmlsZVJlZmVyZW5jZXMgLSBBcnJheSBvZiBmaWxlIHJlZmVyZW5jZXNcbiAgICogQHJldHVybnMgTW9jayBhbmFseXNpcyBkYXRhIHN0cnVjdHVyZVxuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZVBsYWNlaG9sZGVyQW5hbHlzaXMoZmlsZVJlZmVyZW5jZXM6IHN0cmluZ1tdKTogYW55IHtcbiAgICBjb25zdCBlc3RpbWF0ZWRJbmNvbWUgPSA1MDAwOyAvLyBNb2NrIGVzdGltYXRpb25cbiAgICBjb25zdCBlc3RpbWF0ZWRFeHBlbnNlcyA9IDM1MDA7XG5cbiAgICByZXR1cm4ge1xuICAgICAgdG90YWxJbmNvbWU6IGVzdGltYXRlZEluY29tZSxcbiAgICAgIHRvdGFsRXhwZW5zZXM6IGVzdGltYXRlZEV4cGVuc2VzLFxuICAgICAgbmV0Q2FzaEZsb3c6IGVzdGltYXRlZEluY29tZSAtIGVzdGltYXRlZEV4cGVuc2VzLFxuICAgICAgY2F0ZWdvcmllczoge1xuICAgICAgICBpbmNvbWU6IFtcbiAgICAgICAgICB7IGNhdGVnb3J5OiAnU2FsYXJ5JywgYW1vdW50OiBlc3RpbWF0ZWRJbmNvbWUgKiAwLjksIHBlcmNlbnRhZ2U6IDkwIH0sXG4gICAgICAgICAgeyBjYXRlZ29yeTogJ090aGVyIEluY29tZScsIGFtb3VudDogZXN0aW1hdGVkSW5jb21lICogMC4xLCBwZXJjZW50YWdlOiAxMCB9XG4gICAgICAgIF0sXG4gICAgICAgIGV4cGVuc2VzOiBbXG4gICAgICAgICAgeyBjYXRlZ29yeTogJ0hvdXNpbmcnLCBhbW91bnQ6IGVzdGltYXRlZEV4cGVuc2VzICogMC4zLCBwZXJjZW50YWdlOiAzMCB9LFxuICAgICAgICAgIHsgY2F0ZWdvcnk6ICdGb29kJywgYW1vdW50OiBlc3RpbWF0ZWRFeHBlbnNlcyAqIDAuMiwgcGVyY2VudGFnZTogMjAgfSxcbiAgICAgICAgICB7IGNhdGVnb3J5OiAnVHJhbnNwb3J0YXRpb24nLCBhbW91bnQ6IGVzdGltYXRlZEV4cGVuc2VzICogMC4xNSwgcGVyY2VudGFnZTogMTUgfSxcbiAgICAgICAgICB7IGNhdGVnb3J5OiAnVXRpbGl0aWVzJywgYW1vdW50OiBlc3RpbWF0ZWRFeHBlbnNlcyAqIDAuMSwgcGVyY2VudGFnZTogMTAgfSxcbiAgICAgICAgICB7IGNhdGVnb3J5OiAnRW50ZXJ0YWlubWVudCcsIGFtb3VudDogZXN0aW1hdGVkRXhwZW5zZXMgKiAwLjEsIHBlcmNlbnRhZ2U6IDEwIH0sXG4gICAgICAgICAgeyBjYXRlZ29yeTogJ090aGVyJywgYW1vdW50OiBlc3RpbWF0ZWRFeHBlbnNlcyAqIDAuMTUsIHBlcmNlbnRhZ2U6IDE1IH1cbiAgICAgICAgXVxuICAgICAgfSxcbiAgICAgIG1vbnRobHlUcmVuZHM6IFtcbiAgICAgICAgeyBtb250aDogJ0N1cnJlbnQnLCBpbmNvbWU6IGVzdGltYXRlZEluY29tZSwgZXhwZW5zZXM6IGVzdGltYXRlZEV4cGVuc2VzIH1cbiAgICAgIF0sXG4gICAgICBpbnNpZ2h0czogW1xuICAgICAgICB7IHR5cGU6ICdEZW1vIE1vZGUnLCBkZXNjcmlwdGlvbjogJ0FJIGFuYWx5c2lzIHJlcXVpcmVzIEdlbWluaSBBUEkga2V5IGNvbmZpZ3VyYXRpb24nLCBzZXZlcml0eTogJ2xvdycgfSxcbiAgICAgICAgeyB0eXBlOiAnRmlsZSBQcm9jZXNzaW5nJywgZGVzY3JpcHRpb246ICdGaWxlcyB1cGxvYWRlZCBzdWNjZXNzZnVsbHkgYW5kIHJlYWR5IGZvciBhbmFseXNpcycsIHNldmVyaXR5OiAnbG93JyB9XG4gICAgICBdLFxuICAgICAgcmVjb21tZW5kYXRpb25zOiBbXG4gICAgICAgIHsgY2F0ZWdvcnk6ICdTZXR1cCcsIHN1Z2dlc3Rpb246ICdDb25maWd1cmUgR2VtaW5pIEFQSSBrZXkgZm9yIHJlYWwgQUkgaW5zaWdodHMnLCBwb3RlbnRpYWxTYXZpbmdzOiAwIH0sXG4gICAgICAgIHsgY2F0ZWdvcnk6ICdBbmFseXNpcycsIHN1Z2dlc3Rpb246ICdVcGxvYWQgYmFuayBzdGF0ZW1lbnRzIGZvciBjb21wcmVoZW5zaXZlIGFuYWx5c2lzJywgcG90ZW50aWFsU2F2aW5nczogMCB9XG4gICAgICBdLFxuICAgICAgc3VtbWFyeTogYERlbW8gYW5hbHlzaXMgY29tcGxldGVkIGZvciAke2ZpbGVSZWZlcmVuY2VzLmxlbmd0aH0gZG9jdW1lbnQocykuIFRoaXMgaXMgcGxhY2Vob2xkZXIgZGF0YS4gQ29uZmlndXJlIEdFTUlOSV9BUElfS0VZIGZvciByZWFsIEFJLXBvd2VyZWQgaW5zaWdodHMuYCxcbiAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgIGlzUGxhY2Vob2xkZXJEYXRhOiB0cnVlXG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSBhbmQgbm9ybWFsaXplIGEgbnVtZXJpYyBmaWVsZFxuICAgKiBAcGFyYW0gdmFsdWUgLSBWYWx1ZSB0byB2YWxpZGF0ZVxuICAgKiBAcGFyYW0gZmllbGROYW1lIC0gTmFtZSBvZiB0aGUgZmllbGQgZm9yIGVycm9yIHJlcG9ydGluZ1xuICAgKiBAcmV0dXJucyBWYWxpZGF0ZWQgbnVtZXJpYyB2YWx1ZVxuICAgKi9cbiAgcHJpdmF0ZSB2YWxpZGF0ZU51bWJlcih2YWx1ZTogYW55LCBmaWVsZE5hbWU6IHN0cmluZyk6IG51bWJlciB7XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGNvbnN0IHBhcnNlZCA9IHBhcnNlRmxvYXQodmFsdWUpO1xuICAgICAgaWYgKCFpc05hTihwYXJzZWQpKSB7XG4gICAgICAgIHJldHVybiBNYXRoLm1heCgwLCBwYXJzZWQpO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyAmJiAhaXNOYU4odmFsdWUpKSB7XG4gICAgICByZXR1cm4gTWF0aC5tYXgoMCwgdmFsdWUpO1xuICAgIH1cbiAgICBcbiAgICBjb25zb2xlLndhcm4oYEludmFsaWQgJHtmaWVsZE5hbWV9IHZhbHVlOiAke3ZhbHVlfSwgZGVmYXVsdGluZyB0byAwYCk7XG4gICAgcmV0dXJuIDA7XG4gIH1cblxuICAvKipcbiAgICogRXh0cmFjdCBmaWxlbmFtZSBmcm9tIGZpbGUgVVJMXG4gICAqIEBwYXJhbSBmaWxlVXJsIC0gRmlsZSBVUkxcbiAgICogQHJldHVybnMgRXh0cmFjdGVkIGZpbGVuYW1lXG4gICAqL1xuICBwcml2YXRlIGV4dHJhY3RGaWxlbmFtZShmaWxlVXJsOiBzdHJpbmcpOiBzdHJpbmcgfCBudWxsIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcGFydHMgPSBmaWxlVXJsLnNwbGl0KCcvJyk7XG4gICAgICByZXR1cm4gcGFydHNbcGFydHMubGVuZ3RoIC0gMV0gfHwgbnVsbDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKGBGYWlsZWQgdG8gZXh0cmFjdCBmaWxlbmFtZSBmcm9tIFVSTDogJHtmaWxlVXJsfWApO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBpbml0aWFsIGFuYWx5c2lzIHJlcG9ydCBpbiB0aGUgZGF0YWJhc2VcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgY3JlYXRlSW5pdGlhbFJlcG9ydChyZXBvcnREYXRhOiBDcmVhdGVBbmFseXNpc1JlcG9ydERhdGEpOiBQcm9taXNlPEFuYWx5c2lzUmVwb3J0PiB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCBhbmFseXNpc1JlcG9ydFJlcG9zaXRvcnkuY3JlYXRlKHJlcG9ydERhdGEpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgQW5hbHlzaXNFcnJvcihcbiAgICAgICAgYEZhaWxlZCB0byBjcmVhdGUgYW5hbHlzaXMgcmVwb3J0OiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKX1gLFxuICAgICAgICBlcnJvclxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIGFuYWx5c2lzIHByb2dyZXNzXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHVwZGF0ZVByb2dyZXNzKHJlcG9ydElkOiBzdHJpbmcsIHByb2dyZXNzOiBudW1iZXIsIHN0YXR1cz86IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBhbmFseXNpc1JlcG9ydFJlcG9zaXRvcnkudXBkYXRlQnlJZChyZXBvcnRJZCwge1xuICAgICAgICBwcm9ncmVzczogTWF0aC5tYXgoMCwgTWF0aC5taW4oMTAwLCBwcm9ncmVzcykpXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgaWYgKHN0YXR1cykge1xuICAgICAgICBjb25zb2xlLmxvZyhgQW5hbHlzaXMgJHtyZXBvcnRJZH06ICR7cHJvZ3Jlc3N9JSAtICR7c3RhdHVzfWApO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gdXBkYXRlIHByb2dyZXNzIGZvciBhbmFseXNpcyAke3JlcG9ydElkfTpgLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENvbXBsZXRlIGFuYWx5c2lzIGFuZCBzYXZlIGZpbmFsIHJlc3VsdHNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgY29tcGxldGVBbmFseXNpcyhyZXBvcnRJZDogc3RyaW5nLCBhbmFseXNpc1Jlc3VsdHM6IGFueSk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBhbmFseXNpc1JlcG9ydFJlcG9zaXRvcnkudXBkYXRlQnlJZChyZXBvcnRJZCwge1xuICAgICAgICBnZW5lcmF0ZWREYXRhOiBhbmFseXNpc1Jlc3VsdHMsXG4gICAgICAgIHN0YXR1czogJ2NvbXBsZXRlZCcsXG4gICAgICAgIHByb2dyZXNzOiAxMDAsXG4gICAgICAgIGNvbXBsZXRlZEF0OiBuZXcgRGF0ZSgpXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEFuYWx5c2lzRXJyb3IoXG4gICAgICAgIGBGYWlsZWQgdG8gc2F2ZSBhbmFseXNpcyByZXN1bHRzOiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKX1gLFxuICAgICAgICBlcnJvclxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTWFyayBhbmFseXNpcyBhcyBmYWlsZWRcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgbWFya0FuYWx5c2lzRmFpbGVkKHJlcG9ydElkOiBzdHJpbmcsIGVycm9yOiBhbnkpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpO1xuICAgICAgY29uc3QgZXJyb3JEYXRhID0ge1xuICAgICAgICBlcnJvcjogZXJyb3JNZXNzYWdlLFxuICAgICAgICBlcnJvclR5cGU6IGVycm9yLmNvbnN0cnVjdG9yLm5hbWUsXG4gICAgICAgIGZhaWxlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IGFuYWx5c2lzUmVwb3J0UmVwb3NpdG9yeS51cGRhdGVCeUlkKHJlcG9ydElkLCB7XG4gICAgICAgIHN0YXR1czogJ2ZhaWxlZCcsXG4gICAgICAgIGdlbmVyYXRlZERhdGE6IGVycm9yRGF0YSBhcyBhbnksXG4gICAgICAgIGNvbXBsZXRlZEF0OiBuZXcgRGF0ZSgpXG4gICAgICB9KTtcbiAgICB9IGNhdGNoICh1cGRhdGVFcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIG1hcmsgYW5hbHlzaXMgJHtyZXBvcnRJZH0gYXMgZmFpbGVkOmAsIHVwZGF0ZUVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFuYWx5c2lzIHN0YXR1cyBieSByZXBvcnQgSURcbiAgICovXG4gIGFzeW5jIGdldEFuYWx5c2lzU3RhdHVzKHJlcG9ydElkOiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxBbmFseXNpc1JlcG9ydCB8IG51bGw+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVwb3J0ID0gYXdhaXQgYW5hbHlzaXNSZXBvcnRSZXBvc2l0b3J5LmZpbmRCeUlkKHJlcG9ydElkKTtcbiAgICAgIFxuICAgICAgaWYgKCFyZXBvcnQpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG5cbiAgICAgIC8vIEhhbmRsZSBtaWdyYXRpb24gcGVyaW9kOiBjaGVjayBib3RoIE9iamVjdElkIGFuZCBlbWFpbCBmb3JtYXRzXG4gICAgICBsZXQgaGFzQWNjZXNzID0gZmFsc2U7XG4gICAgICBcbiAgICAgIC8vIENvbnZlcnQgYm90aCB2YWx1ZXMgdG8gc3RyaW5ncyBmb3IgY29uc2lzdGVudCBjb21wYXJpc29uXG4gICAgICBjb25zdCByZXBvcnRVc2VySWRTdHIgPSByZXBvcnQudXNlcklkPy50b1N0cmluZygpIHx8ICcnO1xuICAgICAgY29uc3QgcHJvdmlkZWRVc2VySWRTdHIgPSB1c2VySWQ/LnRvU3RyaW5nKCkgfHwgJyc7XG4gICAgICBcbiAgICAgIGlmIChyZXBvcnRVc2VySWRTdHIgPT09IHByb3ZpZGVkVXNlcklkU3RyKSB7XG4gICAgICAgIC8vIERpcmVjdCBtYXRjaCAoYm90aCBjb252ZXJ0ZWQgdG8gc3RyaW5ncylcbiAgICAgICAgaGFzQWNjZXNzID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIENoZWNrIGlmIHRoZSByZXBvcnQncyB1c2VySWQgaXMgYW4gZW1haWwgYW5kIHdlIG5lZWQgdG8gY29udmVydCB0aGUgcHJvdmlkZWQgT2JqZWN0SWRcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCB7IHVzZXJSZXBvc2l0b3J5IH0gPSBhd2FpdCBpbXBvcnQoJ2RiL3NyYy9yZXBvc2l0b3JpZXMvVXNlclJlcG9zaXRvcnknKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBJZiB0aGUgcmVwb3J0IHVzZXJJZCBsb29rcyBsaWtlIGFuIGVtYWlsLCB0cnkgdG8gZmluZCB1c2VyIGJ5IGVtYWlsIGFuZCBjb21wYXJlIE9iamVjdElkc1xuICAgICAgICAgIGlmICh0eXBlb2YgcmVwb3J0VXNlcklkU3RyID09PSAnc3RyaW5nJyAmJiByZXBvcnRVc2VySWRTdHIuaW5jbHVkZXMoJ0AnKSkge1xuICAgICAgICAgICAgLy8gUmVwb3J0IGhhcyBlbWFpbCwgY2hlY2sgaWYgcHJvdmlkZWQgdXNlcklkIGlzIE9iamVjdElkIG9mIHRoYXQgdXNlclxuICAgICAgICAgICAgY29uc3QgdXNlckJ5RW1haWwgPSBhd2FpdCB1c2VyUmVwb3NpdG9yeS5maW5kQnlFbWFpbChyZXBvcnRVc2VySWRTdHIpO1xuICAgICAgICAgICAgaWYgKHVzZXJCeUVtYWlsICYmIHVzZXJCeUVtYWlsLl9pZCA9PT0gcHJvdmlkZWRVc2VySWRTdHIpIHtcbiAgICAgICAgICAgICAgaGFzQWNjZXNzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coYE1pZ3JhdGlvbjogUmVwb3J0ICR7cmVwb3J0SWR9IGhhcyBlbWFpbCB1c2VySWQsIG1hdGNoZWQgd2l0aCBPYmplY3RJZGApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBSZXBvcnQgaGFzIE9iamVjdElkLCBjaGVjayBpZiBwcm92aWRlZCB1c2VySWQgbWlnaHQgYmUgZnJvbSB1c2VyIHdpdGggdGhhdCBPYmplY3RJZFxuICAgICAgICAgICAgY29uc3QgdXNlckJ5T2JqZWN0SWQgPSBhd2FpdCB1c2VyUmVwb3NpdG9yeS5maW5kQnlJZChwcm92aWRlZFVzZXJJZFN0cik7XG4gICAgICAgICAgICBpZiAodXNlckJ5T2JqZWN0SWQgJiYgcmVwb3J0VXNlcklkU3RyID09PSB1c2VyQnlPYmplY3RJZC5lbWFpbCkge1xuICAgICAgICAgICAgICBoYXNBY2Nlc3MgPSB0cnVlO1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgTWlncmF0aW9uOiBSZXBvcnQgJHtyZXBvcnRJZH0gY29tcGFyaXNvbiBiZXR3ZWVuIE9iamVjdElkIGFuZCBlbWFpbGApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkdXJpbmcgbWlncmF0aW9uLWNvbXBhdGlibGUgYWNjZXNzIGNoZWNrOicsIGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjb25zb2xlLmxvZygnQWNjZXNzIGNoZWNrIHJlc3VsdDonLCB7XG4gICAgICAgIHJlcG9ydElkLFxuICAgICAgICByZXBvcnRVc2VySWQ6IHJlcG9ydC51c2VySWQsXG4gICAgICAgIHByb3ZpZGVkVXNlcklkOiB1c2VySWQsXG4gICAgICAgIGhhc0FjY2Vzc1xuICAgICAgfSk7XG5cbiAgICAgIGlmICghaGFzQWNjZXNzKSB7XG4gICAgICAgIHRocm93IG5ldyBBbmFseXNpc0Vycm9yKCdBY2Nlc3MgZGVuaWVkOiBBbmFseXNpcyBiZWxvbmdzIHRvIGRpZmZlcmVudCB1c2VyJyk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZXBvcnQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEFuYWx5c2lzRXJyb3IpIHtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHRocm93IG5ldyBBbmFseXNpc0Vycm9yKFxuICAgICAgICBgRmFpbGVkIHRvIGdldCBhbmFseXNpcyBzdGF0dXM6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpfWAsXG4gICAgICAgIGVycm9yXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYWxsIGFuYWx5c2lzIHJlcG9ydHMgZm9yIGEgdXNlclxuICAgKi9cbiAgYXN5bmMgZ2V0VXNlckFuYWx5c2VzKHVzZXJJZDogc3RyaW5nLCBsaW1pdDogbnVtYmVyID0gNTApOiBQcm9taXNlPEFuYWx5c2lzUmVwb3J0W10+IHtcbiAgICB0cnkge1xuICAgICAgLy8gRHVyaW5nIG1pZ3JhdGlvbiwgd2UgbmVlZCB0byBxdWVyeSBmb3IgYm90aCBPYmplY3RJZCBhbmQgZW1haWwgZm9ybWF0c1xuICAgICAgbGV0IHJlcG9ydHMgPSBhd2FpdCBhbmFseXNpc1JlcG9ydFJlcG9zaXRvcnkuZmluZEJ5VXNlcklkKHVzZXJJZCwgbGltaXQpO1xuICAgICAgXG4gICAgICAvLyBJZiBubyByZXBvcnRzIGZvdW5kIGFuZCB1c2VySWQgbG9va3MgbGlrZSBhbiBPYmplY3RJZCwgYWxzbyB0cnkgZmluZGluZyBieSBlbWFpbFxuICAgICAgaWYgKHJlcG9ydHMubGVuZ3RoID09PSAwICYmIHVzZXJJZC5sZW5ndGggPT09IDI0ICYmICF1c2VySWQuaW5jbHVkZXMoJ0AnKSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHsgdXNlclJlcG9zaXRvcnkgfSA9IGF3YWl0IGltcG9ydCgnZGIvc3JjL3JlcG9zaXRvcmllcy9Vc2VyUmVwb3NpdG9yeScpO1xuICAgICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB1c2VyUmVwb3NpdG9yeS5maW5kQnlJZCh1c2VySWQpO1xuICAgICAgICAgIGlmICh1c2VyICYmIHVzZXIuZW1haWwpIHtcbiAgICAgICAgICAgIC8vIFRyeSBmaW5kaW5nIHJlcG9ydHMgYnkgZW1haWwgZm9yIG1pZ3JhdGlvbiBjb21wYXRpYmlsaXR5XG4gICAgICAgICAgICBjb25zdCBlbWFpbFJlcG9ydHMgPSBhd2FpdCBhbmFseXNpc1JlcG9ydFJlcG9zaXRvcnkuZmluZEJ5VXNlcklkKHVzZXIuZW1haWwsIGxpbWl0KTtcbiAgICAgICAgICAgIHJlcG9ydHMgPSBbLi4ucmVwb3J0cywgLi4uZW1haWxSZXBvcnRzXTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBNaWdyYXRpb246IEZvdW5kICR7ZW1haWxSZXBvcnRzLmxlbmd0aH0gcmVwb3J0cyBieSBlbWFpbCBmb3IgdXNlciBPYmplY3RJZCAke3VzZXJJZH1gKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZHVyaW5nIG1pZ3JhdGlvbi1jb21wYXRpYmxlIHVzZXIgYW5hbHlzaXMgbG9va3VwOicsIGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4gcmVwb3J0cztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEFuYWx5c2lzRXJyb3IoXG4gICAgICAgIGBGYWlsZWQgdG8gZ2V0IHVzZXIgYW5hbHlzZXM6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpfWAsXG4gICAgICAgIGVycm9yXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGUgYW4gYW5hbHlzaXMgcmVwb3J0XG4gICAqL1xuICBhc3luYyBkZWxldGVBbmFseXNpcyhyZXBvcnRJZDogc3RyaW5nLCB1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBVc2UgZ2V0QW5hbHlzaXNTdGF0dXMgZm9yIGFjY2VzcyBjb250cm9sIChoYW5kbGVzIG1pZ3JhdGlvbiBjb21wYXRpYmlsaXR5KVxuICAgICAgY29uc3QgcmVwb3J0ID0gYXdhaXQgdGhpcy5nZXRBbmFseXNpc1N0YXR1cyhyZXBvcnRJZCwgdXNlcklkKTtcbiAgICAgIFxuICAgICAgaWYgKCFyZXBvcnQpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gYXdhaXQgYW5hbHlzaXNSZXBvcnRSZXBvc2l0b3J5LmRlbGV0ZUJ5SWQocmVwb3J0SWQpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgQW5hbHlzaXNFcnJvcihcbiAgICAgICAgYEZhaWxlZCB0byBkZWxldGUgYW5hbHlzaXM6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpfWAsXG4gICAgICAgIGVycm9yXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUZXN0IHRoZSBhbmFseXNpcyBzZXJ2aWNlXG4gICAqL1xuICBhc3luYyB0ZXN0U2VydmljZSgpOiBQcm9taXNlPHtcbiAgICBnZW1pbmlDb25uZWN0aW9uOiBib29sZWFuO1xuICAgIGRhdGFiYXNlOiBib29sZWFuO1xuICAgIG92ZXJhbGw6IGJvb2xlYW47XG4gIH0+IHtcbiAgICBjb25zdCByZXN1bHRzID0ge1xuICAgICAgZ2VtaW5pQ29ubmVjdGlvbjogZmFsc2UsXG4gICAgICBkYXRhYmFzZTogZmFsc2UsXG4gICAgICBvdmVyYWxsOiBmYWxzZVxuICAgIH07XG5cbiAgICB0cnkge1xuICAgICAgaWYgKHRoaXMuY2xpZW50KSB7XG4gICAgICAgIC8vIFRlc3Qgd2l0aCBzaW1wbGUgY29udGVudFxuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuY2xpZW50Lm1vZGVscy5nZW5lcmF0ZUNvbnRlbnQoe1xuICAgICAgICAgIG1vZGVsOiB0aGlzLm1vZGVsTmFtZSxcbiAgICAgICAgICBjb250ZW50czogW3sgdGV4dDogJ1Jlc3BvbmQgd2l0aCBleGFjdGx5OiB7XCJ0ZXN0XCI6IFwic3VjY2Vzc1wifScgfV1cbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBpZiAocmVzcG9uc2UudGV4dCAmJiByZXNwb25zZS50ZXh0LmluY2x1ZGVzKCdzdWNjZXNzJykpIHtcbiAgICAgICAgICByZXN1bHRzLmdlbWluaUNvbm5lY3Rpb24gPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0dlbWluaSBjb25uZWN0aW9uIHRlc3QgZmFpbGVkOicsIGVycm9yKTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgYXdhaXQgYW5hbHlzaXNSZXBvcnRSZXBvc2l0b3J5LmNvdW50QnlVc2VySWQoJ3Rlc3QtdXNlci1pZCcpO1xuICAgICAgcmVzdWx0cy5kYXRhYmFzZSA9IHRydWU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0RhdGFiYXNlIHRlc3QgZmFpbGVkOicsIGVycm9yKTtcbiAgICB9XG5cbiAgICByZXN1bHRzLm92ZXJhbGwgPSByZXN1bHRzLmdlbWluaUNvbm5lY3Rpb24gJiYgcmVzdWx0cy5kYXRhYmFzZTtcbiAgICBcbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfVxufVxuXG4vLyBFeHBvcnQgc2luZ2xldG9uIGluc3RhbmNlIGZvciB1c2UgaW4gQVBJIHJvdXRlc1xuZXhwb3J0IGNvbnN0IGFuYWx5c2lzU2VydmljZSA9IG5ldyBBbmFseXNpc1NlcnZpY2UoKTtcbiJdLCJuYW1lcyI6WyJHb29nbGVHZW5BSSIsImFuYWx5c2lzUmVwb3J0UmVwb3NpdG9yeSIsIkFuYWx5c2lzRXJyb3IiLCJyZWFkRmlsZSIsImpvaW4iLCJBbmFseXNpc1NlcnZpY2UiLCJjb25zdHJ1Y3RvciIsImFwaUtleUNvbmZpZ3VyZWQiLCJwcm9jZXNzIiwiZW52IiwiR0VNSU5JX0FQSV9LRVkiLCJtb2RlbE5hbWUiLCJHRU1JTklfTU9ERUwiLCJjb25zb2xlIiwid2FybiIsImNsaWVudCIsImFwaUtleSIsInByb2Nlc3NBbmFseXNpcyIsInVwbG9hZElkIiwiZmlsZVJlZmVyZW5jZXMiLCJ1c2VySWQiLCJvcHRpb25zIiwic3RhcnRUaW1lIiwiRGF0ZSIsIm5vdyIsImxvZyIsImxlbmd0aCIsInJlcG9ydFRpdGxlIiwidG9Mb2NhbGVEYXRlU3RyaW5nIiwiYW5hbHlzaXNSZXBvcnQiLCJjcmVhdGVJbml0aWFsUmVwb3J0Iiwic291cmNlRG9jdW1lbnRDb3VudCIsInN0YXR1cyIsInByb2dyZXNzIiwiX2lkIiwidXBkYXRlUHJvZ3Jlc3MiLCJhbmFseXNpc1Jlc3VsdHMiLCJhbmFseXplRG9jdW1lbnRzV2l0aEdlbWluaSIsImVuaGFuY2VkUmVzdWx0cyIsIm1ldGFkYXRhIiwicHJvY2Vzc2luZ1RpbWUiLCJmaWxlc1Byb2Nlc3NlZCIsImFuYWx5c2lzVGltZXN0YW1wIiwidG9JU09TdHJpbmciLCJtb2RlbFVzZWQiLCJ1c2VOYXRpdmVEb2N1bWVudFVuZGVyc3RhbmRpbmciLCJjb21wbGV0ZUFuYWx5c2lzIiwiZXJyb3IiLCJtYXJrQW5hbHlzaXNGYWlsZWQiLCJFcnJvciIsIm1lc3NhZ2UiLCJTdHJpbmciLCJnZW5lcmF0ZVBsYWNlaG9sZGVyQW5hbHlzaXMiLCJjb250ZW50cyIsInB1c2giLCJ0ZXh0IiwiaSIsImZpbGVSZWYiLCJzdGFydHNXaXRoIiwibG9jYWxQYXRoIiwicmVwbGFjZSIsImN1cnJlbnREaXIiLCJjd2QiLCJmaWxlUGF0aCIsImluY2x1ZGVzIiwicGFydHMiLCJzcGxpdCIsInByb2plY3RSb290Iiwic2xpY2UiLCJmaWxlQnVmZmVyIiwiZmlsZW5hbWUiLCJleHRyYWN0RmlsZW5hbWUiLCJleHRlbnNpb24iLCJ0b0xvd2VyQ2FzZSIsInBvcCIsImlubGluZURhdGEiLCJtaW1lVHlwZSIsImRhdGEiLCJ0b1N0cmluZyIsInRleHRDb250ZW50IiwicmVzcG9uc2UiLCJtb2RlbHMiLCJnZW5lcmF0ZUNvbnRlbnQiLCJtb2RlbCIsImNsZWFuZWRUZXh0IiwiY2xlYW5Kc29uUmVzcG9uc2UiLCJhbmFseXNpc0RhdGEiLCJKU09OIiwicGFyc2UiLCJ2YWxpZGF0ZUFuYWx5c2lzU3RydWN0dXJlIiwiY2xlYW5lZCIsInRyaW0iLCJqc29uTWF0Y2giLCJtYXRjaCIsInJlcXVpcmVkRmllbGRzIiwibWlzc2luZ0ZpZWxkcyIsImZpbHRlciIsImZpZWxkIiwidG90YWxJbmNvbWUiLCJ2YWxpZGF0ZU51bWJlciIsInRvdGFsRXhwZW5zZXMiLCJuZXRDYXNoRmxvdyIsImNhdGVnb3JpZXMiLCJBcnJheSIsImlzQXJyYXkiLCJpbmNvbWUiLCJleHBlbnNlcyIsIm1vbnRobHlUcmVuZHMiLCJpbnNpZ2h0cyIsInJlY29tbWVuZGF0aW9ucyIsInN1bW1hcnkiLCJlc3RpbWF0ZWRJbmNvbWUiLCJlc3RpbWF0ZWRFeHBlbnNlcyIsImNhdGVnb3J5IiwiYW1vdW50IiwicGVyY2VudGFnZSIsIm1vbnRoIiwidHlwZSIsImRlc2NyaXB0aW9uIiwic2V2ZXJpdHkiLCJzdWdnZXN0aW9uIiwicG90ZW50aWFsU2F2aW5ncyIsImlzUGxhY2Vob2xkZXJEYXRhIiwidmFsdWUiLCJmaWVsZE5hbWUiLCJwYXJzZWQiLCJwYXJzZUZsb2F0IiwiaXNOYU4iLCJNYXRoIiwibWF4IiwiZmlsZVVybCIsInJlcG9ydERhdGEiLCJjcmVhdGUiLCJyZXBvcnRJZCIsInVwZGF0ZUJ5SWQiLCJtaW4iLCJnZW5lcmF0ZWREYXRhIiwiY29tcGxldGVkQXQiLCJlcnJvck1lc3NhZ2UiLCJlcnJvckRhdGEiLCJlcnJvclR5cGUiLCJuYW1lIiwiZmFpbGVkQXQiLCJ1cGRhdGVFcnJvciIsImdldEFuYWx5c2lzU3RhdHVzIiwicmVwb3J0IiwiZmluZEJ5SWQiLCJoYXNBY2Nlc3MiLCJyZXBvcnRVc2VySWRTdHIiLCJwcm92aWRlZFVzZXJJZFN0ciIsInVzZXJSZXBvc2l0b3J5IiwidXNlckJ5RW1haWwiLCJmaW5kQnlFbWFpbCIsInVzZXJCeU9iamVjdElkIiwiZW1haWwiLCJyZXBvcnRVc2VySWQiLCJwcm92aWRlZFVzZXJJZCIsImdldFVzZXJBbmFseXNlcyIsImxpbWl0IiwicmVwb3J0cyIsImZpbmRCeVVzZXJJZCIsInVzZXIiLCJlbWFpbFJlcG9ydHMiLCJkZWxldGVBbmFseXNpcyIsImRlbGV0ZUJ5SWQiLCJ0ZXN0U2VydmljZSIsInJlc3VsdHMiLCJnZW1pbmlDb25uZWN0aW9uIiwiZGF0YWJhc2UiLCJvdmVyYWxsIiwiY291bnRCeVVzZXJJZCIsImFuYWx5c2lzU2VydmljZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/services/AnalysisService.ts\n");

/***/ }),

/***/ "(rsc)/../../packages/db/src/connection.ts":
/*!*******************************************!*\
  !*** ../../packages/db/src/connection.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n\nlet cached = global.mongoose;\nif (!cached) {\n    cached = global.mongoose = {\n        conn: null,\n        promise: null\n    };\n}\nasync function dbConnect() {\n    if (cached.conn) {\n        return cached.conn;\n    }\n    if (!cached.promise) {\n        const opts = {\n            bufferCommands: false\n        };\n        const MONGODB_URI = process.env.MONGODB_URI;\n        if (!MONGODB_URI) {\n            throw new Error(\"Please define the MONGODB_URI environment variable inside .env.local\");\n        }\n        cached.promise = mongoose__WEBPACK_IMPORTED_MODULE_0___default().connect(MONGODB_URI, opts).then((mongoose)=>{\n            return mongoose;\n        });\n    }\n    try {\n        cached.conn = await cached.promise;\n    } catch (e) {\n        cached.promise = null;\n        throw e;\n    }\n    return cached.conn;\n}\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (dbConnect);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vcGFja2FnZXMvZGIvc3JjL2Nvbm5lY3Rpb24udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQWdDO0FBTWhDLElBQUlDLFNBQVNDLE9BQU9GLFFBQVE7QUFFNUIsSUFBSSxDQUFDQyxRQUFRO0lBQ1hBLFNBQVNDLE9BQU9GLFFBQVEsR0FBRztRQUFFRyxNQUFNO1FBQU1DLFNBQVM7SUFBSztBQUN6RDtBQUVBLGVBQWVDO0lBQ2IsSUFBSUosT0FBT0UsSUFBSSxFQUFFO1FBQ2YsT0FBT0YsT0FBT0UsSUFBSTtJQUNwQjtJQUVBLElBQUksQ0FBQ0YsT0FBT0csT0FBTyxFQUFFO1FBQ25CLE1BQU1FLE9BQU87WUFDWEMsZ0JBQWdCO1FBQ2xCO1FBRUEsTUFBTUMsY0FBY0MsUUFBUUMsR0FBRyxDQUFDRixXQUFXO1FBRTNDLElBQUksQ0FBQ0EsYUFBYTtZQUNoQixNQUFNLElBQUlHLE1BQ1I7UUFFSjtRQUVBVixPQUFPRyxPQUFPLEdBQUdKLHVEQUFnQixDQUFDUSxhQUFhRixNQUFNTyxJQUFJLENBQUMsQ0FBQ2I7WUFDekQsT0FBT0E7UUFDVDtJQUNGO0lBRUEsSUFBSTtRQUNGQyxPQUFPRSxJQUFJLEdBQUcsTUFBTUYsT0FBT0csT0FBTztJQUNwQyxFQUFFLE9BQU9VLEdBQUc7UUFDVmIsT0FBT0csT0FBTyxHQUFHO1FBQ2pCLE1BQU1VO0lBQ1I7SUFFQSxPQUFPYixPQUFPRSxJQUFJO0FBQ3BCO0FBRUEsaUVBQWVFLFNBQVNBLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93ZWIvLi4vLi4vcGFja2FnZXMvZGIvc3JjL2Nvbm5lY3Rpb24udHM/NzRkMyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbW9uZ29vc2UgZnJvbSAnbW9uZ29vc2UnO1xuXG5kZWNsYXJlIGdsb2JhbCB7XG4gIHZhciBtb25nb29zZTogYW55OyAvLyBUaGlzIG11c3QgYmUgYSBgdmFyYCBhbmQgbm90IGEgYGxldCAvIGNvbnN0YFxufVxuXG5sZXQgY2FjaGVkID0gZ2xvYmFsLm1vbmdvb3NlO1xuXG5pZiAoIWNhY2hlZCkge1xuICBjYWNoZWQgPSBnbG9iYWwubW9uZ29vc2UgPSB7IGNvbm46IG51bGwsIHByb21pc2U6IG51bGwgfTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZGJDb25uZWN0KCk6IFByb21pc2U8dHlwZW9mIG1vbmdvb3NlPiB7XG4gIGlmIChjYWNoZWQuY29ubikge1xuICAgIHJldHVybiBjYWNoZWQuY29ubjtcbiAgfVxuXG4gIGlmICghY2FjaGVkLnByb21pc2UpIHtcbiAgICBjb25zdCBvcHRzID0ge1xuICAgICAgYnVmZmVyQ29tbWFuZHM6IGZhbHNlLFxuICAgIH07XG5cbiAgICBjb25zdCBNT05HT0RCX1VSSSA9IHByb2Nlc3MuZW52Lk1PTkdPREJfVVJJO1xuXG4gICAgaWYgKCFNT05HT0RCX1VSSSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAnUGxlYXNlIGRlZmluZSB0aGUgTU9OR09EQl9VUkkgZW52aXJvbm1lbnQgdmFyaWFibGUgaW5zaWRlIC5lbnYubG9jYWwnXG4gICAgICApO1xuICAgIH1cblxuICAgIGNhY2hlZC5wcm9taXNlID0gbW9uZ29vc2UuY29ubmVjdChNT05HT0RCX1VSSSwgb3B0cykudGhlbigobW9uZ29vc2UpID0+IHtcbiAgICAgIHJldHVybiBtb25nb29zZTtcbiAgICB9KTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY2FjaGVkLmNvbm4gPSBhd2FpdCBjYWNoZWQucHJvbWlzZTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGNhY2hlZC5wcm9taXNlID0gbnVsbDtcbiAgICB0aHJvdyBlO1xuICB9XG5cbiAgcmV0dXJuIGNhY2hlZC5jb25uO1xufVxuXG5leHBvcnQgZGVmYXVsdCBkYkNvbm5lY3Q7XG4iXSwibmFtZXMiOlsibW9uZ29vc2UiLCJjYWNoZWQiLCJnbG9iYWwiLCJjb25uIiwicHJvbWlzZSIsImRiQ29ubmVjdCIsIm9wdHMiLCJidWZmZXJDb21tYW5kcyIsIk1PTkdPREJfVVJJIiwicHJvY2VzcyIsImVudiIsIkVycm9yIiwiY29ubmVjdCIsInRoZW4iLCJlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/../../packages/db/src/connection.ts\n");

/***/ }),

/***/ "(rsc)/../../packages/db/src/models/AnalysisReport.ts":
/*!******************************************************!*\
  !*** ../../packages/db/src/models/AnalysisReport.ts ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n\n// AnalysisReport schema definition\nconst analysisReportSchema = new (mongoose__WEBPACK_IMPORTED_MODULE_0___default().Schema)({\n    userId: {\n        type: (mongoose__WEBPACK_IMPORTED_MODULE_0___default().Schema).Types.Mixed,\n        required: true,\n        index: true // Indexed for fast lookups of user's reports\n    },\n    uploadId: {\n        type: String,\n        required: false\n    },\n    reportTitle: {\n        type: String,\n        required: true\n    },\n    sourceDocumentCount: {\n        type: Number,\n        required: true\n    },\n    status: {\n        type: String,\n        enum: [\n            \"processing\",\n            \"completed\",\n            \"failed\"\n        ],\n        default: \"processing\",\n        required: true\n    },\n    progress: {\n        type: Number,\n        min: 0,\n        max: 100,\n        default: 0\n    },\n    generatedData: {\n        type: Object,\n        required: false\n    },\n    completedAt: {\n        type: Date,\n        required: false\n    }\n}, {\n    timestamps: true // Automatically adds createdAt and updatedAt fields\n});\n// Add compound index for userId and createdAt for efficient sorting\nanalysisReportSchema.index({\n    userId: 1,\n    createdAt: -1\n});\n// Add index for status to help with filtering\nanalysisReportSchema.index({\n    status: 1\n});\n// Add compound index for userId and status\nanalysisReportSchema.index({\n    userId: 1,\n    status: 1\n});\n// Create and export the AnalysisReport model\nconst AnalysisReport = (mongoose__WEBPACK_IMPORTED_MODULE_0___default().models)?.AnalysisReport || mongoose__WEBPACK_IMPORTED_MODULE_0___default().model(\"AnalysisReport\", analysisReportSchema);\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (AnalysisReport);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vcGFja2FnZXMvZGIvc3JjL21vZGVscy9BbmFseXNpc1JlcG9ydC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBZ0M7QUFHaEMsbUNBQW1DO0FBQ25DLE1BQU1DLHVCQUF1QixJQUFJRCx3REFBZSxDQUFDO0lBQy9DRyxRQUFRO1FBQ05DLE1BQU1KLHdEQUFlLENBQUNLLEtBQUssQ0FBQ0MsS0FBSztRQUNqQ0MsVUFBVTtRQUNWQyxPQUFPLEtBQUssNkNBQTZDO0lBQzNEO0lBQ0FDLFVBQVU7UUFDUkwsTUFBTU07UUFDTkgsVUFBVTtJQUNaO0lBQ0FJLGFBQWE7UUFDWFAsTUFBTU07UUFDTkgsVUFBVTtJQUNaO0lBQ0FLLHFCQUFxQjtRQUNuQlIsTUFBTVM7UUFDTk4sVUFBVTtJQUNaO0lBQ0FPLFFBQVE7UUFDTlYsTUFBTU07UUFDTkssTUFBTTtZQUFDO1lBQWM7WUFBYTtTQUFTO1FBQzNDQyxTQUFTO1FBQ1RULFVBQVU7SUFDWjtJQUNBVSxVQUFVO1FBQ1JiLE1BQU1TO1FBQ05LLEtBQUs7UUFDTEMsS0FBSztRQUNMSCxTQUFTO0lBQ1g7SUFDQUksZUFBZTtRQUNiaEIsTUFBTWlCO1FBQ05kLFVBQVU7SUFDWjtJQUNBZSxhQUFhO1FBQ1hsQixNQUFNbUI7UUFDTmhCLFVBQVU7SUFDWjtBQUNGLEdBQUc7SUFDRGlCLFlBQVksS0FBSyxvREFBb0Q7QUFDdkU7QUFFQSxvRUFBb0U7QUFDcEV2QixxQkFBcUJPLEtBQUssQ0FBQztJQUFFTCxRQUFRO0lBQUdzQixXQUFXLENBQUM7QUFBRTtBQUV0RCw4Q0FBOEM7QUFDOUN4QixxQkFBcUJPLEtBQUssQ0FBQztJQUFFTSxRQUFRO0FBQUU7QUFFdkMsMkNBQTJDO0FBQzNDYixxQkFBcUJPLEtBQUssQ0FBQztJQUFFTCxRQUFRO0lBQUdXLFFBQVE7QUFBRTtBQUVsRCw2Q0FBNkM7QUFDN0MsTUFBTVksaUJBQWlCMUIsd0RBQWUsRUFBRTBCLGtCQUN0QzFCLHFEQUFjLENBQWtCLGtCQUFrQkM7QUFFcEQsaUVBQWV5QixjQUFjQSxFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2ViLy4uLy4uL3BhY2thZ2VzL2RiL3NyYy9tb2RlbHMvQW5hbHlzaXNSZXBvcnQudHM/OWU0NCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbW9uZ29vc2UgZnJvbSAnbW9uZ29vc2UnO1xuaW1wb3J0IHsgQW5hbHlzaXNSZXBvcnQgYXMgSUFuYWx5c2lzUmVwb3J0IH0gZnJvbSAnbGliL3NyYy90eXBlcyc7XG5cbi8vIEFuYWx5c2lzUmVwb3J0IHNjaGVtYSBkZWZpbml0aW9uXG5jb25zdCBhbmFseXNpc1JlcG9ydFNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoe1xuICB1c2VySWQ6IHtcbiAgICB0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuTWl4ZWQsIC8vIEFsbG93IGJvdGggT2JqZWN0SWQgKGF1dGhlbnRpY2F0ZWQgdXNlcnMpIGFuZCBTdHJpbmcgKGd1ZXN0IHVzZXJzKVxuICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgIGluZGV4OiB0cnVlIC8vIEluZGV4ZWQgZm9yIGZhc3QgbG9va3VwcyBvZiB1c2VyJ3MgcmVwb3J0c1xuICB9LFxuICB1cGxvYWRJZDoge1xuICAgIHR5cGU6IFN0cmluZyxcbiAgICByZXF1aXJlZDogZmFsc2VcbiAgfSxcbiAgcmVwb3J0VGl0bGU6IHtcbiAgICB0eXBlOiBTdHJpbmcsXG4gICAgcmVxdWlyZWQ6IHRydWVcbiAgfSxcbiAgc291cmNlRG9jdW1lbnRDb3VudDoge1xuICAgIHR5cGU6IE51bWJlcixcbiAgICByZXF1aXJlZDogdHJ1ZVxuICB9LFxuICBzdGF0dXM6IHtcbiAgICB0eXBlOiBTdHJpbmcsXG4gICAgZW51bTogWydwcm9jZXNzaW5nJywgJ2NvbXBsZXRlZCcsICdmYWlsZWQnXSxcbiAgICBkZWZhdWx0OiAncHJvY2Vzc2luZycsXG4gICAgcmVxdWlyZWQ6IHRydWVcbiAgfSxcbiAgcHJvZ3Jlc3M6IHtcbiAgICB0eXBlOiBOdW1iZXIsXG4gICAgbWluOiAwLFxuICAgIG1heDogMTAwLFxuICAgIGRlZmF1bHQ6IDBcbiAgfSxcbiAgZ2VuZXJhdGVkRGF0YToge1xuICAgIHR5cGU6IE9iamVjdCwgLy8gRmxleGlibGUgb2JqZWN0IHRvIHN0b3JlIEpTT04gb3V0cHV0IGZyb20gR2VtaW5pXG4gICAgcmVxdWlyZWQ6IGZhbHNlXG4gIH0sXG4gIGNvbXBsZXRlZEF0OiB7XG4gICAgdHlwZTogRGF0ZSxcbiAgICByZXF1aXJlZDogZmFsc2VcbiAgfVxufSwge1xuICB0aW1lc3RhbXBzOiB0cnVlIC8vIEF1dG9tYXRpY2FsbHkgYWRkcyBjcmVhdGVkQXQgYW5kIHVwZGF0ZWRBdCBmaWVsZHNcbn0pO1xuXG4vLyBBZGQgY29tcG91bmQgaW5kZXggZm9yIHVzZXJJZCBhbmQgY3JlYXRlZEF0IGZvciBlZmZpY2llbnQgc29ydGluZ1xuYW5hbHlzaXNSZXBvcnRTY2hlbWEuaW5kZXgoeyB1c2VySWQ6IDEsIGNyZWF0ZWRBdDogLTEgfSk7XG5cbi8vIEFkZCBpbmRleCBmb3Igc3RhdHVzIHRvIGhlbHAgd2l0aCBmaWx0ZXJpbmdcbmFuYWx5c2lzUmVwb3J0U2NoZW1hLmluZGV4KHsgc3RhdHVzOiAxIH0pO1xuXG4vLyBBZGQgY29tcG91bmQgaW5kZXggZm9yIHVzZXJJZCBhbmQgc3RhdHVzXG5hbmFseXNpc1JlcG9ydFNjaGVtYS5pbmRleCh7IHVzZXJJZDogMSwgc3RhdHVzOiAxIH0pO1xuXG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgQW5hbHlzaXNSZXBvcnQgbW9kZWxcbmNvbnN0IEFuYWx5c2lzUmVwb3J0ID0gbW9uZ29vc2UubW9kZWxzPy5BbmFseXNpc1JlcG9ydCB8fCBcbiAgbW9uZ29vc2UubW9kZWw8SUFuYWx5c2lzUmVwb3J0PignQW5hbHlzaXNSZXBvcnQnLCBhbmFseXNpc1JlcG9ydFNjaGVtYSk7XG5cbmV4cG9ydCBkZWZhdWx0IEFuYWx5c2lzUmVwb3J0O1xuIl0sIm5hbWVzIjpbIm1vbmdvb3NlIiwiYW5hbHlzaXNSZXBvcnRTY2hlbWEiLCJTY2hlbWEiLCJ1c2VySWQiLCJ0eXBlIiwiVHlwZXMiLCJNaXhlZCIsInJlcXVpcmVkIiwiaW5kZXgiLCJ1cGxvYWRJZCIsIlN0cmluZyIsInJlcG9ydFRpdGxlIiwic291cmNlRG9jdW1lbnRDb3VudCIsIk51bWJlciIsInN0YXR1cyIsImVudW0iLCJkZWZhdWx0IiwicHJvZ3Jlc3MiLCJtaW4iLCJtYXgiLCJnZW5lcmF0ZWREYXRhIiwiT2JqZWN0IiwiY29tcGxldGVkQXQiLCJEYXRlIiwidGltZXN0YW1wcyIsImNyZWF0ZWRBdCIsIkFuYWx5c2lzUmVwb3J0IiwibW9kZWxzIiwibW9kZWwiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/../../packages/db/src/models/AnalysisReport.ts\n");

/***/ }),

/***/ "(rsc)/../../packages/db/src/models/User.ts":
/*!********************************************!*\
  !*** ../../packages/db/src/models/User.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   UserSchema: () => (/* binding */ UserSchema),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n\n/**\n * User schema definition\n * Following coding standards: camelCase collection name, proper validation, indexing\n */ const UserSchema = new mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema({\n    name: {\n        type: String,\n        required: [\n            true,\n            \"Name is required\"\n        ],\n        trim: true,\n        maxlength: [\n            100,\n            \"Name cannot exceed 100 characters\"\n        ]\n    },\n    email: {\n        type: String,\n        required: [\n            true,\n            \"Email is required\"\n        ],\n        unique: true,\n        lowercase: true,\n        trim: true,\n        match: [\n            /^\\w+([.-]?\\w+)*@\\w+([.-]?\\w+)*(\\.\\w{2,3})+$/,\n            \"Please enter a valid email address\"\n        ]\n    },\n    password: {\n        type: String,\n        required: [\n            true,\n            \"Password is required\"\n        ],\n        minlength: [\n            6,\n            \"Password must be at least 6 characters long\"\n        ]\n    }\n}, {\n    timestamps: true,\n    collection: \"users\"\n});\n// Email index is automatically created by unique: true in schema definition\n/**\n * User model\n * Export both the model and the schema for testing purposes\n */ const User = (mongoose__WEBPACK_IMPORTED_MODULE_0___default().models).User || mongoose__WEBPACK_IMPORTED_MODULE_0___default().model(\"User\", UserSchema);\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (User);\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vcGFja2FnZXMvZGIvc3JjL21vZGVscy9Vc2VyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBc0Q7QUFtQnREOzs7Q0FHQyxHQUNELE1BQU1FLGFBQWEsSUFBSUQsNENBQU1BLENBQzNCO0lBQ0VFLE1BQU07UUFDSkMsTUFBTUM7UUFDTkMsVUFBVTtZQUFDO1lBQU07U0FBbUI7UUFDcENDLE1BQU07UUFDTkMsV0FBVztZQUFDO1lBQUs7U0FBb0M7SUFDdkQ7SUFDQUMsT0FBTztRQUNMTCxNQUFNQztRQUNOQyxVQUFVO1lBQUM7WUFBTTtTQUFvQjtRQUNyQ0ksUUFBUTtRQUNSQyxXQUFXO1FBQ1hKLE1BQU07UUFDTkssT0FBTztZQUNMO1lBQ0E7U0FDRDtJQUNIO0lBQ0FDLFVBQVU7UUFDUlQsTUFBTUM7UUFDTkMsVUFBVTtZQUFDO1lBQU07U0FBdUI7UUFDeENRLFdBQVc7WUFBQztZQUFHO1NBQThDO0lBQy9EO0FBQ0YsR0FDQTtJQUNFQyxZQUFZO0lBQ1pDLFlBQVk7QUFDZDtBQUdGLDRFQUE0RTtBQUU1RTs7O0NBR0MsR0FDRCxNQUFNQyxPQUFPakIsd0RBQWUsQ0FBQ2lCLElBQUksSUFBSWpCLHFEQUFjLENBQWUsUUFBUUU7QUFFMUUsaUVBQWVlLElBQUlBLEVBQUM7QUFDRSIsInNvdXJjZXMiOlsid2VicGFjazovL3dlYi8uLi8uLi9wYWNrYWdlcy9kYi9zcmMvbW9kZWxzL1VzZXIudHM/OTcwZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbW9uZ29vc2UsIHsgU2NoZW1hLCBEb2N1bWVudCB9IGZyb20gJ21vbmdvb3NlJztcbmltcG9ydCB7IFVzZXIgYXMgSVVzZXIsIENyZWF0ZVVzZXJEYXRhIH0gZnJvbSAnbGliL3NyYy90eXBlcyc7XG5cbi8qKlxuICogRGF0YWJhc2Utc3BlY2lmaWMgVXNlciBpbnRlcmZhY2UgaW5jbHVkaW5nIHBhc3N3b3JkIGZpZWxkXG4gKiBQYXNzd29yZCBpcyBzdG9yZWQgaW4gZGF0YWJhc2UgYnV0IG5vdCBleHBvc2VkIGluIHNoYXJlZCBmcm9udGVuZCB0eXBlc1xuICovXG5pbnRlcmZhY2UgRGF0YWJhc2VVc2VyIGV4dGVuZHMgT21pdDxJVXNlciwgJ19pZCc+IHtcbiAgcGFzc3dvcmQ6IHN0cmluZztcbn1cblxuLyoqXG4gKiBVc2VyIGRvY3VtZW50IGludGVyZmFjZSBleHRlbmRpbmcgTW9uZ29vc2UgRG9jdW1lbnRcbiAqIFRoaXMgY29tYmluZXMgdGhlIGRhdGFiYXNlIFVzZXIgaW50ZXJmYWNlIHdpdGggTW9uZ29vc2UgRG9jdW1lbnQgbWV0aG9kc1xuICovXG5leHBvcnQgaW50ZXJmYWNlIFVzZXJEb2N1bWVudCBleHRlbmRzIERhdGFiYXNlVXNlciwgRG9jdW1lbnQge1xuICBfaWQ6IG1vbmdvb3NlLlR5cGVzLk9iamVjdElkO1xufVxuXG4vKipcbiAqIFVzZXIgc2NoZW1hIGRlZmluaXRpb25cbiAqIEZvbGxvd2luZyBjb2Rpbmcgc3RhbmRhcmRzOiBjYW1lbENhc2UgY29sbGVjdGlvbiBuYW1lLCBwcm9wZXIgdmFsaWRhdGlvbiwgaW5kZXhpbmdcbiAqL1xuY29uc3QgVXNlclNjaGVtYSA9IG5ldyBTY2hlbWE8VXNlckRvY3VtZW50PihcbiAge1xuICAgIG5hbWU6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIHJlcXVpcmVkOiBbdHJ1ZSwgJ05hbWUgaXMgcmVxdWlyZWQnXSxcbiAgICAgIHRyaW06IHRydWUsXG4gICAgICBtYXhsZW5ndGg6IFsxMDAsICdOYW1lIGNhbm5vdCBleGNlZWQgMTAwIGNoYXJhY3RlcnMnXSxcbiAgICB9LFxuICAgIGVtYWlsOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICByZXF1aXJlZDogW3RydWUsICdFbWFpbCBpcyByZXF1aXJlZCddLFxuICAgICAgdW5pcXVlOiB0cnVlLFxuICAgICAgbG93ZXJjYXNlOiB0cnVlLFxuICAgICAgdHJpbTogdHJ1ZSxcbiAgICAgIG1hdGNoOiBbXG4gICAgICAgIC9eXFx3KyhbLi1dP1xcdyspKkBcXHcrKFsuLV0/XFx3KykqKFxcLlxcd3syLDN9KSskLyxcbiAgICAgICAgJ1BsZWFzZSBlbnRlciBhIHZhbGlkIGVtYWlsIGFkZHJlc3MnLFxuICAgICAgXSxcbiAgICB9LFxuICAgIHBhc3N3b3JkOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICByZXF1aXJlZDogW3RydWUsICdQYXNzd29yZCBpcyByZXF1aXJlZCddLFxuICAgICAgbWlubGVuZ3RoOiBbNiwgJ1Bhc3N3b3JkIG11c3QgYmUgYXQgbGVhc3QgNiBjaGFyYWN0ZXJzIGxvbmcnXSxcbiAgICB9LFxuICB9LFxuICB7XG4gICAgdGltZXN0YW1wczogdHJ1ZSwgLy8gQXV0b21hdGljYWxseSBhZGRzIGNyZWF0ZWRBdCBhbmQgdXBkYXRlZEF0IGZpZWxkc1xuICAgIGNvbGxlY3Rpb246ICd1c2VycycsIC8vIEZvbGxvd2luZyBjYW1lbENhc2UgbmFtaW5nIGNvbnZlbnRpb24gZm9yIGNvbGxlY3Rpb25zXG4gIH1cbik7XG5cbi8vIEVtYWlsIGluZGV4IGlzIGF1dG9tYXRpY2FsbHkgY3JlYXRlZCBieSB1bmlxdWU6IHRydWUgaW4gc2NoZW1hIGRlZmluaXRpb25cblxuLyoqXG4gKiBVc2VyIG1vZGVsXG4gKiBFeHBvcnQgYm90aCB0aGUgbW9kZWwgYW5kIHRoZSBzY2hlbWEgZm9yIHRlc3RpbmcgcHVycG9zZXNcbiAqL1xuY29uc3QgVXNlciA9IG1vbmdvb3NlLm1vZGVscy5Vc2VyIHx8IG1vbmdvb3NlLm1vZGVsPFVzZXJEb2N1bWVudD4oJ1VzZXInLCBVc2VyU2NoZW1hKTtcblxuZXhwb3J0IGRlZmF1bHQgVXNlcjtcbmV4cG9ydCB7IFVzZXJTY2hlbWEgfTtcbiJdLCJuYW1lcyI6WyJtb25nb29zZSIsIlNjaGVtYSIsIlVzZXJTY2hlbWEiLCJuYW1lIiwidHlwZSIsIlN0cmluZyIsInJlcXVpcmVkIiwidHJpbSIsIm1heGxlbmd0aCIsImVtYWlsIiwidW5pcXVlIiwibG93ZXJjYXNlIiwibWF0Y2giLCJwYXNzd29yZCIsIm1pbmxlbmd0aCIsInRpbWVzdGFtcHMiLCJjb2xsZWN0aW9uIiwiVXNlciIsIm1vZGVscyIsIm1vZGVsIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/../../packages/db/src/models/User.ts\n");

/***/ }),

/***/ "(rsc)/../../packages/db/src/repositories/AnalysisReportRepository.ts":
/*!**********************************************************************!*\
  !*** ../../packages/db/src/repositories/AnalysisReportRepository.ts ***!
  \**********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AnalysisReportRepository: () => (/* binding */ AnalysisReportRepository),\n/* harmony export */   analysisReportRepository: () => (/* binding */ analysisReportRepository)\n/* harmony export */ });\n/* harmony import */ var _models_AnalysisReport__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../models/AnalysisReport */ \"(rsc)/../../packages/db/src/models/AnalysisReport.ts\");\n/* harmony import */ var _connection__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../connection */ \"(rsc)/../../packages/db/src/connection.ts\");\n\n\n/**\n * AnalysisReportRepository class implementing the Repository Pattern\n * All database operations for AnalysisReport model should go through this repository\n * Following coding standards: no direct Mongoose calls in API routes\n */ class AnalysisReportRepository {\n    /**\n   * Ensure database connection before operations\n   * Skip connection in test environment (handled by test setup)\n   */ async ensureConnection() {\n        // In test environment, connection is handled by test setup\n        if ( false || process.env.JEST_WORKER_ID) {\n            return;\n        }\n        await (0,_connection__WEBPACK_IMPORTED_MODULE_1__[\"default\"])();\n    }\n    /**\n   * Create a new analysis report\n   * @param reportData - Analysis report creation data\n   * @returns Created analysis report\n   */ async create(reportData) {\n        await this.ensureConnection();\n        const report = new _models_AnalysisReport__WEBPACK_IMPORTED_MODULE_0__[\"default\"]({\n            userId: reportData.userId,\n            uploadId: reportData.uploadId,\n            reportTitle: reportData.reportTitle,\n            sourceDocumentCount: reportData.sourceDocumentCount,\n            status: reportData.status || \"processing\",\n            progress: reportData.progress || 0,\n            generatedData: reportData.generatedData\n        });\n        const savedReport = await report.save();\n        return this.transformToPublicReport(savedReport);\n    }\n    /**\n   * Find analysis report by ID\n   * @param reportId - Report's MongoDB ObjectId as string\n   * @returns Analysis report or null if not found\n   */ async findById(reportId) {\n        await this.ensureConnection();\n        const report = await _models_AnalysisReport__WEBPACK_IMPORTED_MODULE_0__[\"default\"].findById(reportId).exec();\n        if (!report) return null;\n        return this.transformToPublicReport(report);\n    }\n    /**\n   * Find analysis reports by user ID\n   * @param userId - User's MongoDB ObjectId as string\n   * @param limit - Maximum number of reports to return (default: 50)\n   * @returns Array of analysis reports sorted by creation date (newest first)\n   */ async findByUserId(userId, limit = 50) {\n        await this.ensureConnection();\n        const reports = await _models_AnalysisReport__WEBPACK_IMPORTED_MODULE_0__[\"default\"].find({\n            userId\n        }).sort({\n            createdAt: -1\n        }).limit(limit).exec();\n        return reports.map((report)=>this.transformToPublicReport(report));\n    }\n    /**\n   * Find analysis reports by user ID and status\n   * @param userId - User's MongoDB ObjectId as string\n   * @param status - Analysis status to filter by\n   * @param limit - Maximum number of reports to return (default: 50)\n   * @returns Array of analysis reports with specified status\n   */ async findByUserIdAndStatus(userId, status, limit = 50) {\n        await this.ensureConnection();\n        const reports = await _models_AnalysisReport__WEBPACK_IMPORTED_MODULE_0__[\"default\"].find({\n            userId,\n            status\n        }).sort({\n            createdAt: -1\n        }).limit(limit).exec();\n        return reports.map((report)=>this.transformToPublicReport(report));\n    }\n    /**\n   * Update analysis report by ID\n   * @param reportId - Report's MongoDB ObjectId as string\n   * @param updateData - Partial report data to update\n   * @returns Updated analysis report or null if not found\n   */ async updateById(reportId, updateData) {\n        await this.ensureConnection();\n        const updateFields = {};\n        if (updateData.reportTitle !== undefined) updateFields.reportTitle = updateData.reportTitle;\n        if (updateData.status !== undefined) updateFields.status = updateData.status;\n        if (updateData.progress !== undefined) updateFields.progress = updateData.progress;\n        if (updateData.generatedData !== undefined) updateFields.generatedData = updateData.generatedData;\n        if (updateData.completedAt !== undefined) updateFields.completedAt = updateData.completedAt;\n        const report = await _models_AnalysisReport__WEBPACK_IMPORTED_MODULE_0__[\"default\"].findByIdAndUpdate(reportId, {\n            $set: updateFields\n        }, {\n            new: true,\n            runValidators: true\n        }).exec();\n        if (!report) return null;\n        return this.transformToPublicReport(report);\n    }\n    /**\n   * Delete analysis report by ID\n   * @param reportId - Report's MongoDB ObjectId as string\n   * @returns true if deleted, false if not found\n   */ async deleteById(reportId) {\n        await this.ensureConnection();\n        const result = await _models_AnalysisReport__WEBPACK_IMPORTED_MODULE_0__[\"default\"].findByIdAndDelete(reportId).exec();\n        return !!result;\n    }\n    /**\n   * Delete all analysis reports for a user\n   * @param userId - User's MongoDB ObjectId as string\n   * @returns Number of reports deleted\n   */ async deleteByUserId(userId) {\n        await this.ensureConnection();\n        const result = await _models_AnalysisReport__WEBPACK_IMPORTED_MODULE_0__[\"default\"].deleteMany({\n            userId\n        }).exec();\n        return result.deletedCount || 0;\n    }\n    /**\n   * Find analysis report by upload ID\n   * @param uploadId - Upload ID associated with the analysis\n   * @returns Analysis report or null if not found\n   */ async findByUploadId(uploadId) {\n        await this.ensureConnection();\n        const report = await _models_AnalysisReport__WEBPACK_IMPORTED_MODULE_0__[\"default\"].findOne({\n            uploadId\n        }).exec();\n        if (!report) return null;\n        return this.transformToPublicReport(report);\n    }\n    /**\n   * Count analysis reports by user ID\n   * @param userId - User's MongoDB ObjectId as string\n   * @returns Number of analysis reports for the user\n   */ async countByUserId(userId) {\n        await this.ensureConnection();\n        return _models_AnalysisReport__WEBPACK_IMPORTED_MODULE_0__[\"default\"].countDocuments({\n            userId\n        }).exec();\n    }\n    /**\n   * Count analysis reports by user ID and status\n   * @param userId - User's MongoDB ObjectId as string\n   * @param status - Analysis status to count\n   * @returns Number of analysis reports with specified status\n   */ async countByUserIdAndStatus(userId, status) {\n        await this.ensureConnection();\n        return _models_AnalysisReport__WEBPACK_IMPORTED_MODULE_0__[\"default\"].countDocuments({\n            userId,\n            status\n        }).exec();\n    }\n    /**\n   * Find analysis reports with pagination and filtering\n   * @param filters - Filter criteria for the query\n   * @param options - Pagination and sorting options\n   * @returns Paginated results with data and pagination info\n   */ async findPaginated(filters, options) {\n        await this.ensureConnection();\n        const { page, limit, sort = {\n            createdAt: -1\n        } } = options;\n        const skip = (page - 1) * limit;\n        const [data, total] = await Promise.all([\n            _models_AnalysisReport__WEBPACK_IMPORTED_MODULE_0__[\"default\"].find(filters).sort(sort).skip(skip).limit(limit).exec(),\n            _models_AnalysisReport__WEBPACK_IMPORTED_MODULE_0__[\"default\"].countDocuments(filters).exec()\n        ]);\n        return {\n            data: data.map((report)=>this.transformToPublicReport(report)),\n            page,\n            limit,\n            total,\n            pages: Math.ceil(total / limit)\n        };\n    }\n    /**\n   * Delete analysis report by ID with user ownership check\n   * @param reportId - Report's MongoDB ObjectId as string\n   * @param userId - User's MongoDB ObjectId as string for ownership verification\n   * @returns true if deleted, false if not found or access denied\n   */ async deleteByIdAndUserId(reportId, userId) {\n        await this.ensureConnection();\n        const result = await _models_AnalysisReport__WEBPACK_IMPORTED_MODULE_0__[\"default\"].findOneAndDelete({\n            _id: reportId,\n            userId\n        }).exec();\n        return !!result;\n    }\n    /**\n   * Transform AnalysisReportDocument to public AnalysisReport interface\n   * @param reportDoc - Mongoose AnalysisReportDocument\n   * @returns Public analysis report data\n   */ transformToPublicReport(reportDoc) {\n        return {\n            _id: reportDoc._id.toString(),\n            userId: reportDoc.userId,\n            uploadId: reportDoc.uploadId,\n            reportTitle: reportDoc.reportTitle,\n            sourceDocumentCount: reportDoc.sourceDocumentCount,\n            status: reportDoc.status,\n            progress: reportDoc.progress,\n            generatedData: reportDoc.generatedData,\n            createdAt: reportDoc.createdAt,\n            updatedAt: reportDoc.updatedAt,\n            completedAt: reportDoc.completedAt\n        };\n    }\n}\n/**\n * Export singleton instance for use in API routes\n * This ensures consistent database connection handling\n */ const analysisReportRepository = new AnalysisReportRepository();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vcGFja2FnZXMvZGIvc3JjL3JlcG9zaXRvcmllcy9BbmFseXNpc1JlcG9ydFJlcG9zaXRvcnkudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUNzRDtBQUNoQjtBQWtCdEM7Ozs7Q0FJQyxHQUNNLE1BQU1FO0lBQ1g7OztHQUdDLEdBQ0QsTUFBY0MsbUJBQWtDO1FBQzlDLDJEQUEyRDtRQUMzRCxJQUFJQyxNQUF5QixJQUFVQSxRQUFRQyxHQUFHLENBQUNDLGNBQWMsRUFBRTtZQUNqRTtRQUNGO1FBQ0EsTUFBTUwsdURBQVNBO0lBQ2pCO0lBRUE7Ozs7R0FJQyxHQUNELE1BQU1NLE9BQU9DLFVBQW9DLEVBQTRCO1FBQzNFLE1BQU0sSUFBSSxDQUFDTCxnQkFBZ0I7UUFFM0IsTUFBTU0sU0FBUyxJQUFJVCw4REFBY0EsQ0FBQztZQUNoQ1UsUUFBUUYsV0FBV0UsTUFBTTtZQUN6QkMsVUFBVUgsV0FBV0csUUFBUTtZQUM3QkMsYUFBYUosV0FBV0ksV0FBVztZQUNuQ0MscUJBQXFCTCxXQUFXSyxtQkFBbUI7WUFDbkRDLFFBQVFOLFdBQVdNLE1BQU0sSUFBSTtZQUM3QkMsVUFBVVAsV0FBV08sUUFBUSxJQUFJO1lBQ2pDQyxlQUFlUixXQUFXUSxhQUFhO1FBQ3pDO1FBRUEsTUFBTUMsY0FBYyxNQUFNUixPQUFPUyxJQUFJO1FBQ3JDLE9BQU8sSUFBSSxDQUFDQyx1QkFBdUIsQ0FBQ0Y7SUFDdEM7SUFFQTs7OztHQUlDLEdBQ0QsTUFBTUcsU0FBU0MsUUFBZ0IsRUFBbUM7UUFDaEUsTUFBTSxJQUFJLENBQUNsQixnQkFBZ0I7UUFFM0IsTUFBTU0sU0FBUyxNQUFNVCw4REFBY0EsQ0FBQ29CLFFBQVEsQ0FBQ0MsVUFBVUMsSUFBSTtRQUMzRCxJQUFJLENBQUNiLFFBQVEsT0FBTztRQUVwQixPQUFPLElBQUksQ0FBQ1UsdUJBQXVCLENBQUNWO0lBQ3RDO0lBRUE7Ozs7O0dBS0MsR0FDRCxNQUFNYyxhQUFhYixNQUFjLEVBQUVjLFFBQWdCLEVBQUUsRUFB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LENBQUNnRSxnQkFBZ0IsQ0FBQztZQUNuREMsS0FBSzVDO1lBQ0xYO1FBQ0YsR0FBR1ksSUFBSTtRQUNQLE9BQU8sQ0FBQyxDQUFDbUI7SUFDWDtJQUVBOzs7O0dBSUMsR0FDRCx3QkFBZ0N5QixTQUFpQyxFQUFtQjtRQUNsRixPQUFPO1lBQ0xELEtBQUtDLFVBQVVELEdBQUcsQ0FBQ0UsUUFBUTtZQUMzQnpELFFBQVF3RCxVQUFVeEQsTUFBTTtZQUN4QkMsVUFBVXVELFVBQVV2RCxRQUFRO1lBQzVCQyxhQUFhc0QsVUFBVXRELFdBQVc7WUFDbENDLHFCQUFxQnFELFVBQVVyRCxtQkFBbUI7WUFDbERDLFFBQVFvRCxVQUFVcEQsTUFBTTtZQUN4QkMsVUFBVW1ELFVBQVVuRCxRQUFRO1lBQzVCQyxlQUFla0QsVUFBVWxELGFBQWE7WUFDdENZLFdBQVdzQyxVQUFVdEMsU0FBUztZQUM5QndDLFdBQVdGLFVBQVVFLFNBQVM7WUFDOUJqQyxhQUFhK0IsVUFBVS9CLFdBQVc7UUFDcEM7SUFDRjtBQUNGO0FBRUE7OztDQUdDLEdBQ00sTUFBTWtDLDJCQUEyQixJQUFJbkUsMkJBQTJCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2ViLy4uLy4uL3BhY2thZ2VzL2RiL3NyYy9yZXBvc2l0b3JpZXMvQW5hbHlzaXNSZXBvcnRSZXBvc2l0b3J5LnRzPzE1YzEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQW5hbHlzaXNSZXBvcnQgYXMgSUFuYWx5c2lzUmVwb3J0LCBDcmVhdGVBbmFseXNpc1JlcG9ydERhdGEsIFVwZGF0ZUFuYWx5c2lzUmVwb3J0RGF0YSB9IGZyb20gJ2xpYi9zcmMvdHlwZXMnO1xuaW1wb3J0IEFuYWx5c2lzUmVwb3J0IGZyb20gJy4uL21vZGVscy9BbmFseXNpc1JlcG9ydCc7XG5pbXBvcnQgZGJDb25uZWN0IGZyb20gJy4uL2Nvbm5lY3Rpb24nO1xuaW1wb3J0IHsgRG9jdW1lbnQgfSBmcm9tICdtb25nb29zZSc7XG5pbXBvcnQgbW9uZ29vc2UgZnJvbSAnbW9uZ29vc2UnO1xuXG4vKipcbiAqIERhdGFiYXNlLXNwZWNpZmljIEFuYWx5c2lzUmVwb3J0IGludGVyZmFjZVxuICogVGhpcyBleGNsdWRlcyB0aGUgX2lkIGZpZWxkIGZyb20gdGhlIHNoYXJlZCBpbnRlcmZhY2Ugc2luY2UgTW9uZ29vc2UgaGFuZGxlcyBpdCBkaWZmZXJlbnRseVxuICovXG5pbnRlcmZhY2UgRGF0YWJhc2VBbmFseXNpc1JlcG9ydCBleHRlbmRzIE9taXQ8SUFuYWx5c2lzUmVwb3J0LCAnX2lkJz4ge31cblxuLyoqXG4gKiBBbmFseXNpc1JlcG9ydCBkb2N1bWVudCBpbnRlcmZhY2UgZXh0ZW5kaW5nIE1vbmdvb3NlIERvY3VtZW50XG4gKiBUaGlzIGNvbWJpbmVzIHRoZSBkYXRhYmFzZSBBbmFseXNpc1JlcG9ydCBpbnRlcmZhY2Ugd2l0aCBNb25nb29zZSBEb2N1bWVudCBtZXRob2RzXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQW5hbHlzaXNSZXBvcnREb2N1bWVudCBleHRlbmRzIERhdGFiYXNlQW5hbHlzaXNSZXBvcnQsIERvY3VtZW50IHtcbiAgX2lkOiBtb25nb29zZS5UeXBlcy5PYmplY3RJZDtcbn1cblxuLyoqXG4gKiBBbmFseXNpc1JlcG9ydFJlcG9zaXRvcnkgY2xhc3MgaW1wbGVtZW50aW5nIHRoZSBSZXBvc2l0b3J5IFBhdHRlcm5cbiAqIEFsbCBkYXRhYmFzZSBvcGVyYXRpb25zIGZvciBBbmFseXNpc1JlcG9ydCBtb2RlbCBzaG91bGQgZ28gdGhyb3VnaCB0aGlzIHJlcG9zaXRvcnlcbiAqIEZvbGxvd2luZyBjb2Rpbmcgc3RhbmRhcmRzOiBubyBkaXJlY3QgTW9uZ29vc2UgY2FsbHMgaW4gQVBJIHJvdXRlc1xuICovXG5leHBvcnQgY2xhc3MgQW5hbHlzaXNSZXBvcnRSZXBvc2l0b3J5IHtcbiAgLyoqXG4gICAqIEVuc3VyZSBkYXRhYmFzZSBjb25uZWN0aW9uIGJlZm9yZSBvcGVyYXRpb25zXG4gICAqIFNraXAgY29ubmVjdGlvbiBpbiB0ZXN0IGVudmlyb25tZW50IChoYW5kbGVkIGJ5IHRlc3Qgc2V0dXApXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGVuc3VyZUNvbm5lY3Rpb24oKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gSW4gdGVzdCBlbnZpcm9ubWVudCwgY29ubmVjdGlvbiBpcyBoYW5kbGVkIGJ5IHRlc3Qgc2V0dXBcbiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICd0ZXN0JyB8fCBwcm9jZXNzLmVudi5KRVNUX1dPUktFUl9JRCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBhd2FpdCBkYkNvbm5lY3QoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBuZXcgYW5hbHlzaXMgcmVwb3J0XG4gICAqIEBwYXJhbSByZXBvcnREYXRhIC0gQW5hbHlzaXMgcmVwb3J0IGNyZWF0aW9uIGRhdGFcbiAgICogQHJldHVybnMgQ3JlYXRlZCBhbmFseXNpcyByZXBvcnRcbiAgICovXG4gIGFzeW5jIGNyZWF0ZShyZXBvcnREYXRhOiBDcmVhdGVBbmFseXNpc1JlcG9ydERhdGEpOiBQcm9taXNlPElBbmFseXNpc1JlcG9ydD4ge1xuICAgIGF3YWl0IHRoaXMuZW5zdXJlQ29ubmVjdGlvbigpO1xuICAgIFxuICAgIGNvbnN0IHJlcG9ydCA9IG5ldyBBbmFseXNpc1JlcG9ydCh7XG4gICAgICB1c2VySWQ6IHJlcG9ydERhdGEudXNlcklkLFxuICAgICAgdXBsb2FkSWQ6IHJlcG9ydERhdGEudXBsb2FkSWQsXG4gICAgICByZXBvcnRUaXRsZTogcmVwb3J0RGF0YS5yZXBvcnRUaXRsZSxcbiAgICAgIHNvdXJjZURvY3VtZW50Q291bnQ6IHJlcG9ydERhdGEuc291cmNlRG9jdW1lbnRDb3VudCxcbiAgICAgIHN0YXR1czogcmVwb3J0RGF0YS5zdGF0dXMgfHwgJ3Byb2Nlc3NpbmcnLFxuICAgICAgcHJvZ3Jlc3M6IHJlcG9ydERhdGEucHJvZ3Jlc3MgfHwgMCxcbiAgICAgIGdlbmVyYXRlZERhdGE6IHJlcG9ydERhdGEuZ2VuZXJhdGVkRGF0YSxcbiAgICB9KTtcblxuICAgIGNvbnN0IHNhdmVkUmVwb3J0ID0gYXdhaXQgcmVwb3J0LnNhdmUoKTtcbiAgICByZXR1cm4gdGhpcy50cmFuc2Zvcm1Ub1B1YmxpY1JlcG9ydChzYXZlZFJlcG9ydCk7XG4gIH1cblxuICAvKipcbiAgICogRmluZCBhbmFseXNpcyByZXBvcnQgYnkgSURcbiAgICogQHBhcmFtIHJlcG9ydElkIC0gUmVwb3J0J3MgTW9uZ29EQiBPYmplY3RJZCBhcyBzdHJpbmdcbiAgICogQHJldHVybnMgQW5hbHlzaXMgcmVwb3J0IG9yIG51bGwgaWYgbm90IGZvdW5kXG4gICAqL1xuICBhc3luYyBmaW5kQnlJZChyZXBvcnRJZDogc3RyaW5nKTogUHJvbWlzZTxJQW5hbHlzaXNSZXBvcnQgfCBudWxsPiB7XG4gICAgYXdhaXQgdGhpcy5lbnN1cmVDb25uZWN0aW9uKCk7XG4gICAgXG4gICAgY29uc3QgcmVwb3J0ID0gYXdhaXQgQW5hbHlzaXNSZXBvcnQuZmluZEJ5SWQocmVwb3J0SWQpLmV4ZWMoKTtcbiAgICBpZiAoIXJlcG9ydCkgcmV0dXJuIG51bGw7XG5cbiAgICByZXR1cm4gdGhpcy50cmFuc2Zvcm1Ub1B1YmxpY1JlcG9ydChyZXBvcnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEZpbmQgYW5hbHlzaXMgcmVwb3J0cyBieSB1c2VyIElEXG4gICAqIEBwYXJhbSB1c2VySWQgLSBVc2VyJ3MgTW9uZ29EQiBPYmplY3RJZCBhcyBzdHJpbmdcbiAgICogQHBhcmFtIGxpbWl0IC0gTWF4aW11bSBudW1iZXIgb2YgcmVwb3J0cyB0byByZXR1cm4gKGRlZmF1bHQ6IDUwKVxuICAgKiBAcmV0dXJucyBBcnJheSBvZiBhbmFseXNpcyByZXBvcnRzIHNvcnRlZCBieSBjcmVhdGlvbiBkYXRlIChuZXdlc3QgZmlyc3QpXG4gICAqL1xuICBhc3luYyBmaW5kQnlVc2VySWQodXNlcklkOiBzdHJpbmcsIGxpbWl0OiBudW1iZXIgPSA1MCk6IFByb21pc2U8SUFuYWx5c2lzUmVwb3J0W10+IHtcbiAgICBhd2FpdCB0aGlzLmVuc3VyZUNvbm5lY3Rpb24oKTtcbiAgICBcbiAgICBjb25zdCByZXBvcnRzID0gYXdhaXQgQW5hbHlzaXNSZXBvcnRcbiAgICAgIC5maW5kKHsgdXNlcklkIH0pXG4gICAgICAuc29ydCh7IGNyZWF0ZWRBdDogLTEgfSlcbiAgICAgIC5saW1pdChsaW1pdClcbiAgICAgIC5leGVjKCk7XG5cbiAgICByZXR1cm4gcmVwb3J0cy5tYXAocmVwb3J0ID0+IHRoaXMudHJhbnNmb3JtVG9QdWJsaWNSZXBvcnQocmVwb3J0KSk7XG4gIH1cblxuICAvKipcbiAgICogRmluZCBhbmFseXNpcyByZXBvcnRzIGJ5IHVzZXIgSUQgYW5kIHN0YXR1c1xuICAgKiBAcGFyYW0gdXNlcklkIC0gVXNlcidzIE1vbmdvREIgT2JqZWN0SWQgYXMgc3RyaW5nXG4gICAqIEBwYXJhbSBzdGF0dXMgLSBBbmFseXNpcyBzdGF0dXMgdG8gZmlsdGVyIGJ5XG4gICAqIEBwYXJhbSBsaW1pdCAtIE1heGltdW0gbnVtYmVyIG9mIHJlcG9ydHMgdG8gcmV0dXJuIChkZWZhdWx0OiA1MClcbiAgICogQHJldHVybnMgQXJyYXkgb2YgYW5hbHlzaXMgcmVwb3J0cyB3aXRoIHNwZWNpZmllZCBzdGF0dXNcbiAgICovXG4gIGFzeW5jIGZpbmRCeVVzZXJJZEFuZFN0YXR1cyh1c2VySWQ6IHN0cmluZywgc3RhdHVzOiBzdHJpbmcsIGxpbWl0OiBudW1iZXIgPSA1MCk6IFByb21pc2U8SUFuYWx5c2lzUmVwb3J0W10+IHtcbiAgICBhd2FpdCB0aGlzLmVuc3VyZUNvbm5lY3Rpb24oKTtcbiAgICBcbiAgICBjb25zdCByZXBvcnRzID0gYXdhaXQgQW5hbHlzaXNSZXBvcnRcbiAgICAgIC5maW5kKHsgdXNlcklkLCBzdGF0dXMgfSlcbiAgICAgIC5zb3J0KHsgY3JlYXRlZEF0OiAtMSB9KVxuICAgICAgLmxpbWl0KGxpbWl0KVxuICAgICAgLmV4ZWMoKTtcblxuICAgIHJldHVybiByZXBvcnRzLm1hcChyZXBvcnQgPT4gdGhpcy50cmFuc2Zvcm1Ub1B1YmxpY1JlcG9ydChyZXBvcnQpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgYW5hbHlzaXMgcmVwb3J0IGJ5IElEXG4gICAqIEBwYXJhbSByZXBvcnRJZCAtIFJlcG9ydCdzIE1vbmdvREIgT2JqZWN0SWQgYXMgc3RyaW5nXG4gICAqIEBwYXJhbSB1cGRhdGVEYXRhIC0gUGFydGlhbCByZXBvcnQgZGF0YSB0byB1cGRhdGVcbiAgICogQHJldHVybnMgVXBkYXRlZCBhbmFseXNpcyByZXBvcnQgb3IgbnVsbCBpZiBub3QgZm91bmRcbiAgICovXG4gIGFzeW5jIHVwZGF0ZUJ5SWQocmVwb3J0SWQ6IHN0cmluZywgdXBkYXRlRGF0YTogVXBkYXRlQW5hbHlzaXNSZXBvcnREYXRhKTogUHJvbWlzZTxJQW5hbHlzaXNSZXBvcnQgfCBudWxsPiB7XG4gICAgYXdhaXQgdGhpcy5lbnN1cmVDb25uZWN0aW9uKCk7XG4gICAgXG4gICAgY29uc3QgdXBkYXRlRmllbGRzOiBhbnkgPSB7fTtcbiAgICBcbiAgICBpZiAodXBkYXRlRGF0YS5yZXBvcnRUaXRsZSAhPT0gdW5kZWZpbmVkKSB1cGRhdGVGaWVsZHMucmVwb3J0VGl0bGUgPSB1cGRhdGVEYXRhLnJlcG9ydFRpdGxlO1xuICAgIGlmICh1cGRhdGVEYXRhLnN0YXR1cyAhPT0gdW5kZWZpbmVkKSB1cGRhdGVGaWVsZHMuc3RhdHVzID0gdXBkYXRlRGF0YS5zdGF0dXM7XG4gICAgaWYgKHVwZGF0ZURhdGEucHJvZ3Jlc3MgIT09IHVuZGVmaW5lZCkgdXBkYXRlRmllbGRzLnByb2dyZXNzID0gdXBkYXRlRGF0YS5wcm9ncmVzcztcbiAgICBpZiAodXBkYXRlRGF0YS5nZW5lcmF0ZWREYXRhICE9PSB1bmRlZmluZWQpIHVwZGF0ZUZpZWxkcy5nZW5lcmF0ZWREYXRhID0gdXBkYXRlRGF0YS5nZW5lcmF0ZWREYXRhO1xuICAgIGlmICh1cGRhdGVEYXRhLmNvbXBsZXRlZEF0ICE9PSB1bmRlZmluZWQpIHVwZGF0ZUZpZWxkcy5jb21wbGV0ZWRBdCA9IHVwZGF0ZURhdGEuY29tcGxldGVkQXQ7XG5cbiAgICBjb25zdCByZXBvcnQgPSBhd2FpdCBBbmFseXNpc1JlcG9ydC5maW5kQnlJZEFuZFVwZGF0ZShcbiAgICAgIHJlcG9ydElkLFxuICAgICAgeyAkc2V0OiB1cGRhdGVGaWVsZHMgfSxcbiAgICAgIHsgbmV3OiB0cnVlLCBydW5WYWxpZGF0b3JzOiB0cnVlIH1cbiAgICApLmV4ZWMoKTtcblxuICAgIGlmICghcmVwb3J0KSByZXR1cm4gbnVsbDtcbiAgICByZXR1cm4gdGhpcy50cmFuc2Zvcm1Ub1B1YmxpY1JlcG9ydChyZXBvcnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIERlbGV0ZSBhbmFseXNpcyByZXBvcnQgYnkgSURcbiAgICogQHBhcmFtIHJlcG9ydElkIC0gUmVwb3J0J3MgTW9uZ29EQiBPYmplY3RJZCBhcyBzdHJpbmdcbiAgICogQHJldHVybnMgdHJ1ZSBpZiBkZWxldGVkLCBmYWxzZSBpZiBub3QgZm91bmRcbiAgICovXG4gIGFzeW5jIGRlbGV0ZUJ5SWQocmVwb3J0SWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGF3YWl0IHRoaXMuZW5zdXJlQ29ubmVjdGlvbigpO1xuICAgIFxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IEFuYWx5c2lzUmVwb3J0LmZpbmRCeUlkQW5kRGVsZXRlKHJlcG9ydElkKS5leGVjKCk7XG4gICAgcmV0dXJuICEhcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIERlbGV0ZSBhbGwgYW5hbHlzaXMgcmVwb3J0cyBmb3IgYSB1c2VyXG4gICAqIEBwYXJhbSB1c2VySWQgLSBVc2VyJ3MgTW9uZ29EQiBPYmplY3RJZCBhcyBzdHJpbmdcbiAgICogQHJldHVybnMgTnVtYmVyIG9mIHJlcG9ydHMgZGVsZXRlZFxuICAgKi9cbiAgYXN5bmMgZGVsZXRlQnlVc2VySWQodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIGF3YWl0IHRoaXMuZW5zdXJlQ29ubmVjdGlvbigpO1xuICAgIFxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IEFuYWx5c2lzUmVwb3J0LmRlbGV0ZU1hbnkoeyB1c2VySWQgfSkuZXhlYygpO1xuICAgIHJldHVybiByZXN1bHQuZGVsZXRlZENvdW50IHx8IDA7XG4gIH1cblxuICAvKipcbiAgICogRmluZCBhbmFseXNpcyByZXBvcnQgYnkgdXBsb2FkIElEXG4gICAqIEBwYXJhbSB1cGxvYWRJZCAtIFVwbG9hZCBJRCBhc3NvY2lhdGVkIHdpdGggdGhlIGFuYWx5c2lzXG4gICAqIEByZXR1cm5zIEFuYWx5c2lzIHJlcG9ydCBvciBudWxsIGlmIG5vdCBmb3VuZFxuICAgKi9cbiAgYXN5bmMgZmluZEJ5VXBsb2FkSWQodXBsb2FkSWQ6IHN0cmluZyk6IFByb21pc2U8SUFuYWx5c2lzUmVwb3J0IHwgbnVsbD4ge1xuICAgIGF3YWl0IHRoaXMuZW5zdXJlQ29ubmVjdGlvbigpO1xuICAgIFxuICAgIGNvbnN0IHJlcG9ydCA9IGF3YWl0IEFuYWx5c2lzUmVwb3J0LmZpbmRPbmUoeyB1cGxvYWRJZCB9KS5leGVjKCk7XG4gICAgaWYgKCFyZXBvcnQpIHJldHVybiBudWxsO1xuXG4gICAgcmV0dXJuIHRoaXMudHJhbnNmb3JtVG9QdWJsaWNSZXBvcnQocmVwb3J0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb3VudCBhbmFseXNpcyByZXBvcnRzIGJ5IHVzZXIgSURcbiAgICogQHBhcmFtIHVzZXJJZCAtIFVzZXIncyBNb25nb0RCIE9iamVjdElkIGFzIHN0cmluZ1xuICAgKiBAcmV0dXJucyBOdW1iZXIgb2YgYW5hbHlzaXMgcmVwb3J0cyBmb3IgdGhlIHVzZXJcbiAgICovXG4gIGFzeW5jIGNvdW50QnlVc2VySWQodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIGF3YWl0IHRoaXMuZW5zdXJlQ29ubmVjdGlvbigpO1xuICAgIFxuICAgIHJldHVybiBBbmFseXNpc1JlcG9ydC5jb3VudERvY3VtZW50cyh7IHVzZXJJZCB9KS5leGVjKCk7XG4gIH1cblxuICAvKipcbiAgICogQ291bnQgYW5hbHlzaXMgcmVwb3J0cyBieSB1c2VyIElEIGFuZCBzdGF0dXNcbiAgICogQHBhcmFtIHVzZXJJZCAtIFVzZXIncyBNb25nb0RCIE9iamVjdElkIGFzIHN0cmluZ1xuICAgKiBAcGFyYW0gc3RhdHVzIC0gQW5hbHlzaXMgc3RhdHVzIHRvIGNvdW50XG4gICAqIEByZXR1cm5zIE51bWJlciBvZiBhbmFseXNpcyByZXBvcnRzIHdpdGggc3BlY2lmaWVkIHN0YXR1c1xuICAgKi9cbiAgYXN5bmMgY291bnRCeVVzZXJJZEFuZFN0YXR1cyh1c2VySWQ6IHN0cmluZywgc3RhdHVzOiBzdHJpbmcpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIGF3YWl0IHRoaXMuZW5zdXJlQ29ubmVjdGlvbigpO1xuICAgIFxuICAgIHJldHVybiBBbmFseXNpc1JlcG9ydC5jb3VudERvY3VtZW50cyh7IHVzZXJJZCwgc3RhdHVzIH0pLmV4ZWMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGaW5kIGFuYWx5c2lzIHJlcG9ydHMgd2l0aCBwYWdpbmF0aW9uIGFuZCBmaWx0ZXJpbmdcbiAgICogQHBhcmFtIGZpbHRlcnMgLSBGaWx0ZXIgY3JpdGVyaWEgZm9yIHRoZSBxdWVyeVxuICAgKiBAcGFyYW0gb3B0aW9ucyAtIFBhZ2luYXRpb24gYW5kIHNvcnRpbmcgb3B0aW9uc1xuICAgKiBAcmV0dXJucyBQYWdpbmF0ZWQgcmVzdWx0cyB3aXRoIGRhdGEgYW5kIHBhZ2luYXRpb24gaW5mb1xuICAgKi9cbiAgYXN5bmMgZmluZFBhZ2luYXRlZChcbiAgICBmaWx0ZXJzOiBhbnksXG4gICAgb3B0aW9uczogeyBwYWdlOiBudW1iZXI7IGxpbWl0OiBudW1iZXI7IHNvcnQ/OiBhbnkgfVxuICApOiBQcm9taXNlPHtcbiAgICBkYXRhOiBJQW5hbHlzaXNSZXBvcnRbXTtcbiAgICBwYWdlOiBudW1iZXI7XG4gICAgbGltaXQ6IG51bWJlcjtcbiAgICB0b3RhbDogbnVtYmVyO1xuICAgIHBhZ2VzOiBudW1iZXI7XG4gIH0+IHtcbiAgICBhd2FpdCB0aGlzLmVuc3VyZUNvbm5lY3Rpb24oKTtcbiAgICBcbiAgICBjb25zdCB7IHBhZ2UsIGxpbWl0LCBzb3J0ID0geyBjcmVhdGVkQXQ6IC0xIH0gfSA9IG9wdGlvbnM7XG4gICAgY29uc3Qgc2tpcCA9IChwYWdlIC0gMSkgKiBsaW1pdDtcblxuICAgIGNvbnN0IFtkYXRhLCB0b3RhbF0gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICBBbmFseXNpc1JlcG9ydC5maW5kKGZpbHRlcnMpXG4gICAgICAgIC5zb3J0KHNvcnQpXG4gICAgICAgIC5za2lwKHNraXApXG4gICAgICAgIC5saW1pdChsaW1pdClcbiAgICAgICAgLmV4ZWMoKSxcbiAgICAgIEFuYWx5c2lzUmVwb3J0LmNvdW50RG9jdW1lbnRzKGZpbHRlcnMpLmV4ZWMoKVxuICAgIF0pO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGRhdGE6IGRhdGEubWFwKHJlcG9ydCA9PiB0aGlzLnRyYW5zZm9ybVRvUHVibGljUmVwb3J0KHJlcG9ydCkpLFxuICAgICAgcGFnZSxcbiAgICAgIGxpbWl0LFxuICAgICAgdG90YWwsXG4gICAgICBwYWdlczogTWF0aC5jZWlsKHRvdGFsIC8gbGltaXQpXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGUgYW5hbHlzaXMgcmVwb3J0IGJ5IElEIHdpdGggdXNlciBvd25lcnNoaXAgY2hlY2tcbiAgICogQHBhcmFtIHJlcG9ydElkIC0gUmVwb3J0J3MgTW9uZ29EQiBPYmplY3RJZCBhcyBzdHJpbmdcbiAgICogQHBhcmFtIHVzZXJJZCAtIFVzZXIncyBNb25nb0RCIE9iamVjdElkIGFzIHN0cmluZyBmb3Igb3duZXJzaGlwIHZlcmlmaWNhdGlvblxuICAgKiBAcmV0dXJucyB0cnVlIGlmIGRlbGV0ZWQsIGZhbHNlIGlmIG5vdCBmb3VuZCBvciBhY2Nlc3MgZGVuaWVkXG4gICAqL1xuICBhc3luYyBkZWxldGVCeUlkQW5kVXNlcklkKHJlcG9ydElkOiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgYXdhaXQgdGhpcy5lbnN1cmVDb25uZWN0aW9uKCk7XG4gICAgXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgQW5hbHlzaXNSZXBvcnQuZmluZE9uZUFuZERlbGV0ZSh7IFxuICAgICAgX2lkOiByZXBvcnRJZCwgXG4gICAgICB1c2VySWQgXG4gICAgfSkuZXhlYygpO1xuICAgIHJldHVybiAhIXJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBUcmFuc2Zvcm0gQW5hbHlzaXNSZXBvcnREb2N1bWVudCB0byBwdWJsaWMgQW5hbHlzaXNSZXBvcnQgaW50ZXJmYWNlXG4gICAqIEBwYXJhbSByZXBvcnREb2MgLSBNb25nb29zZSBBbmFseXNpc1JlcG9ydERvY3VtZW50XG4gICAqIEByZXR1cm5zIFB1YmxpYyBhbmFseXNpcyByZXBvcnQgZGF0YVxuICAgKi9cbiAgcHJpdmF0ZSB0cmFuc2Zvcm1Ub1B1YmxpY1JlcG9ydChyZXBvcnREb2M6IEFuYWx5c2lzUmVwb3J0RG9jdW1lbnQpOiBJQW5hbHlzaXNSZXBvcnQge1xuICAgIHJldHVybiB7XG4gICAgICBfaWQ6IHJlcG9ydERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgIHVzZXJJZDogcmVwb3J0RG9jLnVzZXJJZCxcbiAgICAgIHVwbG9hZElkOiByZXBvcnREb2MudXBsb2FkSWQsXG4gICAgICByZXBvcnRUaXRsZTogcmVwb3J0RG9jLnJlcG9ydFRpdGxlLFxuICAgICAgc291cmNlRG9jdW1lbnRDb3VudDogcmVwb3J0RG9jLnNvdXJjZURvY3VtZW50Q291bnQsXG4gICAgICBzdGF0dXM6IHJlcG9ydERvYy5zdGF0dXMsXG4gICAgICBwcm9ncmVzczogcmVwb3J0RG9jLnByb2dyZXNzLFxuICAgICAgZ2VuZXJhdGVkRGF0YTogcmVwb3J0RG9jLmdlbmVyYXRlZERhdGEsXG4gICAgICBjcmVhdGVkQXQ6IHJlcG9ydERvYy5jcmVhdGVkQXQsXG4gICAgICB1cGRhdGVkQXQ6IHJlcG9ydERvYy51cGRhdGVkQXQsXG4gICAgICBjb21wbGV0ZWRBdDogcmVwb3J0RG9jLmNvbXBsZXRlZEF0LFxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBFeHBvcnQgc2luZ2xldG9uIGluc3RhbmNlIGZvciB1c2UgaW4gQVBJIHJvdXRlc1xuICogVGhpcyBlbnN1cmVzIGNvbnNpc3RlbnQgZGF0YWJhc2UgY29ubmVjdGlvbiBoYW5kbGluZ1xuICovXG5leHBvcnQgY29uc3QgYW5hbHlzaXNSZXBvcnRSZXBvc2l0b3J5ID0gbmV3IEFuYWx5c2lzUmVwb3J0UmVwb3NpdG9yeSgpO1xuIl0sIm5hbWVzIjpbIkFuYWx5c2lzUmVwb3J0IiwiZGJDb25uZWN0IiwiQW5hbHlzaXNSZXBvcnRSZXBvc2l0b3J5IiwiZW5zdXJlQ29ubmVjdGlvbiIsInByb2Nlc3MiLCJlbnYiLCJKRVNUX1dPUktFUl9JRCIsImNyZWF0ZSIsInJlcG9ydERhdGEiLCJyZXBvcnQiLCJ1c2VySWQiLCJ1cGxvYWRJZCIsInJlcG9ydFRpdGxlIiwic291cmNlRG9jdW1lbnRDb3VudCIsInN0YXR1cyIsInByb2dyZXNzIiwiZ2VuZXJhdGVkRGF0YSIsInNhdmVkUmVwb3J0Iiwic2F2ZSIsInRyYW5zZm9ybVRvUHVibGljUmVwb3J0IiwiZmluZEJ5SWQiLCJyZXBvcnRJZCIsImV4ZWMiLCJmaW5kQnlVc2VySWQiLCJsaW1pdCIsInJlcG9ydHMiLCJmaW5kIiwic29ydCIsImNyZWF0ZWRBdCIsIm1hcCIsImZpbmRCeVVzZXJJZEFuZFN0YXR1cyIsInVwZGF0ZUJ5SWQiLCJ1cGRhdGVEYXRhIiwidXBkYXRlRmllbGRzIiwidW5kZWZpbmVkIiwiY29tcGxldGVkQXQiLCJmaW5kQnlJZEFuZFVwZGF0ZSIsIiRzZXQiLCJuZXciLCJydW5WYWxpZGF0b3JzIiwiZGVsZXRlQnlJZCIsInJlc3VsdCIsImZpbmRCeUlkQW5kRGVsZXRlIiwiZGVsZXRlQnlVc2VySWQiLCJkZWxldGVNYW55IiwiZGVsZXRlZENvdW50IiwiZmluZEJ5VXBsb2FkSWQiLCJmaW5kT25lIiwiY291bnRCeVVzZXJJZCIsImNvdW50RG9jdW1lbnRzIiwiY291bnRCeVVzZXJJZEFuZFN0YXR1cyIsImZpbmRQYWdpbmF0ZWQiLCJmaWx0ZXJzIiwib3B0aW9ucyIsInBhZ2UiLCJza2lwIiwiZGF0YSIsInRvdGFsIiwiUHJvbWlzZSIsImFsbCIsInBhZ2VzIiwiTWF0aCIsImNlaWwiLCJkZWxldGVCeUlkQW5kVXNlcklkIiwiZmluZE9uZUFuZERlbGV0ZSIsIl9pZCIsInJlcG9ydERvYyIsInRvU3RyaW5nIiwidXBkYXRlZEF0IiwiYW5hbHlzaXNSZXBvcnRSZXBvc2l0b3J5Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/../../packages/db/src/repositories/AnalysisReportRepository.ts\n");

/***/ }),

/***/ "(rsc)/../../packages/db/src/repositories/UserRepository.ts":
/*!************************************************************!*\
  !*** ../../packages/db/src/repositories/UserRepository.ts ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   UserRepository: () => (/* binding */ UserRepository),\n/* harmony export */   userRepository: () => (/* binding */ userRepository)\n/* harmony export */ });\n/* harmony import */ var _models_User__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../models/User */ \"(rsc)/../../packages/db/src/models/User.ts\");\n/* harmony import */ var _connection__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../connection */ \"(rsc)/../../packages/db/src/connection.ts\");\n\n\n/**\n * UserRepository class implementing the Repository Pattern\n * All database operations for User model should go through this repository\n * Following coding standards: no direct Mongoose calls in API routes\n */ class UserRepository {\n    /**\n   * Ensure database connection before operations\n   * Skip connection in test environment (handled by test setup)\n   */ async ensureConnection() {\n        // In test environment, connection is handled by test setup\n        if ( false || process.env.JEST_WORKER_ID) {\n            return;\n        }\n        await (0,_connection__WEBPACK_IMPORTED_MODULE_1__[\"default\"])();\n    }\n    /**\n   * Find user by email\n   * @param email - User's email address\n   * @returns User document or null if not found\n   */ async findByEmail(email) {\n        await this.ensureConnection();\n        const user = await _models_User__WEBPACK_IMPORTED_MODULE_0__[\"default\"].findOne({\n            email\n        }).exec();\n        if (!user) return null;\n        // Transform to match shared interface (exclude password)\n        return this.transformToPublicUser(user);\n    }\n    /**\n   * Find user by ID\n   * @param userId - User's MongoDB ObjectId as string\n   * @returns User document or null if not found\n   */ async findById(userId) {\n        await this.ensureConnection();\n        const user = await _models_User__WEBPACK_IMPORTED_MODULE_0__[\"default\"].findById(userId).exec();\n        if (!user) return null;\n        return this.transformToPublicUser(user);\n    }\n    /**\n   * Create a new user\n   * @param userData - User creation data with password\n   * @returns Created user (without password)\n   */ async create(userData) {\n        await this.ensureConnection();\n        const user = new _models_User__WEBPACK_IMPORTED_MODULE_0__[\"default\"]({\n            name: userData.name,\n            email: userData.email,\n            password: userData.password\n        });\n        const savedUser = await user.save();\n        return this.transformToPublicUser(savedUser);\n    }\n    /**\n   * Update user by ID\n   * @param userId - User's MongoDB ObjectId as string\n   * @param updateData - Partial user data to update\n   * @returns Updated user or null if not found\n   */ async updateById(userId, updateData) {\n        await this.ensureConnection();\n        const user = await _models_User__WEBPACK_IMPORTED_MODULE_0__[\"default\"].findByIdAndUpdate(userId, {\n            $set: updateData\n        }, {\n            new: true,\n            runValidators: true\n        }).exec();\n        if (!user) return null;\n        return this.transformToPublicUser(user);\n    }\n    /**\n   * Delete user by ID\n   * @param userId - User's MongoDB ObjectId as string\n   * @returns true if deleted, false if not found\n   */ async deleteById(userId) {\n        await this.ensureConnection();\n        const result = await _models_User__WEBPACK_IMPORTED_MODULE_0__[\"default\"].findByIdAndDelete(userId).exec();\n        return !!result;\n    }\n    /**\n   * Check if user exists by email\n   * @param email - User's email address\n   * @returns true if user exists, false otherwise\n   */ async existsByEmail(email) {\n        await this.ensureConnection();\n        const count = await _models_User__WEBPACK_IMPORTED_MODULE_0__[\"default\"].countDocuments({\n            email\n        }).exec();\n        return count > 0;\n    }\n    /**\n   * Find user by email including password (for authentication)\n   * @param email - User's email address\n   * @returns User document with password or null if not found\n   */ async findByEmailWithPassword(email) {\n        await this.ensureConnection();\n        return _models_User__WEBPACK_IMPORTED_MODULE_0__[\"default\"].findOne({\n            email\n        }).exec();\n    }\n    /**\n   * Transform UserDocument to public User interface (exclude password)\n   * @param userDoc - Mongoose UserDocument\n   * @returns Public user data without sensitive fields\n   */ transformToPublicUser(userDoc) {\n        return {\n            _id: userDoc._id.toString(),\n            name: userDoc.name,\n            email: userDoc.email,\n            createdAt: userDoc.createdAt,\n            updatedAt: userDoc.updatedAt\n        };\n    }\n}\n/**\n * Export singleton instance for use in API routes\n * This ensures consistent database connection handling\n */ const userRepository = new UserRepository();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vcGFja2FnZXMvZGIvc3JjL3JlcG9zaXRvcmllcy9Vc2VyUmVwb3NpdG9yeS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQ29EO0FBQ2Q7QUFFdEM7Ozs7Q0FJQyxHQUNNLE1BQU1FO0lBQ1g7OztHQUdDLEdBQ0QsTUFBY0MsbUJBQWtDO1FBQzlDLDJEQUEyRDtRQUMzRCxJQUFJQyxNQUF5QixJQUFVQSxRQUFRQyxHQUFHLENBQUNDLGNBQWMsRUFBRTtZQUNqRTtRQUNGO1FBQ0EsTUFBTUwsdURBQVNBO0lBQ2pCO0lBRUE7Ozs7R0FJQyxHQUNELE1BQU1NLFlBQVlDLEtBQWEsRUFBeUI7UUFDdEQsTUFBTSxJQUFJLENBQUNMLGdCQUFnQjtRQUUzQixNQUFNTSxPQUFPLE1BQU1ULG9EQUFJQSxDQUFDVSxPQUFPLENBQUM7WUFBRUY7UUFBTSxHQUFHRyxJQUFJO1FBQy9DLElBQUksQ0FBQ0YsTUFBTSxPQUFPO1FBRWxCLHlEQUF5RDtRQUN6RCxPQUFPLElBQUksQ0FBQ0cscUJBQXFCLENBQUNIO0lBQ3BDO0lBRUE7Ozs7R0FJQyxHQUNELE1BQU1JLFNBQVNDLE1BQWMsRUFBeUI7UUFDcEQsTUFBTSxJQUFJLENBQUNYLGdCQUFnQjtRQUUzQixNQUFNTSxPQUFPLE1BQU1ULG9EQUFJQSxDQUFDYSxRQUFRLENBQUNDLFFBQVFILElBQUk7UUFDN0MsSUFBSSxDQUFDRixNQUFNLE9BQU87UUFFbEIsT0FBTyxJQUFJLENBQUNHLHFCQUFxQixDQUFDSDtJQUNwQztJQUVBOzs7O0dBSUMsR0FDRCxNQUFNTSxPQUFPQyxRQUF3QixFQUFrQjtRQUNyRCxNQUFNLElBQUksQ0FBQ2IsZ0JBQWdCO1FBRTNCLE1BQU1NLE9BQU8sSUFBSVQsb0RBQUlBLENBQUM7WUFDcEJpQixNQUFNRCxTQUFTQyxJQUFJO1lBQ25CVCxPQUFPUSxTQUFTUixLQUFLO1lBQ3JCVSxVQUFVRixTQUFTRSxRQUFRO1FBQzdCO1FBRUEsTUFBTUMsWUFBWSxNQUFNVixLQUFLVyxJQUFJO1FBQ2pDLE9BQU8sSUFBSSxDQUFDUixxQkFBcUIsQ0FBQ087SUFDcEM7SUFFQTs7Ozs7R0FLQyxHQUNELE1BQU1FLFdBQVdQLE1BQWMsRUFBRVEsVUFBMEIsRUFBeUI7UUFDbEYsTUFBTSxJQUFJLENBQUNuQixnQkFBZ0I7UUFFM0IsTUFBTU0sT0FBTyxNQUFNVCxvREFBSUEsQ0FBQ3VCLGlCQUFpQixDQUN2Q1QsUUFDQTtZQUFFVSxNQUFNRjtRQUFXLEdBQ25CO1lBQUVHLEtBQUs7WUFBTUMsZUFBZTtRQUFLLEdBQ2pDZixJQUFJO1FBRU4sSUFBSSxDQUFDRixNQUFNLE9BQU87UUFDbEIsT0FBTyxJQUFJLENBQUNHLHFCQUFxQixDQUFDSDtJQUNwQztJQUVBOzs7O0dBSUMsR0FDRCxNQUFNa0IsV0FBV2IsTUFBYyxFQUFvQjtRQUNqRCxNQUFNLElBQUksQ0FBQ1gsZ0JBQWdCO1FBRTNCLE1BQU15QixTQUFTLE1BQU01QixvREFBSUEsQ0FBQzZCLGlCQUFpQixDQUFDZixRQUFRSCxJQUFJO1FBQ3hELE9BQU8sQ0FBQyxDQUFDaUI7SUFDWDtJQUVBOzs7O0dBSUMsR0FDRCxNQUFNRSxjQUFjdEIsS0FBYSxFQUFvQjtRQUNuRCxNQUFNLElBQUksQ0FBQ0wsZ0JBQWdCO1FBRTNCLE1BQU00QixRQUFRLE1BQU0vQixvREFBSUEsQ0FBQ2dDLGNBQWMsQ0FBQztZQUFFeEI7UUFBTSxHQUFHRyxJQUFJO1FBQ3ZELE9BQU9vQixRQUFRO0lBQ2pCO0lBRUE7Ozs7R0FJQyxHQUNELE1BQU1FLHdCQUF3QnpCLEtBQWEsRUFBZ0M7UUFDekUsTUFBTSxJQUFJLENBQUNMLGdCQUFnQjtRQUUzQixPQUFPSCxvREFBSUEsQ0FBQ1UsT0FBTyxDQUFDO1lBQUVGO1FBQU0sR0FBR0csSUFBSTtJQUNyQztJQUVBOzs7O0dBSUMsR0FDRCxzQkFBOEJ1QixPQUFxQixFQUFTO1FBQzFELE9BQU87WUFDTEMsS0FBS0QsUUFBUUMsR0FBRyxDQUFDQyxRQUFRO1lBQ3pCbkIsTUFBTWlCLFFBQVFqQixJQUFJO1lBQ2xCVCxPQUFPMEIsUUFBUTFCLEtBQUs7WUFDcEI2QixXQUFXSCxRQUFRRyxTQUFTO1lBQzVCQyxXQUFXSixRQUFRSSxTQUFTO1FBQzlCO0lBQ0Y7QUFDRjtBQUVBOzs7Q0FHQyxHQUNNLE1BQU1DLGlCQUFpQixJQUFJckMsaUJBQWlCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2ViLy4uLy4uL3BhY2thZ2VzL2RiL3NyYy9yZXBvc2l0b3JpZXMvVXNlclJlcG9zaXRvcnkudHM/NTJlNiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBVc2VyIGFzIElVc2VyLCBDcmVhdGVVc2VyRGF0YSwgVXBkYXRlVXNlckRhdGEgfSBmcm9tICdsaWIvc3JjL3R5cGVzJztcbmltcG9ydCBVc2VyLCB7IFVzZXJEb2N1bWVudCB9IGZyb20gJy4uL21vZGVscy9Vc2VyJztcbmltcG9ydCBkYkNvbm5lY3QgZnJvbSAnLi4vY29ubmVjdGlvbic7XG5cbi8qKlxuICogVXNlclJlcG9zaXRvcnkgY2xhc3MgaW1wbGVtZW50aW5nIHRoZSBSZXBvc2l0b3J5IFBhdHRlcm5cbiAqIEFsbCBkYXRhYmFzZSBvcGVyYXRpb25zIGZvciBVc2VyIG1vZGVsIHNob3VsZCBnbyB0aHJvdWdoIHRoaXMgcmVwb3NpdG9yeVxuICogRm9sbG93aW5nIGNvZGluZyBzdGFuZGFyZHM6IG5vIGRpcmVjdCBNb25nb29zZSBjYWxscyBpbiBBUEkgcm91dGVzXG4gKi9cbmV4cG9ydCBjbGFzcyBVc2VyUmVwb3NpdG9yeSB7XG4gIC8qKlxuICAgKiBFbnN1cmUgZGF0YWJhc2UgY29ubmVjdGlvbiBiZWZvcmUgb3BlcmF0aW9uc1xuICAgKiBTa2lwIGNvbm5lY3Rpb24gaW4gdGVzdCBlbnZpcm9ubWVudCAoaGFuZGxlZCBieSB0ZXN0IHNldHVwKVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBlbnN1cmVDb25uZWN0aW9uKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIEluIHRlc3QgZW52aXJvbm1lbnQsIGNvbm5lY3Rpb24gaXMgaGFuZGxlZCBieSB0ZXN0IHNldHVwXG4gICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAndGVzdCcgfHwgcHJvY2Vzcy5lbnYuSkVTVF9XT1JLRVJfSUQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgYXdhaXQgZGJDb25uZWN0KCk7XG4gIH1cblxuICAvKipcbiAgICogRmluZCB1c2VyIGJ5IGVtYWlsXG4gICAqIEBwYXJhbSBlbWFpbCAtIFVzZXIncyBlbWFpbCBhZGRyZXNzXG4gICAqIEByZXR1cm5zIFVzZXIgZG9jdW1lbnQgb3IgbnVsbCBpZiBub3QgZm91bmRcbiAgICovXG4gIGFzeW5jIGZpbmRCeUVtYWlsKGVtYWlsOiBzdHJpbmcpOiBQcm9taXNlPElVc2VyIHwgbnVsbD4ge1xuICAgIGF3YWl0IHRoaXMuZW5zdXJlQ29ubmVjdGlvbigpO1xuICAgIFxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRPbmUoeyBlbWFpbCB9KS5leGVjKCk7XG4gICAgaWYgKCF1c2VyKSByZXR1cm4gbnVsbDtcblxuICAgIC8vIFRyYW5zZm9ybSB0byBtYXRjaCBzaGFyZWQgaW50ZXJmYWNlIChleGNsdWRlIHBhc3N3b3JkKVxuICAgIHJldHVybiB0aGlzLnRyYW5zZm9ybVRvUHVibGljVXNlcih1c2VyKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGaW5kIHVzZXIgYnkgSURcbiAgICogQHBhcmFtIHVzZXJJZCAtIFVzZXIncyBNb25nb0RCIE9iamVjdElkIGFzIHN0cmluZ1xuICAgKiBAcmV0dXJucyBVc2VyIGRvY3VtZW50IG9yIG51bGwgaWYgbm90IGZvdW5kXG4gICAqL1xuICBhc3luYyBmaW5kQnlJZCh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8SVVzZXIgfCBudWxsPiB7XG4gICAgYXdhaXQgdGhpcy5lbnN1cmVDb25uZWN0aW9uKCk7XG4gICAgXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIuZmluZEJ5SWQodXNlcklkKS5leGVjKCk7XG4gICAgaWYgKCF1c2VyKSByZXR1cm4gbnVsbDtcblxuICAgIHJldHVybiB0aGlzLnRyYW5zZm9ybVRvUHVibGljVXNlcih1c2VyKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBuZXcgdXNlclxuICAgKiBAcGFyYW0gdXNlckRhdGEgLSBVc2VyIGNyZWF0aW9uIGRhdGEgd2l0aCBwYXNzd29yZFxuICAgKiBAcmV0dXJucyBDcmVhdGVkIHVzZXIgKHdpdGhvdXQgcGFzc3dvcmQpXG4gICAqL1xuICBhc3luYyBjcmVhdGUodXNlckRhdGE6IENyZWF0ZVVzZXJEYXRhKTogUHJvbWlzZTxJVXNlcj4ge1xuICAgIGF3YWl0IHRoaXMuZW5zdXJlQ29ubmVjdGlvbigpO1xuICAgIFxuICAgIGNvbnN0IHVzZXIgPSBuZXcgVXNlcih7XG4gICAgICBuYW1lOiB1c2VyRGF0YS5uYW1lLFxuICAgICAgZW1haWw6IHVzZXJEYXRhLmVtYWlsLFxuICAgICAgcGFzc3dvcmQ6IHVzZXJEYXRhLnBhc3N3b3JkLCAvLyBTaG91bGQgYmUgaGFzaGVkIGJlZm9yZSBjYWxsaW5nIHRoaXMgbWV0aG9kXG4gICAgfSk7XG5cbiAgICBjb25zdCBzYXZlZFVzZXIgPSBhd2FpdCB1c2VyLnNhdmUoKTtcbiAgICByZXR1cm4gdGhpcy50cmFuc2Zvcm1Ub1B1YmxpY1VzZXIoc2F2ZWRVc2VyKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgdXNlciBieSBJRFxuICAgKiBAcGFyYW0gdXNlcklkIC0gVXNlcidzIE1vbmdvREIgT2JqZWN0SWQgYXMgc3RyaW5nXG4gICAqIEBwYXJhbSB1cGRhdGVEYXRhIC0gUGFydGlhbCB1c2VyIGRhdGEgdG8gdXBkYXRlXG4gICAqIEByZXR1cm5zIFVwZGF0ZWQgdXNlciBvciBudWxsIGlmIG5vdCBmb3VuZFxuICAgKi9cbiAgYXN5bmMgdXBkYXRlQnlJZCh1c2VySWQ6IHN0cmluZywgdXBkYXRlRGF0YTogVXBkYXRlVXNlckRhdGEpOiBQcm9taXNlPElVc2VyIHwgbnVsbD4ge1xuICAgIGF3YWl0IHRoaXMuZW5zdXJlQ29ubmVjdGlvbigpO1xuICAgIFxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkQW5kVXBkYXRlKFxuICAgICAgdXNlcklkLFxuICAgICAgeyAkc2V0OiB1cGRhdGVEYXRhIH0sXG4gICAgICB7IG5ldzogdHJ1ZSwgcnVuVmFsaWRhdG9yczogdHJ1ZSB9XG4gICAgKS5leGVjKCk7XG5cbiAgICBpZiAoIXVzZXIpIHJldHVybiBudWxsO1xuICAgIHJldHVybiB0aGlzLnRyYW5zZm9ybVRvUHVibGljVXNlcih1c2VyKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGUgdXNlciBieSBJRFxuICAgKiBAcGFyYW0gdXNlcklkIC0gVXNlcidzIE1vbmdvREIgT2JqZWN0SWQgYXMgc3RyaW5nXG4gICAqIEByZXR1cm5zIHRydWUgaWYgZGVsZXRlZCwgZmFsc2UgaWYgbm90IGZvdW5kXG4gICAqL1xuICBhc3luYyBkZWxldGVCeUlkKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgYXdhaXQgdGhpcy5lbnN1cmVDb25uZWN0aW9uKCk7XG4gICAgXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgVXNlci5maW5kQnlJZEFuZERlbGV0ZSh1c2VySWQpLmV4ZWMoKTtcbiAgICByZXR1cm4gISFyZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgdXNlciBleGlzdHMgYnkgZW1haWxcbiAgICogQHBhcmFtIGVtYWlsIC0gVXNlcidzIGVtYWlsIGFkZHJlc3NcbiAgICogQHJldHVybnMgdHJ1ZSBpZiB1c2VyIGV4aXN0cywgZmFsc2Ugb3RoZXJ3aXNlXG4gICAqL1xuICBhc3luYyBleGlzdHNCeUVtYWlsKGVtYWlsOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBhd2FpdCB0aGlzLmVuc3VyZUNvbm5lY3Rpb24oKTtcbiAgICBcbiAgICBjb25zdCBjb3VudCA9IGF3YWl0IFVzZXIuY291bnREb2N1bWVudHMoeyBlbWFpbCB9KS5leGVjKCk7XG4gICAgcmV0dXJuIGNvdW50ID4gMDtcbiAgfVxuXG4gIC8qKlxuICAgKiBGaW5kIHVzZXIgYnkgZW1haWwgaW5jbHVkaW5nIHBhc3N3b3JkIChmb3IgYXV0aGVudGljYXRpb24pXG4gICAqIEBwYXJhbSBlbWFpbCAtIFVzZXIncyBlbWFpbCBhZGRyZXNzXG4gICAqIEByZXR1cm5zIFVzZXIgZG9jdW1lbnQgd2l0aCBwYXNzd29yZCBvciBudWxsIGlmIG5vdCBmb3VuZFxuICAgKi9cbiAgYXN5bmMgZmluZEJ5RW1haWxXaXRoUGFzc3dvcmQoZW1haWw6IHN0cmluZyk6IFByb21pc2U8VXNlckRvY3VtZW50IHwgbnVsbD4ge1xuICAgIGF3YWl0IHRoaXMuZW5zdXJlQ29ubmVjdGlvbigpO1xuICAgIFxuICAgIHJldHVybiBVc2VyLmZpbmRPbmUoeyBlbWFpbCB9KS5leGVjKCk7XG4gIH1cblxuICAvKipcbiAgICogVHJhbnNmb3JtIFVzZXJEb2N1bWVudCB0byBwdWJsaWMgVXNlciBpbnRlcmZhY2UgKGV4Y2x1ZGUgcGFzc3dvcmQpXG4gICAqIEBwYXJhbSB1c2VyRG9jIC0gTW9uZ29vc2UgVXNlckRvY3VtZW50XG4gICAqIEByZXR1cm5zIFB1YmxpYyB1c2VyIGRhdGEgd2l0aG91dCBzZW5zaXRpdmUgZmllbGRzXG4gICAqL1xuICBwcml2YXRlIHRyYW5zZm9ybVRvUHVibGljVXNlcih1c2VyRG9jOiBVc2VyRG9jdW1lbnQpOiBJVXNlciB7XG4gICAgcmV0dXJuIHtcbiAgICAgIF9pZDogdXNlckRvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgIG5hbWU6IHVzZXJEb2MubmFtZSxcbiAgICAgIGVtYWlsOiB1c2VyRG9jLmVtYWlsLFxuICAgICAgY3JlYXRlZEF0OiB1c2VyRG9jLmNyZWF0ZWRBdCxcbiAgICAgIHVwZGF0ZWRBdDogdXNlckRvYy51cGRhdGVkQXQsXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIEV4cG9ydCBzaW5nbGV0b24gaW5zdGFuY2UgZm9yIHVzZSBpbiBBUEkgcm91dGVzXG4gKiBUaGlzIGVuc3VyZXMgY29uc2lzdGVudCBkYXRhYmFzZSBjb25uZWN0aW9uIGhhbmRsaW5nXG4gKi9cbmV4cG9ydCBjb25zdCB1c2VyUmVwb3NpdG9yeSA9IG5ldyBVc2VyUmVwb3NpdG9yeSgpO1xuIl0sIm5hbWVzIjpbIlVzZXIiLCJkYkNvbm5lY3QiLCJVc2VyUmVwb3NpdG9yeSIsImVuc3VyZUNvbm5lY3Rpb24iLCJwcm9jZXNzIiwiZW52IiwiSkVTVF9XT1JLRVJfSUQiLCJmaW5kQnlFbWFpbCIsImVtYWlsIiwidXNlciIsImZpbmRPbmUiLCJleGVjIiwidHJhbnNmb3JtVG9QdWJsaWNVc2VyIiwiZmluZEJ5SWQiLCJ1c2VySWQiLCJjcmVhdGUiLCJ1c2VyRGF0YSIsIm5hbWUiLCJwYXNzd29yZCIsInNhdmVkVXNlciIsInNhdmUiLCJ1cGRhdGVCeUlkIiwidXBkYXRlRGF0YSIsImZpbmRCeUlkQW5kVXBkYXRlIiwiJHNldCIsIm5ldyIsInJ1blZhbGlkYXRvcnMiLCJkZWxldGVCeUlkIiwicmVzdWx0IiwiZmluZEJ5SWRBbmREZWxldGUiLCJleGlzdHNCeUVtYWlsIiwiY291bnQiLCJjb3VudERvY3VtZW50cyIsImZpbmRCeUVtYWlsV2l0aFBhc3N3b3JkIiwidXNlckRvYyIsIl9pZCIsInRvU3RyaW5nIiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0IiwidXNlclJlcG9zaXRvcnkiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/../../packages/db/src/repositories/UserRepository.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/next-auth","vendor-chunks/@babel","vendor-chunks/jose","vendor-chunks/openid-client","vendor-chunks/oauth","vendor-chunks/preact","vendor-chunks/uuid","vendor-chunks/preact-render-to-string","vendor-chunks/cookie","vendor-chunks/@panva","vendor-chunks/oidc-token-hash","vendor-chunks/@google","vendor-chunks/gaxios","vendor-chunks/google-auth-library","vendor-chunks/ws","vendor-chunks/bignumber.js","vendor-chunks/json-bigint","vendor-chunks/google-logging-utils","vendor-chunks/debug","vendor-chunks/gtoken","vendor-chunks/jws","vendor-chunks/jwa","vendor-chunks/ecdsa-sig-formatter","vendor-chunks/base64-js","vendor-chunks/extend","vendor-chunks/ms","vendor-chunks/supports-color","vendor-chunks/safe-buffer","vendor-chunks/buffer-equal-constant-time","vendor-chunks/is-stream","vendor-chunks/has-flag"], () => (__webpack_exec__("(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fanalysis%2Fstatus%2F%5BanalysisId%5D%2Froute&page=%2Fapi%2Fanalysis%2Fstatus%2F%5BanalysisId%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fanalysis%2Fstatus%2F%5BanalysisId%5D%2Froute.ts&appDir=%2FUsers%2Fshrijayan.rajendran%2Fprojects%2Fpersonal%2Fbank_statement%2Fapps%2Fweb%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fshrijayan.rajendran%2Fprojects%2Fpersonal%2Fbank_statement%2Fapps%2Fweb&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();