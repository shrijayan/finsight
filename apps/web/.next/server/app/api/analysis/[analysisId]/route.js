"use strict";(()=>{var e={};e.id=513,e.ids=[513,944,919],e.modules={11185:e=>{e.exports=require("mongoose")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},32081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},73292:e=>{e.exports=require("fs/promises")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},15673:e=>{e.exports=require("node:events")},97742:e=>{e.exports=require("node:process")},84492:e=>{e.exports=require("node:stream")},47261:e=>{e.exports=require("node:util")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},85477:e=>{e.exports=require("punycode")},63477:e=>{e.exports=require("querystring")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},76224:e=>{e.exports=require("tty")},35034:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},54004:(e,r,s)=>{s.r(r),s.d(r,{originalPathname:()=>w,patchFetch:()=>h,requestAsyncStorage:()=>x,routeModule:()=>m,serverHooks:()=>q,staticGenerationAsyncStorage:()=>f});var t={};s.r(t),s.d(t,{DELETE:()=>y,GET:()=>p});var n=s(63036),a=s(5736),i=s(15262),o=s(60942),u=s(1295),l=s(48798),d=s(50944),c=s(26281);async function p(e,{params:r}){try{let e=await (0,u.getServerSession)();if(!e?.user?.email)return o.NextResponse.json({error:"Authentication required. Please log in to view analysis reports."},{status:401});let s=await d.userRepository.findByEmail(e.user.email);if(!s)return o.NextResponse.json({error:"User account not found"},{status:404});let t=s._id;if(!r.analysisId||""===r.analysisId.trim())return o.NextResponse.json({error:"Analysis ID is required"},{status:400});let n=await l.analysisService.getAnalysisStatus(r.analysisId,t);if(!n)return o.NextResponse.json({error:"Analysis not found or access denied"},{status:404});return o.NextResponse.json({id:n._id,uploadId:n.uploadId,reportTitle:n.reportTitle,status:n.status,progress:n.progress||0,sourceDocumentCount:n.sourceDocumentCount,generatedData:n.generatedData,createdAt:n.createdAt,updatedAt:n.updatedAt,completedAt:n.completedAt})}catch(e){if(console.error("Analysis detail API error:",e),e instanceof c.Ay)return o.NextResponse.json({error:e.message},{status:403});return o.NextResponse.json({error:"Failed to retrieve analysis report. Please try again."},{status:500})}}async function y(e,{params:r}){try{let e=await (0,u.getServerSession)();if(!e?.user?.email)return o.NextResponse.json({error:"Authentication required. Please log in to delete analysis reports."},{status:401});let s=await d.userRepository.findByEmail(e.user.email);if(!s)return o.NextResponse.json({error:"User account not found"},{status:404});let t=s._id;if(!r.analysisId||""===r.analysisId.trim())return o.NextResponse.json({error:"Analysis ID is required"},{status:400});if(!await l.analysisService.deleteAnalysis(r.analysisId,t))return o.NextResponse.json({error:"Analysis not found or access denied"},{status:404});return o.NextResponse.json({message:"Analysis report deleted successfully",deletedId:r.analysisId})}catch(e){if(console.error("Analysis delete API error:",e),e instanceof c.Ay)return o.NextResponse.json({error:e.message},{status:403});return o.NextResponse.json({error:"Failed to delete analysis report. Please try again."},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/analysis/[analysisId]/route",pathname:"/api/analysis/[analysisId]",filename:"route",bundlePath:"app/api/analysis/[analysisId]/route"},resolvedPagePath:"/Users/shrijayan.rajendran/projects/personal/bank_statement/apps/web/src/app/api/analysis/[analysisId]/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:x,staticGenerationAsyncStorage:f,serverHooks:q}=m,w="/api/analysis/[analysisId]/route";function h(){return(0,i.patchFetch)({serverHooks:q,staticGenerationAsyncStorage:f})}},77919:(e,r,s)=>{s.d(r,{Z:()=>i});var t=s(11185),n=s.n(t);let a=global.mongoose;a||(a=global.mongoose={conn:null,promise:null});let i=async function(){if(a.conn)return a.conn;if(!a.promise){let e=process.env.MONGODB_URI;if(!e)throw Error("Please define the MONGODB_URI environment variable inside .env.local");a.promise=n().connect(e,{bufferCommands:!1}).then(e=>e)}try{a.conn=await a.promise}catch(e){throw a.promise=null,e}return a.conn}},50944:(e,r,s)=>{s.d(r,{userRepository:()=>l});var t=s(11185),n=s.n(t);let a=new t.Schema({name:{type:String,required:[!0,"Name is required"],trim:!0,maxlength:[100,"Name cannot exceed 100 characters"]},email:{type:String,required:[!0,"Email is required"],unique:!0,lowercase:!0,trim:!0,match:[/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/,"Please enter a valid email address"]},password:{type:String,required:[!0,"Password is required"],minlength:[6,"Password must be at least 6 characters long"]}},{timestamps:!0,collection:"users"}),i=n().models.User||n().model("User",a);var o=s(77919);class u{async ensureConnection(){process.env.JEST_WORKER_ID||await (0,o.Z)()}async findByEmail(e){await this.ensureConnection();let r=await i.findOne({email:e}).exec();return r?this.transformToPublicUser(r):null}async findById(e){await this.ensureConnection();let r=await i.findById(e).exec();return r?this.transformToPublicUser(r):null}async create(e){await this.ensureConnection();let r=new i({name:e.name,email:e.email,password:e.password}),s=await r.save();return this.transformToPublicUser(s)}async updateById(e,r){await this.ensureConnection();let s=await i.findByIdAndUpdate(e,{$set:r},{new:!0,runValidators:!0}).exec();return s?this.transformToPublicUser(s):null}async deleteById(e){return await this.ensureConnection(),!!await i.findByIdAndDelete(e).exec()}async existsByEmail(e){return await this.ensureConnection(),await i.countDocuments({email:e}).exec()>0}async findByEmailWithPassword(e){return await this.ensureConnection(),i.findOne({email:e}).exec()}transformToPublicUser(e){return{_id:e._id.toString(),name:e.name,email:e.email,createdAt:e.createdAt,updatedAt:e.updatedAt}}}let l=new u}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[522,295,746,306,879],()=>s(54004));module.exports=t})();